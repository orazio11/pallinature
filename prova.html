<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Posizionamento Bollini & Dati (v7.4 - Calcolo Fori con Tabella)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
        } else {
            console.error("PDF.js library not loaded.");
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .drawing-area {
            position: relative;
            width: 100%; 
            height: 60vh; 
            overflow: hidden; 
            background-color: #2d3748; 
            border: 1px solid #4b5563;
            border-radius: 0.375rem; 
            margin: auto;
        }
        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: auto; 
            cursor: default;
        }
        #drawingCanvas.panning-cursor { cursor: grab; }
        #drawingCanvas.panning-active-cursor { cursor: grabbing; }
        #drawingCanvas.crosshair-mode-active, 
        #drawingCanvas.set-origin-mode-active,
        #drawingCanvas.set-cnc-zero-mode-active,
        #drawingCanvas.get-coords-mode-active,
        #drawingCanvas.place-snap-point-mode-active,
        #drawingCanvas.define-tool-path-mode-active,
        #drawingCanvas.pick-bolt-circle-center-mode-active { cursor: none; }
        #drawingCanvas.cell-cursor { cursor: cell; }
        #drawingCanvas.delete-mode.over-bollino,
        #drawingCanvas.draggable-bollino-hover {
             cursor: pointer;
        }
        #drawingCanvas.dragging-bollino {
            cursor: grabbing;
        }

        #loupeCanvas { 
            position: absolute;
            border: 2px solid #f59e0b; 
            border-radius: 50%; 
            pointer-events: none; 
            display: none; 
            z-index: 1001; 
            background-color: rgba(255, 255, 255, 0.8); 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            overflow: hidden; 
        }


        #drawingImage { 
            display: none;
        }
        .table-container, .custom-table-container, .toolpath-table-container, .bolt-circle-results-container {
            max-height: 180px; 
            overflow-y: auto;
            border: 1px solid #4b5563;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem; 
        }
        .selected-row {
            background-color: #4a5568 !important;
            font-weight: 600;
        }
        .selected-row td {
            color: #e2e8f0 !important;
        }
        .info-box {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: rgba(17, 24, 39, 0.9);
            color: #e5e7eb;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            max-width: 90%;
        }
        .scale-display {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(17, 24, 39, 0.9);
            color: #e5e7eb;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75em; 
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            text-align: right;
            line-height: 1.4; 
        }
         #loader, #aiChatLoader {
            border: 6px solid #4b5563;
            border-top: 6px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 1500; 
        }
        #loader { width: 60px; height: 60px; }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #1f2937;
            color: #e5e7eb;
            padding: 25px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
        #aiChatModal .modal-content {
            max-width: 700px; height: 80vh; display: flex; flex-direction: column;
        }
        #boltCircleModal .modal-content {
            max-width: 800px;
        }
        .file-input-container {
            border: 2px dashed #4b5563; padding: 15px; border-radius: 8px; background-color: #374151; 
        }
        
        .controls-section {
            margin-bottom: 0.6rem; 
        }
        .controls-section h3 {
             font-size: 0.85rem; 
             font-weight: 600; 
             color: #d1d5db; 
             margin-bottom: 0.4rem; 
             text-align: left;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap; 
            gap: 0.4rem; 
            margin-bottom: 0.4rem; 
        }
        .button-group button, .controls-group button, .export-button, .file-input-container label button,
        .toolpath-controls-group button {
            background-color: #4b5563; 
            color: white;
            font-weight: 600; 
            padding: 0.3rem 0.6rem; 
            border-radius: 0.375rem; 
            transition: background-color 0.15s ease-in-out;
            font-size: 0.68rem; 
            line-height: 1.1rem; 
            flex-grow: 1; 
            min-width: 100px; 
        }
        .button-group button:hover, .controls-group button:hover, .export-button:hover, 
        .file-input-container label button:hover, .toolpath-controls-group button:hover {
            background-color: #5a6678; 
        }
         .button-group button:disabled, .controls-group button:disabled, .export-button:disabled, 
         .file-input-container label button:disabled, .toolpath-controls-group button:disabled {
            background-color: #374151; 
            color: #9ca3af; 
            cursor: not-allowed;
        }
         .button-group button.active-mode-btn { 
            background-color: #f59e0b; border-color: #d97706;
        }
        .button-group button.active-mode-btn:hover {
            background-color: #d97706;
        }
        .button-group button.snap-point-btn { background-color: #d946ef; } 
        .button-group button.snap-point-btn:hover { background-color: #c026d3; }
        .button-group button.snap-point-btn.active-mode-btn { background-color: #a21caf; border-color: #86198f;}
        .button-group button.snap-point-btn.active-mode-btn:hover { background-color: #86198f;}
        .button-group button.clear-snap-btn { background-color: #78350f; } 
        .button-group button.clear-snap-btn:hover { background-color: #52230A; }

        .export-button.emerald { background-color: #059669; } 
        .export-button.emerald:hover { background-color: #047857; }
        .export-button.sky { background-color: #0ea5e9; } 
        .export-button.sky:hover { background-color: #0284c7; }

        #labelInputModal .modal-content, #sequentialLabelInputModal .modal-content, 
        #calibrateScaleModal .modal-content, #cncOriginNameModal .modal-content,
        #boltCircleModal .modal-content { text-align: left; }
        #labelInputModal input, #sequentialLabelInputModal input, #calibrateScaleModal input, 
        #cncOriginNameModal input, #aiChatPromptInput, #virtualToolDiameterInput, 
        #manualToolPathXInput, #manualToolPathYInput, #boltCircleModal input {
            width: 100%; padding: 8px 10px; margin-bottom: 12px; border: 1px solid #4b5563;
            border-radius: 6px; font-size: 0.9rem; background-color: #374151; color: #e5e7eb;
        }
        #aiChatPromptInput { padding: 10px 12px; font-size: 1rem; margin-bottom: 15px; }
        #boltCircleModal .input-group { display: flex; gap: 10px; align-items: center; }
        #boltCircleModal .input-group input { margin-bottom: 0; }
        #boltCircleModal .input-group .pick-center-btn { flex-shrink: 0; padding: 6px 10px; font-size: 0.8rem;}

        #labelInputModal input::placeholder, #sequentialLabelInputModal input::placeholder,
        #calibrateScaleModal input::placeholder, #cncOriginNameModal input::placeholder, 
        #aiChatPromptInput::placeholder, #virtualToolDiameterInput::placeholder, 
        #manualToolPathXInput::placeholder, #manualToolPathYInput::placeholder, #boltCircleModal input::placeholder { color: #9ca3af; }


        .dark-file-input::-webkit-file-upload-button, 
        .gcode-file-input::-webkit-file-upload-button {
            background-color: #4f46e5; color: white; border: none; padding: 0.5rem 1rem; 
            border-radius: 0.375rem; font-size: 0.8rem; font-weight: 600; margin-right: 0.75rem;
            cursor: pointer; transition: background-color 0.15s ease-in-out;
        }
        .dark-file-input::-webkit-file-upload-button:hover,
        .gcode-file-input::-webkit-file-upload-button:hover { background-color: #4338ca; }
        
        .dark-file-input-green::-webkit-file-upload-button {
            background-color: #059669; color: white; border: none; padding: 0.5rem 1rem; 
            border-radius: 0.375rem; font-size: 0.8rem; font-weight: 600; margin-right: 0.75rem;
            cursor: pointer; transition: background-color 0.15s ease-in-out;
        }
        .dark-file-input-green::-webkit-file-upload-button:hover { background-color: #047857; }
        .dark-file-input, .gcode-file-input { color: #9ca3af; font-size: 0.9rem; }
        .gcode-file-input::-webkit-file-upload-button { background-color: #ca8a04; } 
        .gcode-file-input::-webkit-file-upload-button:hover { background-color: #a16207; }


        #aiChatDisplay {
            flex-grow: 1; overflow-y: auto; padding: 10px; background-color: #2d3748;
            border-radius: 8px; margin-bottom: 10px; border: 1px solid #4a5568;
        }
        .chat-message {
            padding: 8px 12px; border-radius: 6px; margin-bottom: 8px; max-width: 85%;
            word-wrap: break-word; display: flex; flex-direction: column;
        }
        .chat-message.user { background-color: #4f46e5; color: white; margin-left: auto; align-items: flex-end; }
        .chat-message.ai { background-color: #374151; color: #e5e7eb; margin-right: auto; align-items: flex-start; }
        .chat-message.error { background-color: #c53030; color: white; text-align: center; align-items: center; }
        .chat-message img { max-width: 200px; max-height: 200px; border-radius: 4px; margin-top: 5px; border: 1px solid #4a5568; }
        #aiChatImagePreviewContainer { margin-bottom: 10px; text-align: center; position: relative; }
        #aiChatImagePreview { max-width: 150px; max-height: 100px; border-radius: 4px; border: 1px solid #4b5563; }
        #removeAiChatImageButton {
            position: absolute; top: -8px; right: calc(50% - 85px); background-color: rgba(200, 50, 50, 0.8);
            color: white; border: none; border-radius: 50%; width: 24px; height: 24px;
            font-size: 14px; line-height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        #aiChatInputContainer { display: flex; gap: 10px; align-items: center; }
        #aiChatPromptInput { flex-grow: 1; margin-bottom: 0; resize: none; min-height: 44px; }
        #attachAiFileButton { background: none; border: none; color: #9ca3af; font-size: 1.5rem; cursor: pointer; padding: 5px; }
        #attachAiFileButton:hover { color: #e5e7eb; }
        #sendAiPromptButton { padding: 10px 18px; }
        #aiChatFileInput { display: none; }

        .controls-group, .toolpath-controls-group {
            display: flex;
            gap: 0.5rem; 
            margin-bottom: 0.5rem; 
            justify-content: center;
            align-items: center;
        }
       
        .controls-group .label, .toolpath-controls-group .label {
            font-size: 0.8rem; 
            color: #d1d5db; 
            margin-right: 0.25rem; 
            white-space: nowrap; 
        }
        .table-container th, .table-container td,
        .custom-table-container th, .custom-table-container td,
        .toolpath-table-container th, .toolpath-table-container td,
        .bolt-circle-results-container th, .bolt-circle-results-container td {
            padding: 0.375rem 0.5rem; 
            font-size: 0.8rem;
            border: 1px solid #4b5563;
        }
        .table-container td[contenteditable="true"], 
        .custom-table-container td[contenteditable="true"] { 
            background-color: #374151;
        }
        .table-container td[contenteditable="true"]:focus,
        .custom-table-container td[contenteditable="true"]:focus {
            background-color: #4b5563;
            outline: 1px solid #60a5fa;
        }
        .delete-row-btn {
            background-color: #ef4444; 
            color: white;
            padding: 0.25rem 0.5rem; 
            border-radius: 0.25rem; 
            font-size: 0.75rem; 
        }
        .delete-row-btn:hover {
            background-color: #dc2626; 
        }
        .origin-marker-color { color: #10b981; } 
        .cnc-origin-btn-color { background-color: #6366f1 !important; } 
        .cnc-origin-btn-color:hover { background-color: #4f46e5 !important; }
        .cnc-origin-btn-color.active-mode-btn { background-color: #4338ca !important; border-color: #3730a3 !important; }
        .cnc-origin-btn-color.active-mode-btn:hover { background-color: #3730a3 !important;}
        .gcode-related-btn-color { background-color: #eab308 !important; } 
        .gcode-related-btn-color:hover { background-color: #ca8a04 !important; }
        .toolpath-btn-color { background-color: #06b6d4 !important; } 
        .toolpath-btn-color:hover { background-color: #0891b2 !important; }
        .toolpath-btn-color.active-mode-btn { background-color: #0e7490 !important; border-color: #155e75 !important; }
        .toolpath-btn-color.active-mode-btn:hover { background-color: #155e75 !important;}
        .bolt-circle-btn-color { background-color: #db2777 !important; }
        .bolt-circle-btn-color:hover { background-color: #be185d !important; }

        #toolPathReferenceOriginSelect {
            background-color: #374151;
            color: #e5e7eb;
            border: 1px solid #4b5563;
            border-radius: 0.375rem;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            flex-grow: 1;
            min-width: 150px; 
        }
        .toolpath-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .toolpath-input-group label {
            font-size: 0.75rem;
            color: #d1d5db;
            white-space: nowrap;
        }
        .toolpath-input-group input[type="number"] {
            width: auto; 
            flex-grow: 1;
            padding: 6px 8px;
            font-size: 0.8rem;
            margin-bottom: 0; 
        }
        .toolpath-checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .toolpath-checkbox-group label {
            font-size: 0.8rem;
            color: #d1d5db;
        }
        #showToolPathLinesCheckbox {
            width: 1rem; height: 1rem;
            accent-color: #06b6d4; 
        }
        #boltCirclePreviewCanvas {
            background-color: #2d3748;
            border-radius: 0.375rem;
            border: 1px solid #4b5563;
            width: 150px;
            height: 150px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 p-3 md:p-4"> 
    <div class="container mx-auto bg-gray-800 p-4 md:p-6 rounded-xl shadow-2xl"> 
        <header class="mb-6 text-center">
            <img src="https://placehold.co/400x70/2d3748/9ca3af?text=Annotazioni+Tecniche+Precisione" alt="Banner Annotazioni Tecniche e Precisione" class="mx-auto mb-3 rounded-lg shadow-md" style="max-width: 350px; height: auto;">
            <h1 class="text-xl md:text-3xl font-bold text-white">App Posizionamento Bollini & Dati (v7.4)</h1> 
            <p class="text-gray-400 mt-1 text-xs md:text-sm">Origini CNC, Punti G-Code, Percorso Fresa, Fori Circonferenza, Loupe, PDF.</p> 
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4"> 
            <div class="file-input-container">
                <label for="imageUpload" class="block text-xs font-medium text-gray-300 mb-1">1. Carica Disegno (Immagine/SVG/PDF):</label>
                <input type="file" id="imageUpload" accept="image/*,image/svg+xml,application/pdf" class="block w-full text-sm dark-file-input"/>
                <p id="imageUploadError" class="text-red-500 text-xs mt-1"></p>
            </div>
            <div class="file-input-container">
                <label for="csvUpload" class="block text-xs font-medium text-gray-300 mb-1">2. Carica Quote Bollini (CSV - Opz.):</label>
                <input type="file" id="csvUpload" accept=".csv" class="block w-full text-sm dark-file-input-green"/>
                <p id="csvUploadError" class="text-red-500 text-xs mt-1"></p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> 
            <div class="md:col-span-2 bg-gray-750 p-2 md:p-3 rounded-lg shadow-md"> 
                <h2 class="text-md md:text-lg font-semibold text-gray-100 mb-2 text-center">Disegno</h2> 
                <div class="controls-group">
                    <span class="label">Zoom:</span>
                    <button id="zoomOutButton" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
                    <button id="resetZoomButton" title="Reset Zoom"><i class="fas fa-expand"></i></button>
                    <button id="zoomInButton" title="Zoom In"><i class="fas fa-search-plus"></i></button>
                </div>
                <div class="controls-group mb-2">
                    <span class="label">Dim. Bollini:</span>
                    <button id="bollinoSizeDecreaseButton" title="Riduci Bollini"><i class="fas fa-minus-circle"></i></button>
                    <button id="bollinoSizeResetButton" title="Reset Dim. Bollini"><i class="fas fa-circle"></i></button>
                    <button id="bollinoSizeIncreaseButton" title="Ingrandisci Bollini"><i class="fas fa-plus-circle"></i></button>
                </div>
                <div id="drawingArea" class="drawing-area">
                    <img id="drawingImage" src="https://placehold.co/800x600/374151/9ca3af?text=Carica+un+disegno" alt="Disegno Tecnico Sorgente"/>
                    <canvas id="drawingCanvas"></canvas>
                    <canvas id="loupeCanvas"></canvas> 
                    <div id="loader"></div> 
                </div>
                 <div id="imageError" class="text-center text-red-500 mt-1 text-xs"></div> 
            </div>

            <div class="md:col-span-1 bg-gray-750 p-2 md:p-3 rounded-lg shadow-md flex flex-col"> 
                <h2 class="text-md md:text-lg font-semibold text-gray-100 mb-2">Controlli</h2> 
                
                <div class="controls-section">
                    <h3>Strumenti Disegno & Misura</h3>
                    <div class="button-group">
                        <button id="toggleSetOriginModeButton" title="Imposta un punto di origine (0,0) principale per il disegno (ALT per Loupe)" class="origin-marker-color"><i class="fas fa-crosshairs mr-1"></i>Imposta Origine Disegno</button>
                        <button id="toggleCalibrateScaleModeButton" title="Definisci una scala basata su una quota nota (ALT per Loupe)"><i class="fas fa-ruler-combined mr-1"></i>Calibra Scala</button>
                    </div>
                     <div class="button-group">
                        <button id="toggleMeasureDistanceModeButton" title="Misura distanze sul disegno (richiede calibrazione, ALT per Loupe)"><i class="fas fa-drafting-compass mr-1"></i>Misura Dist.</button>
                        <button id="toggleGetCoordsModeButton" title="Leggi coordinate X,Y relative alle origini definite (richiede origine/i e calibrazione, ALT per Loupe)"><i class="fas fa-map-marker-alt mr-1"></i>Leggi Coord.</button>
                    </div>
                </div>

                 <div class="controls-section"> 
                    <h3>Punti di Snap Manuali</h3>
                    <div class="button-group">
                        <button id="togglePlaceSnapPointModeButton" title="Piazza punti di aggancio manuali sul disegno (ALT per Loupe)" class="snap-point-btn"><i class="fas fa-thumbtack mr-1"></i>Piazza P.to Snap</button>
                        <button id="clearSnapPointsButton" title="Cancella tutti i punti di snap manuali" class="clear-snap-btn"><i class="fas fa-eraser mr-1"></i>Canc. P.ti Snap</button>
                    </div>
                     <div class="text-xs text-gray-400 mb-2">Usa ALT in modalità di posizionamento/misura per attivare la Loupe di precisione.</div>
                </div>

                <!-- NUOVA SEZIONE CALCOLI GEOMETRICI -->
                <div class="controls-section">
                    <h3>Calcoli Geometrici</h3>
                    <div class="button-group">
                        <button id="openBoltCircleCalculatorButton" title="Calcola e posiziona fori su una circonferenza" class="bolt-circle-btn-color"><i class="fas fa-circle-notch mr-1"></i>Fori su Circonferenza</button>
                        <button id="clearBoltCirclePointsButton" title="Cancella tutti i fori da circonferenza" class="bg-red-700 hover:bg-red-800"><i class="fas fa-trash-alt mr-1"></i>Canc. Fori Circ.</button>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3>Origini CNC & G-Code</h3>
                     <div class="button-group">
                        <button id="toggleSetCNCOriginModeButton" title="Imposta un punto di origine CNC specifico (es. G54, G55) (ALT per Loupe)" class="cnc-origin-btn-color"><i class="fas fa-map-pin mr-1"></i>Imposta Origine CNC</button>
                        <button id="clearCNCOriginsButton" title="Cancella tutte le origini CNC definite" class="bg-red-700 hover:bg-red-800"><i class="fas fa-trash-alt mr-1"></i>Canc. Origini CNC</button>
                    </div>
                    <div class="file-input-container mt-2 mb-2 py-2 px-2">
                         <label for="gcodeUpload" class="block text-xs font-medium text-gray-300 mb-1"><i class="fas fa-file-code mr-1"></i>3. Carica G-Code (Punti - Opz.):</label>
                         <input type="file" id="gcodeUpload" accept=".nc,.gcode,.tap,.txt" class="block w-full text-sm gcode-file-input"/>
                         <p id="gcodeUploadError" class="text-red-500 text-xs mt-1"></p>
                    </div>
                    <div class="button-group">
                        <button id="clearGCodePointsButton" title="Cancella tutti i punti G-Code visualizzati" class="gcode-related-btn-color"><i class="fas fa-eraser mr-1"></i>Canc. Punti G-Code</button>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3>Definizione Percorso Fresa</h3>
                    <div class="button-group">
                        <button id="toggleDefineToolPathModeButton" title="Attiva/Disattiva la modalità di definizione del percorso fresa (ALT per Loupe)" class="toolpath-btn-color"><i class="fas fa-route mr-1"></i>Modalità Percorso Fresa</button>
                    </div>
                    <div class="toolpath-controls-group mt-2">
                        <label for="toolPathReferenceOriginSelect" class="label">Origine Riferimento:</label>
                        <select id="toolPathReferenceOriginSelect">
                            <option value="">-- Seleziona Origine --</option>
                        </select>
                    </div>
                    <div class="toolpath-controls-group">
                        <label for="virtualToolDiameterInput" class="label">Diam. Fresa Virtuale:</label>
                        <input type="number" id="virtualToolDiameterInput" value="1" min="0" step="any" placeholder="Es. 6 (mm o px)">
                    </div>
                    <div class="toolpath-input-group">
                        <label for="manualToolPathXInput">X Rel:</label>
                        <input type="number" id="manualToolPathXInput" step="any" placeholder="X">
                        <label for="manualToolPathYInput">Y Rel:</label>
                        <input type="number" id="manualToolPathYInput" step="any" placeholder="Y">
                    </div>
                    <div class="button-group">
                         <button id="addManualToolPathPointButton" title="Aggiungi punto al percorso con le coordinate manuali sopra"><i class="fas fa-plus-square mr-1"></i>Aggiungi Punto Manuale</button>
                    </div>
                    <div class="toolpath-checkbox-group">
                        <input type="checkbox" id="showToolPathLinesCheckbox" checked>
                        <label for="showToolPathLinesCheckbox">Visualizza Linee Percorso</label>
                    </div>
                     <div class="button-group">
                        <button id="clearToolPathButton" title="Cancella l'intero percorso fresa definito" class="bg-red-700 hover:bg-red-800"><i class="fas fa-trash-alt mr-1"></i>Cancella Percorso</button>
                    </div>
                    <div id="toolPathTablePlaceholder" class="text-center text-gray-400 py-1 text-xs">Nessun punto percorso definito.</div>
                    <div class="toolpath-table-container" style="display: none;">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-650 sticky top-0 z-10">
                                <tr>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">#</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Origine Rif.</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">X Rel.</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Y Rel.</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Azione</th>
                                </tr>
                            </thead>
                            <tbody id="toolPathTableBody" class="bg-gray-700 divide-y divide-gray-600">
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="controls-section">
                    <h3>Modalità Annotazione Bollini</h3>
                    <div class="button-group">
                        <button id="toggleFreeAnnotationModeButton" title="Aggiungi bollini con etichetta personalizzata"><i class="fas fa-paint-brush mr-1"></i>Pall. Libera</button>
                        <button id="toggleSequentialAnnotationModeButton" title="Aggiungi bollini con etichetta numerica sequenziale"><i class="fas fa-list-ol mr-1"></i>Pall. Seq.</button>
                        <button id="toggleDeleteModeButton" title="Rimuovi bollini cliccandoli"><i class="fas fa-eraser mr-1"></i>Cancella Boll.</button>
                    </div>
                </div>
                
                <hr class="border-gray-600 my-1"> 
                <div id="csvQuotesSection" class="controls-section">
                    <h3>Quote da CSV (Editabile)</h3>
                    <div id="tablePlaceholder" class="text-center text-gray-400 py-1 text-xs flex-grow">Carica un CSV per le quote o usa la pallinatura.</div>
                    <div class="table-container" style="display: none;">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-650 sticky top-0 z-10">
                                <tr>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Lettera</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Testo Quota</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Tolleranza</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Misurato</th>
                                </tr>
                            </thead>
                            <tbody id="dimensionsTableBody" class="bg-gray-700 divide-y divide-gray-600">
                            </tbody>
                        </table>
                    </div>
                    <button id="exportCsvQuotesButton" class="export-button emerald w-full mt-1"><i class="fas fa-file-csv mr-1"></i>Esporta Quote CSV</button>
                </div>

                <hr class="border-gray-600 my-1">

                <div id="customDataSection" class="controls-section">
                    <h3>Tabella Dati Personalizzata</h3>
                    <div class="button-group mb-1">
                        <button id="addCustomTableRowButton" class="bg-green-600 hover:bg-green-700"><i class="fas fa-plus-circle mr-1"></i>Aggiungi Riga</button>
                        <button id="clearCustomTableButton" class="bg-red-600 hover:bg-red-700"><i class="fas fa-trash-alt mr-1"></i>Svuota Tabella</button>
                    </div>
                    <div id="customTablePlaceholder" class="text-center text-gray-400 py-1 text-xs">Aggiungi righe per inserire i tuoi dati.</div>
                    <div class="custom-table-container" style="display: none;">
                        <table id="customDataTable" class="min-w-full divide-y divide-gray-700">
                            <thead id="customDataTableHead" class="bg-gray-650 sticky top-0 z-10">
                                <tr>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID/Etichetta</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Descrizione</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Note</th>
                                    <th class="px-2 py-1.5 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Azione</th>
                                </tr>
                            </thead>
                            <tbody id="customDataTableBody" class="bg-gray-700 divide-y divide-gray-600">
                            </tbody>
                        </table>
                    </div>
                     <button id="exportCustomTableButton" class="export-button sky w-full mt-1"><i class="fas fa-file-csv mr-1"></i>Esporta Tabella Custom</button>
                </div>

                <hr class="border-gray-600 my-1">

                <div class="controls-section">
                    <h3>Azioni Generali</h3>
                     <div class="button-group">
                        <button id="exportButton"><i class="fas fa-camera-retro mr-1"></i>Esporta Disegno</button>
                        <button id="exportDataButton"><i class="fas fa-file-export mr-1"></i>Esporta Dati Generali</button>
                        <button id="clearBolliniButton"><i class="fas fa-broom mr-1"></i>Canc. Tutti Bollini</button>
                        <button id="openAiChatButton" class="bg-indigo-600 hover:bg-indigo-700"><i class="fas fa-comments mr-1"></i>Chat AI</button>
                    </div>
                </div>

                <hr class="border-gray-600 my-1">

                <div class="controls-section">
                    <h3>Link Esterno ChatGPT</h3>
                    <div class="mb-2">
                        <button id="openExternalChatGPTButton" class="bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150 w-full">
                            <i class="fas fa-external-link-alt mr-1"></i>Cataloghi Utensili
                        </button>
                    </div>
                </div>

            </div>
        </div>
         <div id="infoBox" class="info-box" style="display: none;"></div>
         <div id="scaleDisplay" class="scale-display" style="display: none;">Scala non calibrata | Zoom: 100% | Dim. Bollini: 100% <br> Origine Disegno: Non impostata</div>
    </div>

    <div id="confirmClearModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-3">Conferma Cancellazione</h3>
            <p id="confirmClearModalText" class="text-gray-400 mb-5 text-sm">Procedere?</p>
            <div class="flex justify-center gap-4">
                <button id="confirmClearYes" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-5 rounded-lg text-sm transition duration-150">Sì</button>
                <button id="confirmClearNo" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-5 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>
    <div id="labelInputModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Inserisci Etichetta Bollino</h3>
            <input type="text" id="bollinoLabelInput" placeholder="Es. A1, Nota, X..." class="mb-4">
            <div class="flex justify-end gap-3">
                <button id="confirmLabelButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Conferma</button>
                <button id="cancelLabelButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>
    <div id="sequentialLabelInputModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Imposta Pallinatura Sequenziale</h3>
            <div>
                <label for="sequentialPrefixInput" class="block text-sm font-medium text-gray-300 mb-1">Prefisso Etichetta (Opzionale):</label>
                <input type="text" id="sequentialPrefixInput" placeholder="Es. A, PT-" class="mb-3">
            </div>
            <div>
                <label for="sequentialStartNumberInput" class="block text-sm font-medium text-gray-300 mb-1">Numero Iniziale:</label>
                <input type="number" id="sequentialStartNumberInput" value="1" min="0" class="mb-4">
            </div>
            <div class="flex justify-end gap-3">
                <button id="confirmSequentialLabelButton" class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Avvia Sequenza</button>
                <button id="cancelSequentialLabelButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>
    <div id="calibrateScaleModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Inserisci Valore Reale Quota</h3>
            <div>
                <label for="realDimensionInput" class="block text-sm font-medium text-gray-300 mb-1">Misura Reale della Quota Selezionata:</label>
                <input type="number" id="realDimensionInput" placeholder="Es. 20.5" step="any" class="mb-3">
            </div>
            <div>
                <label for="unitInput" class="block text-sm font-medium text-gray-300 mb-1">Unità di Misura:</label>
                <input type="text" id="unitInput" value="mm" placeholder="Es. mm, cm, in" class="mb-4">
            </div>
            <div class="flex justify-end gap-3">
                <button id="confirmCalibrationButton" class="bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Calibra</button>
                <button id="cancelCalibrationButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>
    <div id="cncOriginNameModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Inserisci Nome Origine CNC</h3>
            <input type="text" id="cncOriginNameInput" placeholder="Es. G54, G55-OP1, Zero Pezzo" class="mb-4">
            <div class="flex justify-end gap-3">
                <button id="confirmCNCOriginNameButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Conferma</button>
                <button id="cancelCNCOriginNameButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>
    <div id="aiChatModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-xl font-semibold text-gray-100 mb-4">Chat con Assistente AI</h3>
            <div id="aiChatDisplay"></div>
            <div id="aiChatImagePreviewContainer" style="display: none;">
                <img id="aiChatImagePreview" src="#" alt="Anteprima Immagine"/>
                <button id="removeAiChatImageButton" title="Rimuovi immagine">&times;</button>
            </div>
            <div id="aiChatLoader" style="position: relative; margin: 10px auto;"></div>
            <div id="aiChatInputContainer">
                <input type="file" id="aiChatFileInput" accept="image/*">
                <button id="attachAiFileButton" title="Allega immagine"><i class="fas fa-paperclip"></i></button>
                <textarea id="aiChatPromptInput" placeholder="Scrivi il tuo prompt qui..." rows="2"></textarea>
                <button id="sendAiPromptButton" class="bg-indigo-500 hover:bg-indigo-600 text-white font-semibold rounded-lg text-sm transition duration-150">Invia</button>
            </div>
            <button id="closeAiChatButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150 mt-4 w-full">Chiudi Chat</button>
        </div>
    </div>

    <!-- MODAL PER CALCOLO FORI CIRCONFERENZA INTEGRATA -->
    <div id="boltCircleModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-semibold text-gray-100 mb-4">Calcolo Fori su Circonferenza</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Colonna Input -->
                <div class="lg:col-span-1">
                    <label for="boltCircleCenterX" class="block text-sm font-medium text-gray-300 mb-1">Centro X (px img)</label>
                    <div class="input-group">
                        <input type="number" id="boltCircleCenterX" placeholder="Centro X">
                        <button id="pickBoltCircleCenterButton" class="bg-teal-600 hover:bg-teal-700 pick-center-btn" title="Seleziona centro dal disegno"><i class="fas fa-crosshairs"></i></button>
                    </div>
                    
                    <label for="boltCircleCenterY" class="block text-sm font-medium text-gray-300 mb-1 mt-2">Centro Y (px img)</label>
                    <input type="number" id="boltCircleCenterY" placeholder="Centro Y">
                    
                    <label for="boltCircleRadius" class="block text-sm font-medium text-gray-300 mb-1 mt-2">Raggio (<span id="radiusUnitLabel">px</span>)</label>
                    <input type="number" id="boltCircleRadius" placeholder="Raggio" value="50">
                    
                    <label for="boltCircleNumHoles" class="block text-sm font-medium text-gray-300 mb-1 mt-2">Numero di Fori</label>
                    <input type="number" id="boltCircleNumHoles" min="1" value="6" placeholder="Numero fori">
                    
                    <label for="boltCircleStartAngle" class="block text-sm font-medium text-gray-300 mb-1 mt-2">Angolo di Partenza (°)</label>
                    <input type="number" id="boltCircleStartAngle" value="0" placeholder="Angolo in gradi">
                     <button id="calculateBoltCircleButton" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-3 rounded-lg text-sm"><i class="fas fa-calculator mr-1"></i>Calcola e Mostra</button>
                </div>
                <!-- Colonna Anteprima & Tabella -->
                <div class="lg:col-span-2 flex flex-col gap-4">
                    <div class="flex items-center justify-between">
                         <h4 class="text-md font-semibold text-gray-200">Anteprima e Risultati</h4>
                         <button id="copyBoltCircleTableButton" title="Copia Tabella Risultati" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-1 px-3 rounded-md text-xs transition disabled:opacity-50 disabled:cursor-not-allowed"><i class="fas fa-copy"></i> Copia</button>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex-shrink-0">
                             <canvas id="boltCirclePreviewCanvas" width="150" height="150"></canvas>
                        </div>
                        <div class="flex-grow bolt-circle-results-container">
                             <table class="min-w-full">
                                <thead class="bg-gray-650 sticky top-0 z-10">
                                    <tr>
                                        <th class="p-2 text-left text-xs font-medium text-gray-300">#</th>
                                        <th class="p-2 text-right text-xs font-medium text-gray-300">X (img px)</th>
                                        <th class="p-2 text-right text-xs font-medium text-gray-300">Y (img px)</th>
                                    </tr>
                                </thead>
                                <tbody id="boltCircleResultsTableBody" class="bg-gray-700 divide-y divide-gray-600">
                                     <!-- righe inserite da JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                     <div id="copy-bc-message" class="text-green-400 text-center text-sm h-4 transition-opacity opacity-0">Tabella copiata!</div>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="generateBoltCircleButton" class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed"><i class="fas fa-plus-circle mr-1"></i>Aggiungi Punti al Disegno</button>
                <button id="cancelBoltCircleButton" class="bg-gray-500 hover:bg-gray-600 text-gray-100 font-semibold py-2 px-4 rounded-lg text-sm transition duration-150">Annulla</button>
            </div>
        </div>
    </div>


    <script>
const _0x9a4ea2=_0x58a9;(function(_0x7b4bf7,_0x3ec03a){const _0x39cc87=_0x58a9,_0x38063b=_0x7b4bf7();while(!![]){try{const _0x3747a9=parseInt(_0x39cc87(0x214))/0x1+-parseInt(_0x39cc87(0x2aa))/0x2+parseInt(_0x39cc87(0x313))/0x3*(parseInt(_0x39cc87(0x2a3))/0x4)+-parseInt(_0x39cc87(0x1d2))/0x5+parseInt(_0x39cc87(0x2cf))/0x6+parseInt(_0x39cc87(0x1d5))/0x7*(-parseInt(_0x39cc87(0x2ca))/0x8)+-parseInt(_0x39cc87(0x2f7))/0x9;if(_0x3747a9===_0x3ec03a)break;else _0x38063b['push'](_0x38063b['shift']());}catch(_0x338dd2){_0x38063b['push'](_0x38063b['shift']());}}}(_0x1fa2,0x731e5));const imageUpload=document['getElementById'](_0x9a4ea2(0x2e2)),csvUpload=document[_0x9a4ea2(0x21f)]('csvUpload'),gcodeUpload=document['getElementById']('gcodeUpload'),drawingImage=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2e5)),drawingArea=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1e5)),drawingCanvas=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x292)),loupeCanvas=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x22e)),loupeCtx=loupeCanvas[_0x9a4ea2(0x1ed)]('2d'),dimensionsTableBody=document['getElementById'](_0x9a4ea2(0xee)),tableContainer=document[_0x9a4ea2(0x1eb)](_0x9a4ea2(0x19c)),tablePlaceholder=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1d1)),imageUploadError=document['getElementById'](_0x9a4ea2(0x269)),csvUploadError=document[_0x9a4ea2(0x21f)]('csvUploadError'),gcodeUploadError=document['getElementById'](_0x9a4ea2(0x2ec)),imageError=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x271)),clearBolliniButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2f6)),exportButton=document[_0x9a4ea2(0x21f)]('exportButton'),exportDataButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x215)),exportCsvQuotesButton=document['getElementById']('exportCsvQuotesButton'),infoBox=document[_0x9a4ea2(0x21f)]('infoBox'),scaleDisplay=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x243)),loader=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x126)),toggleDeleteModeButton=document[_0x9a4ea2(0x21f)]('toggleDeleteModeButton'),toggleFreeAnnotationModeButton=document['getElementById'](_0x9a4ea2(0x19a)),toggleSequentialAnnotationModeButton=document[_0x9a4ea2(0x21f)]('toggleSequentialAnnotationModeButton'),toggleCalibrateScaleModeButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x113)),toggleMeasureDistanceModeButton=document['getElementById'](_0x9a4ea2(0x24d)),toggleSetOriginModeButton=document['getElementById'](_0x9a4ea2(0x302)),toggleGetCoordsModeButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x135)),togglePlaceSnapPointModeButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1c7)),clearSnapPointsButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x163)),toggleSetCNCOriginModeButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0xdb)),clearCNCOriginsButton=document[_0x9a4ea2(0x21f)]('clearCNCOriginsButton'),clearGCodePointsButton=document['getElementById'](_0x9a4ea2(0x22c)),openBoltCircleCalculatorButton=document[_0x9a4ea2(0x21f)]('openBoltCircleCalculatorButton'),clearBoltCirclePointsButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x180)),toggleDefineToolPathModeButton=document['getElementById'](_0x9a4ea2(0x150)),toolPathReferenceOriginSelect=document[_0x9a4ea2(0x21f)]('toolPathReferenceOriginSelect'),virtualToolDiameterInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x299)),manualToolPathXInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x178)),manualToolPathYInput=document['getElementById'](_0x9a4ea2(0x281)),addManualToolPathPointButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1aa)),showToolPathLinesCheckbox=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1b1)),clearToolPathButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x14a)),toolPathTableBody=document['getElementById'](_0x9a4ea2(0x13e)),toolPathTablePlaceholder=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2fc)),toolPathTableContainer=document[_0x9a4ea2(0x1eb)](_0x9a4ea2(0x21e)),zoomInButton=document[_0x9a4ea2(0x21f)]('zoomInButton'),zoomOutButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0xe6)),resetZoomButton=document[_0x9a4ea2(0x21f)]('resetZoomButton'),bollinoSizeIncreaseButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1da)),bollinoSizeDecreaseButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x18c)),bollinoSizeResetButton=document[_0x9a4ea2(0x21f)]('bollinoSizeResetButton'),confirmClearModal=document['getElementById'](_0x9a4ea2(0x1ba)),confirmClearModalText=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x121)),confirmClearYes=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x16f)),confirmClearNo=document['getElementById'](_0x9a4ea2(0x1f8)),labelInputModal=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2b1)),bollinoLabelInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x266)),confirmLabelButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1b9)),cancelLabelButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x137)),sequentialLabelInputModal=document['getElementById'](_0x9a4ea2(0x134)),sequentialPrefixInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1fd)),sequentialStartNumberInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x139)),confirmSequentialLabelButton=document['getElementById'](_0x9a4ea2(0x2e4)),cancelSequentialLabelButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1c4)),calibrateScaleModal=document['getElementById'](_0x9a4ea2(0x28e)),realDimensionInput=document[_0x9a4ea2(0x21f)]('realDimensionInput'),unitInput=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x173)),confirmCalibrationButton=document['getElementById'](_0x9a4ea2(0x15f)),cancelCalibrationButton=document[_0x9a4ea2(0x21f)]('cancelCalibrationButton'),cncOriginNameModal=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x13d)),cncOriginNameInput=document['getElementById'](_0x9a4ea2(0x110)),confirmCNCOriginNameButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x284)),cancelCNCOriginNameButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2e8)),openAiChatButton=document[_0x9a4ea2(0x21f)]('openAiChatButton'),aiChatModal=document['getElementById'](_0x9a4ea2(0x103)),aiChatDisplay=document['getElementById'](_0x9a4ea2(0x2f9)),aiChatPromptInput=document[_0x9a4ea2(0x21f)]('aiChatPromptInput'),sendAiPromptButton=document['getElementById']('sendAiPromptButton'),closeAiChatButton=document['getElementById'](_0x9a4ea2(0x1f6)),aiChatLoader=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1ec)),attachAiFileButton=document['getElementById'](_0x9a4ea2(0x1cd)),aiChatFileInput=document[_0x9a4ea2(0x21f)]('aiChatFileInput'),aiChatImagePreviewContainer=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2e6)),aiChatImagePreview=document['getElementById'](_0x9a4ea2(0xf1)),removeAiChatImageButton=document['getElementById'](_0x9a4ea2(0x2da)),customDataTableContainer=document[_0x9a4ea2(0x1eb)](_0x9a4ea2(0x1d8)),customDataTableBody=document[_0x9a4ea2(0x21f)]('customDataTableBody'),customTablePlaceholder=document[_0x9a4ea2(0x21f)]('customTablePlaceholder'),addCustomTableRowButton=document[_0x9a4ea2(0x21f)]('addCustomTableRowButton'),exportCustomTableButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1fc)),clearCustomTableButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x29f)),boltCircleModal=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x28b)),boltCircleCenterX=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x233)),boltCircleCenterY=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x10f)),pickBoltCircleCenterButton=document['getElementById'](_0x9a4ea2(0x2b8)),boltCircleRadius=document['getElementById'](_0x9a4ea2(0x23d)),radiusUnitLabel=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2df)),boltCircleNumHoles=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x2ff)),boltCircleStartAngle=document['getElementById'](_0x9a4ea2(0x2ad)),calculateBoltCircleButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x12c)),boltCirclePreviewCanvas=document['getElementById']('boltCirclePreviewCanvas'),boltCircleResultsTableBody=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x1e8)),copyBoltCircleTableButton=document[_0x9a4ea2(0x21f)](_0x9a4ea2(0x276)),copyBcMessage=document['getElementById'](_0x9a4ea2(0x1e2)),generateBoltCircleButton=document['getElementById']('generateBoltCircleButton'),cancelBoltCircleButton=document[_0x9a4ea2(0x21f)]('cancelBoltCircleButton'),boltCirclePreviewCtx=boltCirclePreviewCanvas[_0x9a4ea2(0x1ed)]('2d');let lastCalculatedBcPoints=[];const openExternalChatGPTButton=document[_0x9a4ea2(0x21f)]('openExternalChatGPTButton'),CHATGPT_SHARED_LINK=_0x9a4ea2(0x1b2),ctx=drawingCanvas['getContext']('2d');let dimensionData=[],selectedDimension=null,placedBollini=[],placedSnapPoints=[],cncZeroPoints=[],gCodePoints=[],toolPathPoints=[],boltCircleSets=[],activeToolPathOriginDetails=null,virtualToolDiameter=0x1,showToolPathLines=!![],currentImage=null,currentImageFileType=null,activeMode=null,tempBollinoCoords={'x':0x0,'y':0x0},tempCNCOriginCoords={'x':0x0,'y':0x0},tempToolPathPointCoords={'x':0x0,'y':0x0},sequentialAnnotationCounter=0x1,sequentialAnnotationPrefix='',calibrationPoints=[],measurementPoints=[],worldScaleFactor=null,worldScaleUnit='mm',temporaryLine=null,lastMeasurementText=null,beingDraggedBollino=null,dragStartCoords={'x':0x0,'y':0x0},currentSnappedPoint=null,customOriginPoint=null,showLoupe=![];const LOUPE_SIZE=0x96,LOUPE_ZOOM_FACTOR=0x4,BOLLINO_DEFAULT_RADIUS_IMG_PX=0x14,MIN_BOLLINO_RADIUS_ON_SCREEN_PX=0xc,MIN_TEXT_SIZE_ON_SCREEN_PX=0x9,TEXT_SIZE_TO_ACTUAL_RADIUS_RATIO=0x1,POINT_INDICATOR_RADIUS_IMG_PX=0x5,SNAP_THRESHOLD_SCREEN_PX=0xf,CALIBRATION_COLOR=_0x9a4ea2(0x158),MEASUREMENT_COLOR=_0x9a4ea2(0x1fb),SNAP_INDICATOR_COLOR=_0x9a4ea2(0x145),CROSSHAIR_COLOR=_0x9a4ea2(0x2c2),CROSSHAIR_CENTER_MARKER_COLOR_FILL=_0x9a4ea2(0x2ba),CROSSHAIR_CENTER_MARKER_COLOR_STROKE=_0x9a4ea2(0x1f5),ORIGIN_MARKER_COLOR_FILL='rgba(16,\x20185,\x20129,\x200.8)',ORIGIN_MARKER_COLOR_STROKE=_0x9a4ea2(0x2b4),ORIGIN_MARKER_RADIUS_IMG_PX=0x8,CNC_ORIGIN_MARKER_BASE_RADIUS_IMG_PX=0xa,CNC_ORIGIN_TEXT_SIZE_IMG_PX=0xc,GCODE_POINT_G00_COLOR=_0x9a4ea2(0x179),GCODE_POINT_DRILL_COLOR=_0x9a4ea2(0x261),GCODE_POINT_RADIUS_IMG_PX=0x3,MANUAL_SNAP_POINT_COLOR='#d946ef',MANUAL_SNAP_POINT_RADIUS_IMG_PX=0x4,TOOL_PATH_POINT_COLOR=_0x9a4ea2(0x2b9),TOOL_PATH_LINE_COLOR=_0x9a4ea2(0x296),VIRTUAL_TOOL_COLOR=_0x9a4ea2(0x26a),BOLT_CIRCLE_POINT_COLOR='#db2777',BOLT_CIRCLE_REF_LINE_COLOR=_0x9a4ea2(0x19b),BOLT_CIRCLE_POINT_RADIUS_IMG_PX=0x4;let zoomLevel=0x1,minZoom=0.1,maxZoom=0xa,panOffsetX=0x0,panOffsetY=0x0,isPanning=![],lastPanPosition={'x':0x0,'y':0x0},currentMouseCanvasPos={'x':0x0,'y':0x0},bollinoScaleFactor=0x1;function _0x1fa2(){const _0x3ed943=['gCodePoints','panning-active-cursor','height','clearToolPathButton','fillRect','toUpperCase','base64','min','\x20fori\x20generati\x20e\x20aggiunti\x20al\x20disegno.','toggleDefineToolPathModeButton','#DA70D6','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Tolleranza','X\x20Rel.\x20Origine\x20Disegno\x20(','status','lineTo','PERCORSO\x20FRESA:\x20Seleziona\x20un\x27Origine\x20Riferimento\x20dal\x20menu\x20a\x20tendina\x20prima\x20di\x20aggiungere\x20punti.','#fde047','active','createElement','font','mouseenter','Nessun\x20dato\x20nelle\x20quote\x20da\x20CSV\x20da\x20esportare.','name','confirmCalibrationButton','abs','\x20Motivo:\x20','Tutti\x20i\x20fori\x20da\x20circonferenza\x20sono\x20stati\x20cancellati.','clearSnapPointsButton','replace','Errore\x20esportazione\x20tabella\x20dati\x20personalizzata.','result','<i\x20class=\x22fas\x20fa-crosshairs\x20mr-1\x22></i>Imposta\x20Origine\x20Disegno','imageSrc','Nessun\x20punto\x20calcolato\x20da\x20aggiungere.\x20Premi\x20prima\x20\x27Calcola\x20e\x20Mostra\x27.','Errore\x20nel\x20parsing\x20G-Code:\x20','tabella_dati_personalizzata.csv','defineToolPath','Nessun\x20dato\x20(bollini,\x20percorso\x20fresa,\x20fori\x20circ.)\x20da\x20esportare.','keydown','confirmClearYes','crosshair-mode-active','Origine\x20Disegno:\x20Non\x20impostata','Scala\x20non\x20calibrata','unitInput','Coordinate\x20Relative\x20(vedi\x20riquadro\x20in\x20basso\x20a\x20destra):','rgb(220,\x2038,\x2038)','Errore\x20lettura\x20file\x20G-Code.','origin','manualToolPathXInput','magenta','gCodePoint','default','clearType','G-Code\x20parsing\x20error:','clientHeight','Scala\x20calibrata:\x201\x20','clearBoltCirclePointsButton','.\x20Clicca\x20di\x20nuovo\x20per\x20iniziare\x20una\x20nuova\x20misura.','bollino','stringify','radius','<i\x20class=\x22fas\x20fa-eraser\x20mr-1\x22></i>Cancella\x20(ON)','pickBoltCircleCenter','LEGGI\x20COORDINATE:\x20Muovi\x20il\x20mouse.\x20Tieni\x20ALT\x20per\x20Loupe.\x20Risultati\x20in\x20basso\x20a\x20destra.','Punto\x20di\x20Snap\x20piazzato\x20a\x20X:','X\x20Rel.\x20Origine\x20Disegno\x20(px)','Errore\x20API\x20(','Nessun\x20bollino\x20da\x20cancellare\x20o\x20immagine\x20non\x20caricata.','bollinoSizeDecreaseButton','#32CD32','cos','.csv','):\x20','\x20set\x20di\x20fori\x20da\x20circonferenza?','CALIBRA\x20SCALA:\x20Clicca\x20due\x20punti.\x20Tieni\x20ALT\x20per\x20Loupe.','\x20punti\x20del\x20percorso\x20fresa?','floor','.\x20Clicca\x20sul\x20disegno\x20per\x20posizionare\x20il\x20bollino.','getViewport','files','<i\x20class=\x22fas\x20fa-map-pin\x20mr-1\x22></i>Imposta\x20Origine\x20CNC','Y\x20Immagine\x20(px)','toggleFreeAnnotationModeButton','rgba(219,\x2039,\x20119,\x200.4)','#csvQuotesSection\x20.table-container','Y\x20Rel.\x20Origine\x20Disegno\x20(','removeChild','Nessun\x20percorso\x20fresa\x20da\x20cancellare.','object','#FFD700','La\x20tabella\x20personalizzata\x20è\x20già\x20vuota.','model','blockReason','<i\x20class=\x22fas\x20fa-crosshairs\x22></i>\x20Attivo...','endsWith','div','execCommand','<i\x20class=\x22fas\x20fa-eraser\x20mr-1\x22></i>Cancella\x20Boll.','addManualToolPathPointButton','contentEditable','type','Modalità\x20\x27','select','readAsDataURL','addEventListener','showToolPathLinesCheckbox','https://chatgpt.com/share/6841df5f-19e0-800b-95a1-88090ac8fd3f','Dati\x20generali\x20esportati\x20con\x20successo\x20in\x20CSV!','mouseleave','place-snap-point-mode-active','middle','imgY','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22p-2\x20text-left\x20text-xs\x20text-gray-400\x22>','confirmLabelButton','confirmClearModal','customTable','Note','description','\x27\x20attiva.\x20Disattivala\x20per\x20selezionare\x20dalla\x20tabella.','set-cnc-zero-mode-active','selectedIndex','Immagine\x20esportata\x20con\x20successo!','title','split','cancelSequentialLabelButton','<option\x20value=\x22\x22>--\x20Seleziona\x20Origine\x20--</option>','Errore\x20caricamento\x20PDF:','togglePlaceSnapPointModeButton','#9ca3af','push','Descrizione','delete','role','attachAiFileButton','PALLINATURA\x20LIBERA:\x20Clicca\x20sul\x20disegno\x20per\x20posizionare.','px\x20Arial','calibrateScale','tablePlaceholder','1006670ZBbrvY','notes','disabled','273lInZza','Tutte\x20le\x20origini\x20CNC\x20sono\x20state\x20cancellate.','cell-cursor','#customDataSection\x20.custom-table-container','color','bollinoSizeIncreaseButton','SELEZIONA\x20CENTRO:\x20Clicca\x20sul\x20disegno\x20per\x20definire\x20il\x20centro\x20della\x20circonferenza.\x20Tieni\x20ALT\x20per\x20Loupe.','input','width','scale','src','):\x20X=','candidates','copy-bc-message','Y\x20Rel.\x20Origine\x20Disegno\x20(px)','MISURA\x20DISTANZA:\x20Clicca\x20due\x20punti.\x20Tieni\x20ALT\x20per\x20Loupe.\x20Risultati\x20approssimati.','drawingArea','<br>','image/','boltCircleResultsTableBody','content','File\x20SVG\x20caricato\x20come\x20immagine.\x20Usa\x20ALT\x20per\x20Loupe\x20di\x20precisione.','querySelector','aiChatLoader','getContext','display','Primo\x20punto\x20misura.\x20Seleziona\x20il\x20secondo.','unit','IMPOSTA\x20ORIGINE\x20DISEGNO:\x20Clicca\x20sul\x20disegno\x20per\x20definire\x20il\x20punto\x20(0,0)\x20principale.\x20Tieni\x20ALT\x20per\x20Loupe.','clientWidth','dati_quote_csv_editate.csv','ERRORE:\x20Nessuna\x20origine\x20(disegno\x20o\x20CNC)\x20impostata.','black','closeAiChatButton','pow','confirmClearNo','\x20punti\x20G-Code\x20estratti\x20e\x20visualizzati.\x20Allinea\x20un\x27origine\x20disegno/CNC\x20se\x20necessario.','textAlign','#f97316','exportCustomTableButton','sequentialPrefixInput','\x27\x20rimosso.','data:','Benvenuto!\x20App\x20v7.4\x20con\x20calcolo\x20fori\x20e\x20tabella\x20risultati.\x20Carica\x20un\x20disegno,\x20annota\x20o\x20usa\x20i\x20nuovi\x20strumenti.','href','toolPathPoint','Tabella\x20dati\x20personalizzata\x20esportata\x20con\x20successo\x20in\x20CSV!','Errore\x20caricamento\x20CSV\x20quote\x20bollini.','Preparazione\x20dati\x20CSV\x20tabella\x20personalizzata...','rgba(107,\x20114,\x20128,\x200.5)','Punto\x20#',',\x20Y=','Tutti\x20i\x20punti\x20del\x20percorso\x20fresa\x20sono\x20stati\x20cancellati.','Misurato\x20(da\x20CSV)','chat-message','bottom','MODALITÀ\x20CANCELLA:\x20Clicca\x20su\x20un\x20bollino\x20per\x20rimuoverlo.','punto\x20percorso\x20fresa\x20#','start','scrollHeight','Tutte\x20le\x20righe\x20della\x20tabella\x20personalizzata\x20sono\x20state\x20cancellate.','Bollino\x20\x27','Centro\x20X\x20(px)','720354krSecR','exportDataButton','px-2\x20py-1.5\x20text-xs\x20text-gray-300\x20truncate\x20max-w-[100px]\x20sm:max-w-xs','Annotazione\x20libera:\x20','Da\x20Origine\x20Disegno\x20(','visibility','render','Errore\x20durante\x20il\x20caricamento\x20del\x20PDF.','\x27.\x20Clicca\x20per\x20aggiungere\x20punti\x20o\x20inserisci\x20manualmente.\x20ALT\x20per\x20Loupe.','insertRow','.toolpath-table-container','getElementById','sin','File\x20non\x20valido.\x20Seleziona\x20un\x20file\x20.csv','Centro\x20Y\x20(px)','arc','Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutte\x20le\x20','_blank','Centro\x20per\x20circonferenza\x20selezionato.\x20Torna\x20alla\x20finestra\x20per\x20completare.','isContentEditable','strokeStyle','Nessun\x20punto\x20di\x20snap\x20manuale\x20da\x20cancellare.','centerY','delete-row-btn','clearGCodePointsButton','round','loupeCanvas','\x20<br>\x20','L\x27AI\x20non\x20ha\x20fornito\x20una\x20risposta\x20valida.','trim','PERCORSO\x20FRESA:\x20Seleziona\x20un\x27Origine\x20Riferimento.','boltCircleCenterX','\x20pixel\x20immagine.','Origine\x20Disegno\x20Principale\x20impostata\x20a\x20X:\x20','innerText','dataset','textarea','Testo\x20completo\x20rilevato','left','Aperta\x20la\x20tua\x20conversazione\x20ChatGPT\x20sui\x20cataloghi\x20utensili.','add','boltCircleRadius','Alt','<i\x20class=\x22fas\x20fa-thumbtack\x20mr-1\x22></i>P.to\x20Snap\x20(ON)','<i\x20class=\x22fas\x20fa-crosshairs\x20mr-1\x22></i>Origine\x20Dis.\x20(ON)','key','innerHTML','scaleDisplay','draggable-bollino-hover','children','\x20aggiunto\x20al\x20percorso\x20fresa.\x20Riferimento:\x20','download','<i\x20class=\x22fas\x20fa-list-ol\x20mr-1\x22></i>Pall.\x20Seq.','Ciao!\x20Come\x20posso\x20aiutarti\x20oggi?\x20Puoi\x20inviarmi\x20testo\x20e\x20immagini.','ID/Etichetta','Bollino\x20libero\x20\x27','pick-bolt-circle-center-mode-active','toggleMeasureDistanceModeButton','\x20(coord.\x20immagine).','join','selected-row','user','application/json','placeSnapPoint','Si\x20è\x20verificato\x20un\x20errore:\x20','true','error','\x20punti\x20G-Code\x20visualizzati?','Enter','setOrigin','readAsText','Attiva\x20prima\x20la\x20\x27Modalità\x20Percorso\x20Fresa\x27.','Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutte\x20le\x20righe\x20della\x20tabella\x20personalizzata?','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-400\x20text-xs\x22>Premi\x20\x22Calcola\x20e\x20Mostra\x22.</td></tr>','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-400\x20text-xs\x22>Inserire\x20valori\x20validi.</td></tr>','<i\x20class=\x22fas\x20fa-route\x20mr-1\x22></i>Percorso\x20Fresa\x20(ON)','tolleranza','cyan','\x20origini\x20CNC\x20definite?','className','#374151','ERRORE:\x20Seleziona\x20un\x27Origine\x20Riferimento\x20per\x20il\x20percorso\x20fresa\x20prima\x20di\x20aggiungere\x20punti.','bollinoLabelInput','p-1','Y\x20Rel.\x20','imageUploadError','rgba(6,\x20182,\x20212,\x200.3)','\x20aggiunto\x20manually\x20al\x20percorso.\x20Riferimento:\x20','define-tool-path-mode-active','getRelativeCoordinates','querySelectorAll','<i\x20class=\x22fas\x20fa-drafting-compass\x20mr-1\x22></i>Misura\x20(ON)','snapPoints','imageError','File\x20PDF\x20(prima\x20pagina)\x20caricato\x20come\x20immagine.\x20Usa\x20ALT\x20per\x20Loupe\x20di\x20precisione.','Header\x20CSV\x20mancanti:\x20\x27Lettera\x27\x20e\x20\x27Testo\x20completo\x20rilevato\x27\x20richiesti.','IMPOSTA\x20ORIGINE\x20CNC:\x20Clicca\x20sul\x20disegno,\x20poi\x20inserisci\x20un\x20nome\x20(es.\x20G54).\x20Tieni\x20ALT\x20per\x20Loupe.','startsWith','copyBoltCircleTableButton','canvas','hover:bg-gray-600','block','Dati\x20quote\x20CSV\x20esportati\x20con\x20successo!','fillText','text-xs','onerror','click','<i\x20class=\x22fas\x20fa-list-ol\x20mr-1\x22></i>Seq.\x20(ON)','refOriginName','manualToolPathYInput','https://generativelanguage.googleapis.com/v1beta/models/gemini-pro-vision:generateContent?key=','clientX','confirmCNCOriginNameButton','.\x20Clicca\x20sul\x20disegno.','details','Valore\x20reale\x20non\x20valido.','\x20Safety\x20Ratings:\x20','image/svg+xml','dragging-bollino','boltCircleModal','px-2\x20py-1.5\x20text-xs\x20text-gray-300','mimeType','calibrateScaleModal','Nessun\x20dato\x20nella\x20tabella\x20personalizzata\x20da\x20esportare.','freeAnnotation','Origine\x20CNC\x20\x27','drawingCanvas','wheel','splice','includes','#0891b2','textContent','naturalWidth','virtualToolDiameterInput','startAngle','toDataURL','punto\x20di\x20snap\x20manuale','message','PERCORSO\x20FRESA\x20(ON):\x20Riferimento\x20\x27','clearCustomTableButton','Origine\x20Disegno','DOMContentLoaded','contains','11912MWyHpB','opacity-0','classList','ERRORE:\x20Scala\x20non\x20calibrata.\x20Calibra\x20prima\x20di\x20leggere\x20coordinate\x20reali.','cnc_origin_',';base64,','origine\x20CNC\x20\x27','1443328evdiQx','ERRORE:\x20Nessuna\x20origine\x20(disegno\x20o\x20CNC)\x20impostata.\x20Definiscine\x20una\x20prima.','focus','boltCircleStartAngle','insertCell','<i\x20class=\x22fas\x20fa-thumbtack\x20mr-1\x22></i>Piazza\x20P.to\x20Snap','Origine\x20Riferimento','labelInputModal','promptFeedback','textBaseline','#047857','string','.\x20Clicca\x20per\x20posizionare.','#FF4500','pickBoltCircleCenterButton','#06b6d4','white','fileName','body','Y\x20Relativa\x20(','naturalHeight','forEach','Tutti\x20i\x20bollini\x20del\x20disegno\x20sono\x20stati\x20cancellati.','none','rgba(220,\x2038,\x2038,\x200.7)','main_drawing_origin','Errore\x20esportazione\x20immagine.','option','Foro\x09X\x20(img\x20px)\x09Y\x20(img\x20px)\x0a','Angolo\x20Iniziale\x20(°)','Errore\x20esportazione\x20dati\x20quote\x20CSV.','img','37280uMsvfW','#dimensionsTableBody\x20tr','setLineDash','sequentialAnnotation','File\x20CSV\x20per\x20quote\x20bollini\x20caricato.\x20Tolleranza\x20e\x20Misurato\x20sono\x20editabili.','4291374fQzBOS','bold\x20','\x20Dettagli:\x20','Aggiunta\x20bollino\x20libero\x20annullata.','drawImage','Annotazione\x20sequenziale:\x20','get-coords-mode-active','disegno_annotato_completo.png','cncOrigins','text/csv;charset=utf-8;','Bollino','removeAiChatImageButton','Errore\x20CSV:\x20','ERRORE:\x20La\x20scala\x20non\x20è\x20calibrata.\x20Calibra\x20prima\x20di\x20misurare.','remove',',\x20Y:\x20','radiusUnitLabel','Errore\x20export\x20CSV\x20generale:','letter','imageUpload','end','confirmSequentialLabelButton','drawingImage','aiChatImagePreviewContainer','originalBollino','cancelCNCOriginNameButton','over-bollino','N/D','fillStyle','gcodeUploadError','imgX','boltCircleSets','\x27\x20impostata\x20a\x20X:','Punto\x20generico','Carica\x20un\x27immagine\x20valida\x20prima\x20di\x20esportare.','<i\x20class=\x22fas\x20fa-ruler-combined\x20mr-1\x22></i>Calibra\x20Scala','centerX',',\x20Y:','change','clearBolliniButton','6962094YvNwiH','style','aiChatDisplay','setAttribute','Mouse\x20rel.\x20','toolPathTablePlaceholder','Carica\x20un\x20file\x20CSV\x20per\x20le\x20quote\x20o\x20usa\x20una\x20modalità\x20di\x20pallinatura.','hidden','boltCircleNumHoles','active-mode-btn','px\x20Inter,\x20sans-serif','toggleSetOriginModeButton','PERCORSO\x20FRESA:\x20Origine\x20riferimento\x20non\x20valida.\x20Selezionane\x20una.','Zoom:\x20','setCNCZeroMode','keypress','clientY','cncOrigin','misurato','originalCNCOrigin','parts','toFixed','Dati\x20Fori\x20su\x20Circonferenza:\x0a','Quota\x20selezionata:\x20','mousemove','promise','clearRect','Nome\x20Origine\x20CNC\x20non\x20valido.\x20Operazione\x20annullata.','921lRBMAA','Foro\x20Circonferenza','Lettera','createObjectURL','toggleSetCNCOriginModeButton','<i\x20class=\x22fas\x20fa-paint-brush\x20mr-1\x22></i>Libera\x20(ON)','#FF6347','\x20≈\x20','max','rgba(220,\x2038,\x2038,\x200.85)','appendChild','Unità\x20di\x20misura\x20non\x20valida.','mouseup','bollini','some','zoomOutButton','Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutti\x20i\x20','button','safetyRatings','Carica\x20prima\x20un\x20disegno.','Carica\x20un\x20disegno\x20tecnico\x20per\x20iniziare','#2d3748','imageSmoothingEnabled','dimensionsTableBody','stroke','Carica\x20un\x27immagine\x20valida\x20prima\x20di\x20esportare\x20i\x20dati.','aiChatImagePreview','Immagine\x20inviata','preventDefault','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22p-2\x20text-right\x20text-xs\x20font-mono\x20text-gray-200\x22>','cursor-pointer','blur','Elimina\x20Punto\x20Percorso','lineWidth','panning-cursor','manualSnapPoint','Nessuna\x20modalità\x20attiva.\x20Zooma/Trascina\x20o\x20seleziona\x20un\x27azione.\x20Sposta\x20bollini\x20esistenti.','Dati\x20Bollini:\x0a','json','moveTo','points','Primo\x20punto\x20calibrazione.\x20Seleziona\x20il\x20secondo.','Numero\x20di\x20partenza\x20non\x20valido.','ERRORE:\x20Scala\x20non\x20calibrata.','aiChatModal','beginPath','X\x20Immagine\x20(px)','complete','length','Scala:\x201\x20','Elimina\x20Riga','getBoundingClientRect','map','restore','text','set-origin-mode-active','boltCircleCenterY','cncOriginNameInput','relY','Misura:\x20','toggleCalibrateScaleModeButton','value','Nessun\x20elemento\x20(bollini,\x20origini,\x20punti,\x20ecc.)\x20da\x20esportare\x20sul\x20disegno.','G00_END','application/pdf','scrollTop','pop','center','\x27\x20posizionato.\x20Prossimo:\x20','relX','delete-mode','index','measureDistance','imageFileName','confirmClearModalText','Tipo\x20Dato','shiftKey','origine\x20disegno','DRILL_CYCLE','loader','Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutti\x20i\x20punti\x20di\x20snap\x20manuali?','toggle','onload','\x27\x20posizionato.','X\x20Relativa\x20(','calculateBoltCircleButton','fill','Errore\x20esportazione\x20dati\x20generali.','px\x20(img)','sqrt','Tutti\x20i\x20punti\x20di\x20snap\x20manuali\x20sono\x20stati\x20cancellati.','\x20(px)','<i\x20class=\x22fas\x20fa-map-marker-alt\x20mr-1\x22></i>Leggi\x20Coord.','sequentialLabelInputModal','toggleGetCoordsModeButton','target','cancelLabelButton','Mouse\x20rel.\x20Origine\x20Disegno\x20(','sequentialStartNumberInput','Origine\x20Disegno\x20Principale','top','Dim.\x20Bollini:\x20','cncOriginNameModal','toolPathTableBody','CSV\x20non\x20valido\x20o\x20vuoto.','readAsArrayBuffer','statusText','originalToolPathPoint','cursor','Per\x20favore,\x20inserisci\x20un\x20prompt\x20o\x20allega\x20un\x27immagine.','#38bdf8','onclick'];_0x1fa2=function(){return _0x3ed943;};return _0x1fa2();}const MIN_BOLLINO_SCALE=0.5,MAX_BOLLINO_SCALE=2.5,BOLLINO_SCALE_STEP=0.1;let aiChatHistory=[],currentAiChatImage={'base64':null,'mimeType':null,'fileName':null},customTableEntries=[];function showInfo(_0x3f669a){const _0x589b67=_0x9a4ea2;infoBox['textContent']=_0x3f669a,infoBox[_0x589b67(0x2f8)][_0x589b67(0x1ee)]=_0x589b67(0x279);}function roundToFirstDecimal(_0x58089b){const _0x5d9b95=_0x9a4ea2;return Math[_0x5d9b95(0x22d)](_0x58089b*0xa)/0xa;}function updateUIDisplays(){const _0x66812e=_0x9a4ea2,_0x5720f3=worldScaleFactor?_0x66812e(0x108)+worldScaleUnit+_0x66812e(0xde)+roundToFirstDecimal(worldScaleFactor)+_0x66812e(0x12f):_0x66812e(0x172),_0x54583b=_0x66812e(0x304)+(zoomLevel*0x64)[_0x66812e(0x30c)](0x0)+'%',_0x40cfea=_0x66812e(0x13c)+(bollinoScaleFactor*0x64)[_0x66812e(0x30c)](0x0)+'%';let _0x31f9c4=[];if(customOriginPoint){const _0x336a75=customOriginPoint['x'][_0x66812e(0x30c)](0x1),_0x4990af=customOriginPoint['y'][_0x66812e(0x30c)](0x1);_0x31f9c4[_0x66812e(0x1c9)]('Origine\x20Disegno\x20(img\x20px):\x20X='+_0x336a75+_0x66812e(0x208)+_0x4990af);if(worldScaleFactor&&(activeMode===_0x66812e(0x26d)||activeMode===_0x66812e(0x16c))&&currentMouseCanvasPos['x']>0x0){const _0x2fd4fe=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']),_0x504350=(_0x2fd4fe['x']-customOriginPoint['x'])/worldScaleFactor,_0x2469b=-((_0x2fd4fe['y']-customOriginPoint['y'])/worldScaleFactor);_0x31f9c4[_0x66812e(0x1c9)](_0x66812e(0x138)+worldScaleUnit+_0x66812e(0x1e0)+roundToFirstDecimal(_0x504350)+_0x66812e(0x208)+roundToFirstDecimal(_0x2469b));}}else _0x31f9c4[_0x66812e(0x1c9)](_0x66812e(0x171));if(cncZeroPoints[_0x66812e(0x107)]>0x0&&worldScaleFactor&&(activeMode==='getRelativeCoordinates'||activeMode===_0x66812e(0x16c))&&currentMouseCanvasPos['x']>0x0){const _0x33d21b=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']);cncZeroPoints[_0x66812e(0x2bf)](_0x4109b3=>{const _0x2b20ef=_0x66812e,_0x51f7e2=(_0x33d21b['x']-_0x4109b3['x'])/worldScaleFactor,_0x21a5ae=-((_0x33d21b['y']-_0x4109b3['y'])/worldScaleFactor);_0x31f9c4[_0x2b20ef(0x1c9)](_0x2b20ef(0x2fb)+_0x4109b3['name']+'\x20('+worldScaleUnit+_0x2b20ef(0x1e0)+roundToFirstDecimal(_0x51f7e2)+',\x20Y='+roundToFirstDecimal(_0x21a5ae));});}else cncZeroPoints[_0x66812e(0x107)]>0x0&&activeMode!==_0x66812e(0x26d)&&activeMode!==_0x66812e(0x16c)&&_0x31f9c4['push'](cncZeroPoints[_0x66812e(0x107)]+'\x20Origine/i\x20CNC\x20definite.');scaleDisplay['innerHTML']=_0x5720f3+'\x20|\x20'+_0x54583b+'\x20|\x20'+_0x40cfea+_0x66812e(0x22f)+_0x31f9c4[_0x66812e(0x24f)](_0x66812e(0x1e6)),scaleDisplay[_0x66812e(0x2f8)][_0x66812e(0x1ee)]=_0x66812e(0x279),zoomInButton[_0x66812e(0x1d4)]=zoomLevel>=maxZoom,zoomOutButton[_0x66812e(0x1d4)]=zoomLevel<=minZoom,bollinoSizeIncreaseButton[_0x66812e(0x1d4)]=bollinoScaleFactor>=MAX_BOLLINO_SCALE,bollinoSizeDecreaseButton[_0x66812e(0x1d4)]=bollinoScaleFactor<=MIN_BOLLINO_SCALE;}function canvasToImageCoords(_0x43e402,_0x4be15c){return{'x':(_0x43e402-panOffsetX)/zoomLevel,'y':(_0x4be15c-panOffsetY)/zoomLevel};}function imageToCanvasCoords(_0x4b0672,_0x27975e){return{'x':_0x4b0672*zoomLevel+panOffsetX,'y':_0x27975e*zoomLevel+panOffsetY};}function getOrthogonalPointImg(_0x343d7d,_0x31be58){const _0x1984fe=_0x9a4ea2,_0x2f122e=Math[_0x1984fe(0x160)](_0x31be58['x']-_0x343d7d['x']),_0x32fd85=Math['abs'](_0x31be58['y']-_0x343d7d['y']);return _0x2f122e>_0x32fd85?{'x':_0x31be58['x'],'y':_0x343d7d['y']}:{'x':_0x343d7d['x'],'y':_0x31be58['y']};}function updateCanvasCursor(){const _0x47cc04=_0x9a4ea2;drawingCanvas['classList'][_0x47cc04(0x2dd)]('crosshair-mode-active','set-origin-mode-active','set-cnc-zero-mode-active','get-coords-mode-active',_0x47cc04(0x1b5),_0x47cc04(0x26c),_0x47cc04(0x24c),'cell-cursor',_0x47cc04(0x11d),_0x47cc04(0x244),_0x47cc04(0x28a),_0x47cc04(0x2e9),_0x47cc04(0xf9),_0x47cc04(0x148));if(isPanning){drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x148));return;}if(beingDraggedBollino){drawingCanvas['classList'][_0x47cc04(0x23c)](_0x47cc04(0x28a));return;}if(activeMode)switch(activeMode){case _0x47cc04(0x1cb):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x11d));break;case'freeAnnotation':case _0x47cc04(0x2cd):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x1d7));break;case _0x47cc04(0x1d0):case _0x47cc04(0x11f):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x170));break;case _0x47cc04(0x259):drawingCanvas[_0x47cc04(0x2a5)]['add']('set-origin-mode-active');break;case'setCNCZeroMode':drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)]('set-cnc-zero-mode-active');break;case _0x47cc04(0x26d):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x2d5));break;case _0x47cc04(0x253):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x1b5));break;case _0x47cc04(0x16c):drawingCanvas['classList'][_0x47cc04(0x23c)]('define-tool-path-mode-active');break;case _0x47cc04(0x186):drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0x24c));break;default:drawingCanvas[_0x47cc04(0x2f8)][_0x47cc04(0x143)]=_0x47cc04(0x17b);}else drawingCanvas[_0x47cc04(0x2a5)][_0x47cc04(0x23c)](_0x47cc04(0xf9));}function setActiveMode(_0x1798bd){const _0x17089e=_0x9a4ea2;beingDraggedBollino=null,currentSnappedPoint=null,calibrationPoints=[],measurementPoints=[],temporaryLine=null,lastMeasurementText=null,isPanning=![];const _0x1143ab=activeMode;activeMode=null,document[_0x17089e(0x26e)]('.button-group\x20button')[_0x17089e(0x2bf)](_0x3f1382=>_0x3f1382['classList']['remove'](_0x17089e(0x300))),toggleDeleteModeButton[_0x17089e(0x242)]=_0x17089e(0x1a9),toggleFreeAnnotationModeButton['innerHTML']='<i\x20class=\x22fas\x20fa-paint-brush\x20mr-1\x22></i>Pall.\x20Libera',toggleSequentialAnnotationModeButton['innerHTML']=_0x17089e(0x248),toggleCalibrateScaleModeButton['innerHTML']=_0x17089e(0x2f2),toggleMeasureDistanceModeButton['innerHTML']='<i\x20class=\x22fas\x20fa-drafting-compass\x20mr-1\x22></i>Misura\x20Dist.',toggleSetOriginModeButton[_0x17089e(0x242)]=_0x17089e(0x167),toggleSetCNCOriginModeButton[_0x17089e(0x242)]=_0x17089e(0x198),toggleGetCoordsModeButton['innerHTML']=_0x17089e(0x133),togglePlaceSnapPointModeButton[_0x17089e(0x242)]=_0x17089e(0x2af),toggleDefineToolPathModeButton['innerHTML']='<i\x20class=\x22fas\x20fa-route\x20mr-1\x22></i>Modalità\x20Percorso\x20Fresa',pickBoltCircleCenterButton[_0x17089e(0x2a5)]['remove'](_0x17089e(0x300));_0x1798bd&&_0x1798bd===_0x1143ab&&(_0x1798bd=null);if(_0x1798bd){activeMode=_0x1798bd;let _0x54fc64,_0x7b3ab2,_0x49f26c;switch(_0x1798bd){case _0x17089e(0x1cb):[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleDeleteModeButton,_0x17089e(0x185),_0x17089e(0x20d)];break;case'freeAnnotation':[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleFreeAnnotationModeButton,_0x17089e(0xdc),_0x17089e(0x1ce)];break;case _0x17089e(0x2cd):[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleSequentialAnnotationModeButton,_0x17089e(0x27f),'PALLINATURA\x20SEQUENZIALE:\x20Inizio\x20da\x20'+sequentialAnnotationPrefix+sequentialAnnotationCounter+_0x17089e(0x2b6)];break;case _0x17089e(0x1d0):[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleCalibrateScaleModeButton,'<i\x20class=\x22fas\x20fa-ruler-combined\x20mr-1\x22></i>Calibra\x20(ON)',_0x17089e(0x192)];break;case _0x17089e(0x11f):if(!worldScaleFactor){showInfo(_0x17089e(0x2dc)),activeMode=null,updateCanvasCursor(),redrawCanvas();return;}[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleMeasureDistanceModeButton,_0x17089e(0x26f),_0x17089e(0x1e4)];break;case _0x17089e(0x259):[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleSetOriginModeButton,_0x17089e(0x240),_0x17089e(0x1f1)];break;case'setCNCZeroMode':[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleSetCNCOriginModeButton,'<i\x20class=\x22fas\x20fa-map-pin\x20mr-1\x22></i>Origine\x20CNC\x20(ON)',_0x17089e(0x274)];break;case _0x17089e(0x26d):if(!customOriginPoint&&cncZeroPoints[_0x17089e(0x107)]===0x0){showInfo(_0x17089e(0x2ab)),activeMode=null,updateCanvasCursor(),redrawCanvas();return;}if(!worldScaleFactor){showInfo(_0x17089e(0x2a6)),activeMode=null,updateCanvasCursor(),redrawCanvas();return;}[_0x54fc64,_0x7b3ab2,_0x49f26c]=[toggleGetCoordsModeButton,'<i\x20class=\x22fas\x20fa-map-marker-alt\x20mr-1\x22></i>Coord.\x20(ON)',_0x17089e(0x187)];break;case'placeSnapPoint':[_0x54fc64,_0x7b3ab2,_0x49f26c]=[togglePlaceSnapPointModeButton,_0x17089e(0x23f),'PIAZZA\x20PUNTI\x20SNAP:\x20Clicca\x20sul\x20disegno.\x20Tieni\x20premuto\x20ALT\x20per\x20attivare\x20la\x20Loupe\x20di\x20precisione.'];break;case _0x17089e(0x16c):populateToolPathOriginSelect();!activeToolPathOriginDetails?showInfo(_0x17089e(0x157)):showInfo(_0x17089e(0x29e)+activeToolPathOriginDetails[_0x17089e(0x15e)]+_0x17089e(0x21c));[_0x54fc64,_0x7b3ab2]=[toggleDefineToolPathModeButton,_0x17089e(0x25f)];break;case _0x17089e(0x186):[_0x54fc64,_0x7b3ab2,_0x49f26c]=[pickBoltCircleCenterButton,_0x17089e(0x1a5),_0x17089e(0x1db)];break;}if(_0x54fc64){_0x54fc64[_0x17089e(0x2a5)]['add'](_0x17089e(0x300));if(_0x7b3ab2)_0x54fc64[_0x17089e(0x242)]=_0x7b3ab2;if(_0x49f26c)showInfo(_0x49f26c);}}else showInfo(_0x17089e(0xfb));updateCanvasCursor(),redrawCanvas(),updateUIDisplays();}function updateDimensionDataEntry(_0x452dc4,_0x1ddcf9,_0x573f45){const _0x3ced36=_0x9a4ea2;dimensionData[_0x452dc4]&&(dimensionData[_0x452dc4][_0x1ddcf9]=_0x573f45[_0x3ced36(0x231)]());}function populateTable(){const _0x233d92=_0x9a4ea2;dimensionsTableBody[_0x233d92(0x242)]='';if(dimensionData[_0x233d92(0x107)]===0x0){tablePlaceholder[_0x233d92(0x2f8)]['display']=_0x233d92(0x279),tableContainer[_0x233d92(0x2f8)]['display']=_0x233d92(0x2c1),exportCsvQuotesButton[_0x233d92(0x2f8)]['display']=_0x233d92(0x2c1);return;}tablePlaceholder[_0x233d92(0x2f8)]['display']='none',tableContainer[_0x233d92(0x2f8)][_0x233d92(0x1ee)]=_0x233d92(0x279),exportCsvQuotesButton[_0x233d92(0x2f8)][_0x233d92(0x1ee)]=_0x233d92(0x279),dimensionData[_0x233d92(0x2bf)]((_0x10b4f9,_0x1ddae8)=>{const _0x293a87=_0x233d92,_0x4347d0=dimensionsTableBody['insertRow']();_0x4347d0['classList']['add'](_0x293a87(0xf5),_0x293a87(0x278)),_0x4347d0[_0x293a87(0x237)][_0x293a87(0x11e)]=_0x1ddae8;const _0x4c7981=_0x4347d0[_0x293a87(0x2ae)]();_0x4c7981[_0x293a87(0x297)]=_0x10b4f9[_0x293a87(0x315)]||'N/D',_0x4c7981[_0x293a87(0x263)]=_0x293a87(0x28c);const _0x38cf37=_0x4347d0['insertCell']();_0x38cf37[_0x293a87(0x297)]=_0x10b4f9['Testo\x20completo\x20rilevato']||'N/D',_0x38cf37['className']=_0x293a87(0x216);const _0x2a26e4=_0x4347d0['insertCell']();_0x2a26e4['textContent']=_0x10b4f9[_0x293a87(0x260)]||'',_0x2a26e4['className']='px-2\x20py-1.5\x20text-xs\x20text-gray-300',_0x2a26e4[_0x293a87(0x1ab)]=_0x293a87(0x255),_0x2a26e4[_0x293a87(0x1b0)]('blur',_0x480ab8=>updateDimensionDataEntry(_0x1ddae8,_0x293a87(0x260),_0x480ab8[_0x293a87(0x136)][_0x293a87(0x297)]));const _0x3425e3=_0x4347d0[_0x293a87(0x2ae)]();_0x3425e3[_0x293a87(0x297)]=_0x10b4f9[_0x293a87(0x309)]||'',_0x3425e3['className']=_0x293a87(0x28c),_0x3425e3[_0x293a87(0x1ab)]=_0x293a87(0x255),_0x3425e3[_0x293a87(0x1b0)](_0x293a87(0xf6),_0x5bb4f4=>updateDimensionDataEntry(_0x1ddae8,_0x293a87(0x309),_0x5bb4f4[_0x293a87(0x136)][_0x293a87(0x297)])),_0x4347d0['addEventListener'](_0x293a87(0x27e),_0x12cda8=>{const _0x3aca53=_0x293a87;if(_0x12cda8[_0x3aca53(0x136)][_0x3aca53(0x227)])return;if(activeMode&&activeMode!==null&&activeMode!=='freeAnnotation'&&activeMode!==_0x3aca53(0x2cd)){showInfo(_0x3aca53(0x1ad)+activeMode+_0x3aca53(0x1be));return;}if(beingDraggedBollino||isPanning)return;setActiveMode(null),selectedDimension=dimensionData[_0x1ddae8],document[_0x3aca53(0x26e)](_0x3aca53(0x2cb))['forEach'](_0x534a9a=>_0x534a9a['classList'][_0x3aca53(0x2dd)](_0x3aca53(0x250))),_0x4347d0['classList']['add'](_0x3aca53(0x250)),showInfo(_0x3aca53(0x30e)+selectedDimension[_0x3aca53(0x315)]+_0x3aca53(0x195));});});}function setupCanvasLayout(){const _0x3e1d08=_0x9a4ea2;if(!drawingArea||!drawingCanvas)return;const _0x553153=drawingArea[_0x3e1d08(0x1f2)],_0x20adef=drawingArea[_0x3e1d08(0x17e)];drawingCanvas[_0x3e1d08(0x1dd)]=_0x553153,drawingCanvas[_0x3e1d08(0x149)]=_0x20adef,loupeCanvas[_0x3e1d08(0x1dd)]=LOUPE_SIZE,loupeCanvas[_0x3e1d08(0x149)]=LOUPE_SIZE,(!currentImage||!currentImage[_0x3e1d08(0x106)]||currentImage[_0x3e1d08(0x298)]===0x0)&&(ctx[_0x3e1d08(0x311)](0x0,0x0,drawingCanvas[_0x3e1d08(0x1dd)],drawingCanvas[_0x3e1d08(0x149)]),ctx[_0x3e1d08(0x2eb)]=_0x3e1d08(0x264),ctx['fillRect'](0x0,0x0,drawingCanvas['width'],drawingCanvas['height']),ctx[_0x3e1d08(0x2eb)]=_0x3e1d08(0x1c8),ctx[_0x3e1d08(0x1fa)]=_0x3e1d08(0x11a),ctx[_0x3e1d08(0x15b)]=Math[_0x3e1d08(0x14e)](0x12,drawingCanvas[_0x3e1d08(0x1dd)]/0x19)+_0x3e1d08(0x301),ctx[_0x3e1d08(0x27b)](_0x3e1d08(0xeb),drawingCanvas[_0x3e1d08(0x1dd)]/0x2,drawingCanvas['height']/0x2)),redrawCanvas();}function resetZoomAndPan(){const _0x244dc3=_0x9a4ea2;if(!currentImage||!drawingCanvas||drawingCanvas[_0x244dc3(0x1dd)]===0x0||drawingCanvas['height']===0x0){zoomLevel=0x1,panOffsetX=0x0,panOffsetY=0x0,updateUIDisplays();return;}const _0x38181e=drawingCanvas[_0x244dc3(0x1dd)]/drawingCanvas['height'],_0x522b13=currentImage[_0x244dc3(0x298)]/currentImage[_0x244dc3(0x2be)];zoomLevel=_0x522b13>_0x38181e?drawingCanvas[_0x244dc3(0x1dd)]/currentImage[_0x244dc3(0x298)]:drawingCanvas['height']/currentImage[_0x244dc3(0x2be)],zoomLevel=Math[_0x244dc3(0x14e)](zoomLevel,maxZoom),zoomLevel=Math[_0x244dc3(0xdf)](zoomLevel,minZoom),panOffsetX=(drawingCanvas[_0x244dc3(0x1dd)]-currentImage[_0x244dc3(0x298)]*zoomLevel)/0x2,panOffsetY=(drawingCanvas[_0x244dc3(0x149)]-currentImage['naturalHeight']*zoomLevel)/0x2,updateUIDisplays(),redrawCanvas();}function drawLoupe(){const _0xa5eda5=_0x9a4ea2,_0x2f4320=[_0xa5eda5(0x253),_0xa5eda5(0x1d0),_0xa5eda5(0x11f),_0xa5eda5(0x259),_0xa5eda5(0x305),_0xa5eda5(0x26d),_0xa5eda5(0x16c),'pickBoltCircleCenter'];if(!showLoupe||!currentImage||!_0x2f4320[_0xa5eda5(0x295)](activeMode)){loupeCanvas[_0xa5eda5(0x2f8)]['display']=_0xa5eda5(0x2c1);return;}loupeCanvas[_0xa5eda5(0x2f8)][_0xa5eda5(0x1ee)]=_0xa5eda5(0x279);const _0x1ffa14=0x14,_0x44529e=0x14;let _0x3c4f51=currentMouseCanvasPos['y']+_0x44529e,_0x298941=currentMouseCanvasPos['x']+_0x1ffa14;_0x298941+LOUPE_SIZE>drawingArea[_0xa5eda5(0x1f2)]&&(_0x298941=currentMouseCanvasPos['x']-LOUPE_SIZE-_0x1ffa14);_0x3c4f51+LOUPE_SIZE>drawingArea[_0xa5eda5(0x17e)]&&(_0x3c4f51=currentMouseCanvasPos['y']-LOUPE_SIZE-_0x44529e);loupeCanvas['style']['top']=_0x3c4f51+'px',loupeCanvas[_0xa5eda5(0x2f8)]['left']=_0x298941+'px',loupeCtx[_0xa5eda5(0x2eb)]=_0xa5eda5(0x2ba),loupeCtx[_0xa5eda5(0x14b)](0x0,0x0,LOUPE_SIZE,LOUPE_SIZE);const _0x110db1=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']),_0x3cae4f=LOUPE_SIZE/(zoomLevel*LOUPE_ZOOM_FACTOR),_0x527710=LOUPE_SIZE/(zoomLevel*LOUPE_ZOOM_FACTOR),_0x338a99=_0x110db1['x']-_0x3cae4f/0x2,_0x30e924=_0x110db1['y']-_0x527710/0x2;loupeCtx[_0xa5eda5(0xed)]=![],loupeCtx[_0xa5eda5(0x2d3)](drawingCanvas,_0x338a99*zoomLevel+panOffsetX,_0x30e924*zoomLevel+panOffsetY,_0x3cae4f*zoomLevel,_0x527710*zoomLevel,0x0,0x0,LOUPE_SIZE,LOUPE_SIZE);const _0x193819=LOUPE_SIZE/0x2,_0x1ba56d=LOUPE_SIZE/0x2;loupeCtx[_0xa5eda5(0x228)]=CROSSHAIR_COLOR,loupeCtx['lineWidth']=0x1,loupeCtx['beginPath'](),loupeCtx[_0xa5eda5(0xfe)](_0x193819,0x0),loupeCtx[_0xa5eda5(0x156)](_0x193819,LOUPE_SIZE),loupeCtx['moveTo'](0x0,_0x1ba56d),loupeCtx[_0xa5eda5(0x156)](LOUPE_SIZE,_0x1ba56d),loupeCtx['stroke']();const _0x20296b=2.5;loupeCtx[_0xa5eda5(0x104)](),loupeCtx['arc'](_0x193819,_0x1ba56d,_0x20296b,0x0,0x2*Math['PI']),loupeCtx[_0xa5eda5(0x2eb)]=CROSSHAIR_CENTER_MARKER_COLOR_FILL,loupeCtx['fill'](),loupeCtx[_0xa5eda5(0x228)]=CROSSHAIR_CENTER_MARKER_COLOR_STROKE,loupeCtx[_0xa5eda5(0xf8)]=0.5,loupeCtx[_0xa5eda5(0xef)]();}function getCNCOriginColor(_0x43065a){const _0x1e7f85=_0x9a4ea2,_0xa0eef6=[_0x1e7f85(0xdd),'#4682B4',_0x1e7f85(0x18d),_0x1e7f85(0x1a1),'#6A5ACD',_0x1e7f85(0x2b7),'#20B2AA',_0x1e7f85(0x151)];return _0xa0eef6[_0x43065a%_0xa0eef6[_0x1e7f85(0x107)]];}function redrawCanvas(){const _0x445e31=_0x9a4ea2;if(!ctx||!drawingCanvas)return;ctx[_0x445e31(0x2eb)]=_0x445e31(0xec),ctx[_0x445e31(0x14b)](0x0,0x0,drawingCanvas['width'],drawingCanvas[_0x445e31(0x149)]);if(currentImage&&currentImage['complete']&&currentImage[_0x445e31(0x298)]>0x0){ctx['save'](),ctx['translate'](panOffsetX,panOffsetY),ctx[_0x445e31(0x1de)](zoomLevel,zoomLevel);(currentImageFileType===_0x445e31(0x289)||currentImageFileType===_0x445e31(0x117))&&(ctx['fillStyle']='white',ctx[_0x445e31(0x14b)](0x0,0x0,currentImage[_0x445e31(0x298)],currentImage['naturalHeight']));ctx[_0x445e31(0x2d3)](currentImage,0x0,0x0,currentImage[_0x445e31(0x298)],currentImage['naturalHeight']);if(customOriginPoint){const _0x373363=ORIGIN_MARKER_RADIUS_IMG_PX/zoomLevel;ctx[_0x445e31(0x104)](),ctx[_0x445e31(0x223)](customOriginPoint['x'],customOriginPoint['y'],_0x373363,0x0,0x2*Math['PI']),ctx[_0x445e31(0x2eb)]=ORIGIN_MARKER_COLOR_FILL,ctx['fill'](),ctx[_0x445e31(0x228)]=ORIGIN_MARKER_COLOR_STROKE,ctx[_0x445e31(0xf8)]=1.5/zoomLevel,ctx['stroke'](),ctx[_0x445e31(0x104)](),ctx[_0x445e31(0xfe)](customOriginPoint['x']-_0x373363*0.6,customOriginPoint['y']),ctx[_0x445e31(0x156)](customOriginPoint['x']+_0x373363*0.6,customOriginPoint['y']),ctx[_0x445e31(0xfe)](customOriginPoint['x'],customOriginPoint['y']-_0x373363*0.6),ctx[_0x445e31(0x156)](customOriginPoint['x'],customOriginPoint['y']+_0x373363*0.6),ctx[_0x445e31(0x228)]=_0x445e31(0x2ba),ctx['lineWidth']=0x1/zoomLevel,ctx['stroke']();}cncZeroPoints[_0x445e31(0x2bf)]((_0x36c829,_0x53c221)=>{const _0x3522fd=_0x445e31,_0x1dbd20=CNC_ORIGIN_MARKER_BASE_RADIUS_IMG_PX/zoomLevel,_0x3d47b6=_0x36c829[_0x3522fd(0x1d9)]||getCNCOriginColor(_0x53c221);ctx[_0x3522fd(0x228)]=_0x3d47b6,ctx[_0x3522fd(0x2eb)]=_0x3d47b6,ctx['lineWidth']=0x2/zoomLevel,ctx[_0x3522fd(0x104)](),ctx['moveTo'](_0x36c829['x']-_0x1dbd20,_0x36c829['y']),ctx['lineTo'](_0x36c829['x']+_0x1dbd20,_0x36c829['y']),ctx[_0x3522fd(0xfe)](_0x36c829['x'],_0x36c829['y']-_0x1dbd20),ctx[_0x3522fd(0x156)](_0x36c829['x'],_0x36c829['y']+_0x1dbd20),ctx[_0x3522fd(0xef)](),ctx[_0x3522fd(0x104)](),ctx['arc'](_0x36c829['x'],_0x36c829['y'],_0x1dbd20*0.3,0x0,0x2*Math['PI']),ctx[_0x3522fd(0x12d)](),ctx[_0x3522fd(0x15b)]='bold\x20'+CNC_ORIGIN_TEXT_SIZE_IMG_PX/zoomLevel+_0x3522fd(0x1cf),ctx[_0x3522fd(0x1fa)]=_0x3522fd(0x23a),ctx[_0x3522fd(0x2b3)]=_0x3522fd(0x20c),ctx[_0x3522fd(0x27b)](_0x36c829['name'],_0x36c829['x']+_0x1dbd20*0.5,_0x36c829['y']-_0x1dbd20*0.5);}),gCodePoints[_0x445e31(0x2bf)](_0x4c9945=>{const _0x19d984=_0x445e31,_0x42082a=GCODE_POINT_RADIUS_IMG_PX/zoomLevel;ctx[_0x19d984(0x104)]();if(_0x4c9945[_0x19d984(0x1ac)]===_0x19d984(0x116))ctx[_0x19d984(0x228)]=GCODE_POINT_G00_COLOR,ctx[_0x19d984(0x2eb)]=GCODE_POINT_G00_COLOR,ctx[_0x19d984(0x223)](_0x4c9945['x'],_0x4c9945['y'],_0x42082a,0x0,0x2*Math['PI']),ctx['fill']();else _0x4c9945[_0x19d984(0x1ac)]===_0x19d984(0x125)&&(ctx[_0x19d984(0x228)]=GCODE_POINT_DRILL_COLOR,ctx[_0x19d984(0xf8)]=1.5/zoomLevel,ctx[_0x19d984(0xfe)](_0x4c9945['x']-_0x42082a*1.5,_0x4c9945['y']),ctx[_0x19d984(0x156)](_0x4c9945['x']+_0x42082a*1.5,_0x4c9945['y']),ctx[_0x19d984(0xfe)](_0x4c9945['x'],_0x4c9945['y']-_0x42082a*1.5),ctx['lineTo'](_0x4c9945['x'],_0x4c9945['y']+_0x42082a*1.5),ctx[_0x19d984(0xef)]());}),boltCircleSets['forEach'](_0x3f221f=>{const _0x456090=_0x445e31;let _0x4cae7f=_0x3f221f[_0x456090(0x184)];worldScaleFactor&&_0x3f221f['unit']!=='px'&&(_0x4cae7f=_0x3f221f[_0x456090(0x184)]*worldScaleFactor),ctx[_0x456090(0x104)](),ctx['arc'](_0x3f221f[_0x456090(0x2f3)],_0x3f221f[_0x456090(0x22a)],_0x4cae7f,0x0,0x2*Math['PI']),ctx[_0x456090(0x228)]=BOLT_CIRCLE_REF_LINE_COLOR,ctx[_0x456090(0xf8)]=0x1/zoomLevel,ctx[_0x456090(0x2cc)]([0x4/zoomLevel,0x4/zoomLevel]),ctx['stroke'](),ctx['setLineDash']([]),_0x3f221f['points']['forEach'](_0x5e26a2=>{const _0x57a157=_0x456090,_0x103c7a=BOLT_CIRCLE_POINT_RADIUS_IMG_PX/zoomLevel;ctx[_0x57a157(0x104)](),ctx['arc'](_0x5e26a2['x'],_0x5e26a2['y'],_0x103c7a,0x0,0x2*Math['PI']),ctx[_0x57a157(0x2eb)]=BOLT_CIRCLE_POINT_COLOR,ctx['fill']();});});if(toolPathPoints[_0x445e31(0x107)]>0x0){if(showToolPathLines&&toolPathPoints[_0x445e31(0x107)]>0x1){ctx[_0x445e31(0x104)](),ctx[_0x445e31(0xfe)](toolPathPoints[0x0][_0x445e31(0x2ed)],toolPathPoints[0x0]['imgY']);for(let _0x5c59a1=0x1;_0x5c59a1<toolPathPoints[_0x445e31(0x107)];_0x5c59a1++){ctx[_0x445e31(0x156)](toolPathPoints[_0x5c59a1][_0x445e31(0x2ed)],toolPathPoints[_0x5c59a1]['imgY']);}ctx[_0x445e31(0x228)]=TOOL_PATH_LINE_COLOR,ctx[_0x445e31(0xf8)]=1.5/zoomLevel,ctx[_0x445e31(0xef)]();}toolPathPoints[_0x445e31(0x2bf)](_0x2df30b=>{const _0x3e7431=_0x445e31;let _0x3e7cb4;if(worldScaleFactor&&virtualToolDiameter>0x0)_0x3e7cb4=virtualToolDiameter/0x2*worldScaleFactor;else virtualToolDiameter>0x0?_0x3e7cb4=virtualToolDiameter/0x2:_0x3e7cb4=0x0;_0x3e7cb4>0x0&&(ctx[_0x3e7431(0x104)](),ctx[_0x3e7431(0x223)](_0x2df30b[_0x3e7431(0x2ed)],_0x2df30b[_0x3e7431(0x1b7)],_0x3e7cb4,0x0,0x2*Math['PI']),ctx[_0x3e7431(0x2eb)]=VIRTUAL_TOOL_COLOR,ctx[_0x3e7431(0x12d)]());const _0x22229a=POINT_INDICATOR_RADIUS_IMG_PX*0.5/zoomLevel;ctx[_0x3e7431(0x104)](),ctx['arc'](_0x2df30b[_0x3e7431(0x2ed)],_0x2df30b[_0x3e7431(0x1b7)],_0x22229a,0x0,0x2*Math['PI']),ctx['fillStyle']=TOOL_PATH_POINT_COLOR,ctx[_0x3e7431(0x12d)]();});}placedSnapPoints['forEach'](_0x4fa070=>{const _0x340dd9=_0x445e31,_0x584487=MANUAL_SNAP_POINT_RADIUS_IMG_PX/zoomLevel;ctx[_0x340dd9(0x228)]=MANUAL_SNAP_POINT_COLOR,ctx[_0x340dd9(0xf8)]=1.5/zoomLevel,ctx[_0x340dd9(0x104)](),ctx[_0x340dd9(0xfe)](_0x4fa070['x']-_0x584487,_0x4fa070['y']),ctx[_0x340dd9(0x156)](_0x4fa070['x']+_0x584487,_0x4fa070['y']),ctx[_0x340dd9(0xfe)](_0x4fa070['x'],_0x4fa070['y']-_0x584487),ctx['lineTo'](_0x4fa070['x'],_0x4fa070['y']+_0x584487),ctx[_0x340dd9(0xef)]();}),placedBollini[_0x445e31(0x2bf)](_0x53eba2=>{const _0x240dec=_0x445e31,_0x12be66=BOLLINO_DEFAULT_RADIUS_IMG_PX*bollinoScaleFactor,_0x13a93c=_0x12be66*zoomLevel,_0x4f0a57=Math[_0x240dec(0xdf)](_0x13a93c,MIN_BOLLINO_RADIUS_ON_SCREEN_PX),_0x3dea61=_0x4f0a57/zoomLevel;let _0xf0c36e=_0x4f0a57*TEXT_SIZE_TO_ACTUAL_RADIUS_RATIO;_0xf0c36e=Math[_0x240dec(0xdf)](_0xf0c36e,MIN_TEXT_SIZE_ON_SCREEN_PX);const _0xec9a5c=_0xf0c36e/zoomLevel;drawBollinoOnContext(ctx,_0x53eba2[_0x240dec(0x2e1)],_0x53eba2['x'],_0x53eba2['y'],![],_0x3dea61,_0xec9a5c);});currentSnappedPoint&&(ctx['beginPath'](),ctx[_0x445e31(0x223)](currentSnappedPoint['x'],currentSnappedPoint['y'],SNAP_THRESHOLD_SCREEN_PX/1.5/zoomLevel,0x0,0x2*Math['PI']),ctx[_0x445e31(0x228)]=SNAP_INDICATOR_COLOR,ctx[_0x445e31(0xf8)]=0x2/zoomLevel,ctx[_0x445e31(0x2cc)]([0x3/zoomLevel,0x3/zoomLevel]),ctx['stroke'](),ctx['setLineDash']([]));const _0x26ddf9=POINT_INDICATOR_RADIUS_IMG_PX*zoomLevel,_0x3646e0=_0x26ddf9<0x2?0x2/zoomLevel:POINT_INDICATOR_RADIUS_IMG_PX;if(activeMode===_0x445e31(0x1d0)&&calibrationPoints[_0x445e31(0x107)]===0x1)ctx[_0x445e31(0x104)](),ctx[_0x445e31(0x223)](calibrationPoints[0x0]['x'],calibrationPoints[0x0]['y'],_0x3646e0,0x0,0x2*Math['PI']),ctx['fillStyle']=CALIBRATION_COLOR,ctx[_0x445e31(0x12d)]();else activeMode==='measureDistance'&&measurementPoints[_0x445e31(0x107)]===0x1&&(ctx[_0x445e31(0x104)](),ctx['arc'](measurementPoints[0x0]['x'],measurementPoints[0x0]['y'],_0x3646e0,0x0,0x2*Math['PI']),ctx[_0x445e31(0x2eb)]=MEASUREMENT_COLOR,ctx[_0x445e31(0x12d)]());temporaryLine&&temporaryLine[_0x445e31(0x20f)]&&temporaryLine[_0x445e31(0x2e3)]&&(ctx['beginPath'](),ctx['moveTo'](temporaryLine[_0x445e31(0x20f)]['x'],temporaryLine[_0x445e31(0x20f)]['y']),ctx['lineTo'](temporaryLine['end']['x'],temporaryLine[_0x445e31(0x2e3)]['y']),ctx[_0x445e31(0x228)]=activeMode===_0x445e31(0x1d0)?CALIBRATION_COLOR:MEASUREMENT_COLOR,ctx['lineWidth']=0x2/zoomLevel,ctx[_0x445e31(0x2cc)]([0x5/zoomLevel,0x5/zoomLevel]),ctx[_0x445e31(0xef)](),ctx['setLineDash']([]));if(lastMeasurementText&&measurementPoints[_0x445e31(0x107)]===0x2){ctx[_0x445e31(0x104)](),ctx['moveTo'](measurementPoints[0x0]['x'],measurementPoints[0x0]['y']),ctx[_0x445e31(0x156)](measurementPoints[0x1]['x'],measurementPoints[0x1]['y']),ctx['strokeStyle']=MEASUREMENT_COLOR,ctx[_0x445e31(0xf8)]=1.5/zoomLevel,ctx[_0x445e31(0xef)](),ctx[_0x445e31(0x15b)]=_0x445e31(0x2d0)+0xc/zoomLevel+_0x445e31(0x1cf),ctx[_0x445e31(0x2eb)]=MEASUREMENT_COLOR,ctx[_0x445e31(0x1fa)]='center',ctx[_0x445e31(0x2b3)]=_0x445e31(0x20c);const _0xff2cc1=(measurementPoints[0x0]['x']+measurementPoints[0x1]['x'])/0x2,_0x3e3538=(measurementPoints[0x0]['y']+measurementPoints[0x1]['y'])/0x2;ctx[_0x445e31(0x27b)](lastMeasurementText,_0xff2cc1,_0x3e3538-0x5/zoomLevel);}const _0x20d607=[_0x445e31(0x170),'set-origin-mode-active',_0x445e31(0x1bf),_0x445e31(0x2d5),_0x445e31(0x1b5),_0x445e31(0x26c),_0x445e31(0x24c)],_0x416307=_0x20d607[_0x445e31(0xe5)](_0x4d1e4b=>drawingCanvas[_0x445e31(0x2a5)][_0x445e31(0x2a2)](_0x4d1e4b));if(_0x416307){let _0x44f46d;currentSnappedPoint&&(activeMode!==_0x445e31(0x26d)||activeMode===_0x445e31(0x26d)&&!showLoupe)?_0x44f46d={'x':currentSnappedPoint['x'],'y':currentSnappedPoint['y']}:_0x44f46d=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']);if(activeMode===_0x445e31(0x16c)&&virtualToolDiameter>0x0&&activeToolPathOriginDetails){let _0x367a00;worldScaleFactor?_0x367a00=virtualToolDiameter/0x2*worldScaleFactor:_0x367a00=virtualToolDiameter/0x2,ctx['beginPath'](),ctx[_0x445e31(0x223)](_0x44f46d['x'],_0x44f46d['y'],_0x367a00,0x0,0x2*Math['PI']),ctx[_0x445e31(0x2eb)]=VIRTUAL_TOOL_COLOR,ctx[_0x445e31(0x12d)]();}if(!(showLoupe&&currentMouseCanvasPos['x']>0x0&&currentMouseCanvasPos['x']<drawingCanvas[_0x445e31(0x1dd)]&&currentMouseCanvasPos['y']>0x0&&currentMouseCanvasPos['y']<drawingCanvas[_0x445e31(0x149)])){ctx[_0x445e31(0x228)]=CROSSHAIR_COLOR,ctx['lineWidth']=0x1/zoomLevel,ctx['beginPath'](),ctx['moveTo'](_0x44f46d['x'],0x0),ctx[_0x445e31(0x156)](_0x44f46d['x'],currentImage[_0x445e31(0x2be)]),ctx[_0x445e31(0xfe)](0x0,_0x44f46d['y']),ctx['lineTo'](currentImage['naturalWidth'],_0x44f46d['y']),ctx[_0x445e31(0xef)]();const _0x19d4b4=2.5/zoomLevel;ctx['beginPath'](),ctx[_0x445e31(0x223)](_0x44f46d['x'],_0x44f46d['y'],_0x19d4b4,0x0,0x2*Math['PI']),ctx[_0x445e31(0x2eb)]=CROSSHAIR_CENTER_MARKER_COLOR_FILL,ctx[_0x445e31(0x12d)](),ctx[_0x445e31(0x228)]=CROSSHAIR_CENTER_MARKER_COLOR_STROKE,ctx['lineWidth']=0.5/zoomLevel,ctx['stroke']();}}ctx[_0x445e31(0x10c)]();}else ctx[_0x445e31(0x2eb)]=_0x445e31(0x264),ctx[_0x445e31(0x14b)](0x0,0x0,drawingCanvas[_0x445e31(0x1dd)],drawingCanvas[_0x445e31(0x149)]),ctx[_0x445e31(0x2eb)]=_0x445e31(0x1c8),ctx['textAlign']=_0x445e31(0x11a),ctx['font']=Math[_0x445e31(0x14e)](0x12,drawingCanvas[_0x445e31(0x1dd)]/0x19)+'px\x20Inter,\x20sans-serif',ctx[_0x445e31(0x27b)](_0x445e31(0xeb),drawingCanvas[_0x445e31(0x1dd)]/0x2,drawingCanvas[_0x445e31(0x149)]/0x2);const _0x567aca=[_0x445e31(0x253),'calibrateScale',_0x445e31(0x11f),_0x445e31(0x259),_0x445e31(0x305),_0x445e31(0x26d),_0x445e31(0x16c),'pickBoltCircleCenter'];showLoupe&&_0x567aca[_0x445e31(0x295)](activeMode)?drawLoupe():loupeCanvas['style'][_0x445e31(0x1ee)]='none';}function drawBollinoOnContext(_0x1cd081,_0x5ba35e,_0x386b03,_0x3c6fb8,_0x1a6ffd=![],_0x2b3404,_0xf9c3b6){const _0x3bec45=_0x9a4ea2,_0x50504b=_0x1a6ffd?_0x3bec45(0x175):_0x3bec45(0xe0);_0x1cd081[_0x3bec45(0x104)](),_0x1cd081[_0x3bec45(0x223)](_0x386b03,_0x3c6fb8,_0x2b3404,0x0,0x2*Math['PI'],![]),_0x1cd081[_0x3bec45(0x2eb)]=_0x50504b,_0x1cd081['fill'](),_0x1cd081[_0x3bec45(0xf8)]=_0x1a6ffd?1.5:1.5/zoomLevel,_0x1cd081[_0x3bec45(0x228)]='#7f1d1d',_0x1cd081['stroke'](),_0x1cd081[_0x3bec45(0x15b)]='bold\x20'+_0xf9c3b6+'px\x20Arial,\x20sans-serif',_0x1cd081[_0x3bec45(0x2eb)]='white',_0x1cd081[_0x3bec45(0x1fa)]=_0x3bec45(0x11a),_0x1cd081[_0x3bec45(0x2b3)]=_0x3bec45(0x1b6),_0x1cd081[_0x3bec45(0x27b)](_0x5ba35e,_0x386b03,_0x3c6fb8+_0xf9c3b6*0.05);}function getBollinoAtCanvasPosition(_0x59301c,_0x40896b){const _0x3ac9eb=_0x9a4ea2,_0x25f2e5=canvasToImageCoords(_0x59301c,_0x40896b),_0x26c441=BOLLINO_DEFAULT_RADIUS_IMG_PX*bollinoScaleFactor,_0x250d89=_0x26c441*zoomLevel,_0x16d32d=Math['max'](_0x250d89,MIN_BOLLINO_RADIUS_ON_SCREEN_PX),_0x1d0112=_0x16d32d/zoomLevel;for(let _0x186a29=placedBollini[_0x3ac9eb(0x107)]-0x1;_0x186a29>=0x0;_0x186a29--){const _0xd426d8=placedBollini[_0x186a29],_0x1cc339=Math['sqrt'](Math['pow'](_0x25f2e5['x']-_0xd426d8['x'],0x2)+Math[_0x3ac9eb(0x1f7)](_0x25f2e5['y']-_0xd426d8['y'],0x2));if(_0x1cc339<=_0x1d0112)return{'index':_0x186a29,'bollino':_0xd426d8};}return null;}imageUpload[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),_0xad0499=>{const _0x15a10d=_0x9a4ea2,_0x2798a1=_0xad0499[_0x15a10d(0x136)][_0x15a10d(0x197)][0x0];imageUploadError[_0x15a10d(0x297)]='',imageError[_0x15a10d(0x297)]='',currentImageFileType=null;if(_0x2798a1){loader[_0x15a10d(0x2f8)][_0x15a10d(0x1ee)]='block';const _0x5db166=()=>{const _0x352d1b=_0x15a10d;imageError[_0x352d1b(0x297)]='Errore\x20nel\x20caricamento\x20del\x20file.',currentImage=null,currentImageFileType=null,worldScaleFactor=null,customOriginPoint=null,placedSnapPoints=[],cncZeroPoints=[],gCodePoints=[],toolPathPoints=[],boltCircleSets=[],setActiveMode(null),loader['style'][_0x352d1b(0x1ee)]=_0x352d1b(0x2c1),setupCanvasLayout(),resetZoomAndPan(),updateUIDisplays(),renderToolPathTable();},_0x1deeff=()=>{const _0x155815=_0x15a10d;placedBollini=[],placedSnapPoints=[],cncZeroPoints=[],gCodePoints=[],toolPathPoints=[],boltCircleSets=[],activeToolPathOriginDetails=null,worldScaleFactor=null,customOriginPoint=null,setActiveMode(null),setupCanvasLayout(),resetZoomAndPan(),loader[_0x155815(0x2f8)][_0x155815(0x1ee)]=_0x155815(0x2c1),tablePlaceholder[_0x155815(0x297)]=_0x155815(0x2fd),updateUIDisplays(),renderToolPathTable(),populateToolPathOriginSelect(),redrawCanvas();};if(_0x2798a1[_0x15a10d(0x1ac)]==='application/pdf'){currentImageFileType=_0x2798a1['type'];const _0xde2686=new FileReader();_0xde2686[_0x15a10d(0x129)]=async _0xbeac02=>{const _0x17c27d=_0x15a10d;try{const _0xbd2739=new Uint8Array(_0xbeac02[_0x17c27d(0x136)][_0x17c27d(0x166)]),_0x1ffc0d=await pdfjsLib['getDocument']({'data':_0xbd2739})[_0x17c27d(0x310)],_0x60b3a4=await _0x1ffc0d['getPage'](0x1),_0x78eba4=_0x60b3a4[_0x17c27d(0x196)]({'scale':0x2}),_0x4fe90a=document[_0x17c27d(0x15a)](_0x17c27d(0x277)),_0x43e632=_0x4fe90a['getContext']('2d');_0x4fe90a[_0x17c27d(0x1dd)]=_0x78eba4[_0x17c27d(0x1dd)],_0x4fe90a[_0x17c27d(0x149)]=_0x78eba4[_0x17c27d(0x149)],await _0x60b3a4[_0x17c27d(0x21a)]({'canvasContext':_0x43e632,'viewport':_0x78eba4})[_0x17c27d(0x310)];const _0x33b11b=new Image();_0x33b11b['onload']=()=>{const _0xdb4588=_0x17c27d;currentImage=_0x33b11b,showInfo(_0xdb4588(0x272)),_0x1deeff();},_0x33b11b[_0x17c27d(0x27d)]=_0x5db166,_0x33b11b[_0x17c27d(0x1df)]=_0x4fe90a[_0x17c27d(0x29b)](),drawingImage[_0x17c27d(0x1df)]=_0x33b11b[_0x17c27d(0x1df)];}catch(_0x1a2295){console[_0x17c27d(0x256)](_0x17c27d(0x1c6),_0x1a2295),imageError[_0x17c27d(0x297)]=_0x17c27d(0x21b),_0x5db166();}},_0xde2686[_0x15a10d(0x140)](_0x2798a1);}else{if(_0x2798a1['type']['startsWith'](_0x15a10d(0x1e7))||_0x2798a1[_0x15a10d(0x15e)]['toLowerCase']()[_0x15a10d(0x1a6)]('.svg')){const _0x29de68=new FileReader();_0x29de68[_0x15a10d(0x129)]=_0x5ec266=>{const _0x467bfd=_0x15a10d,_0x431bf0=new Image();_0x431bf0[_0x467bfd(0x129)]=()=>{const _0x22b1c4=_0x467bfd;currentImage=_0x431bf0,currentImageFileType=_0x2798a1['type'],_0x2798a1[_0x22b1c4(0x1ac)]==='image/svg+xml'?showInfo(_0x22b1c4(0x1ea)):showInfo('Immagine\x20caricata.'),_0x1deeff();},_0x431bf0['onerror']=_0x5db166,_0x431bf0[_0x467bfd(0x1df)]=_0x5ec266[_0x467bfd(0x136)]['result'],drawingImage[_0x467bfd(0x1df)]=_0x5ec266[_0x467bfd(0x136)][_0x467bfd(0x166)];},_0x29de68[_0x15a10d(0x1af)](_0x2798a1);}else{imageUploadError['textContent']='File\x20non\x20valido.\x20Seleziona\x20un\x27immagine\x20(PNG,\x20JPG,\x20GIF),\x20SVG\x20o\x20PDF.',loader[_0x15a10d(0x2f8)][_0x15a10d(0x1ee)]='none';return;}}}}),csvUpload[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),_0x2fa809=>{const _0x4cd51d=_0x9a4ea2,_0x7f67ec=_0x2fa809[_0x4cd51d(0x136)][_0x4cd51d(0x197)][0x0];csvUploadError[_0x4cd51d(0x297)]='';if(_0x7f67ec){if(!_0x7f67ec['name'][_0x4cd51d(0x1a6)](_0x4cd51d(0x18f))){csvUploadError[_0x4cd51d(0x297)]=_0x4cd51d(0x221);return;}loader[_0x4cd51d(0x2f8)][_0x4cd51d(0x1ee)]=_0x4cd51d(0x279);const _0x50d39c=new FileReader();_0x50d39c[_0x4cd51d(0x129)]=_0x2ac263=>{const _0x2a3f20=_0x4cd51d;try{const _0x29e6fd=_0x2ac263[_0x2a3f20(0x136)][_0x2a3f20(0x166)],_0x37e050=_0x29e6fd[_0x2a3f20(0x1c3)](/\r\n|\n/);if(_0x37e050['length']<0x2)throw new Error(_0x2a3f20(0x13f));const _0x3561d8=_0x37e050[0x0][_0x2a3f20(0x1c3)](',')[_0x2a3f20(0x10b)](_0x4e411a=>_0x4e411a[_0x2a3f20(0x231)]()),_0x26b9cc=_0x3561d8['indexOf'](_0x2a3f20(0x315)),_0x5117aa=_0x3561d8['indexOf']('Testo\x20completo\x20rilevato');if(_0x26b9cc===-0x1||_0x5117aa===-0x1)throw new Error(_0x2a3f20(0x273));dimensionData=[];for(let _0x41e755=0x1;_0x41e755<_0x37e050[_0x2a3f20(0x107)];_0x41e755++){if(_0x37e050[_0x41e755][_0x2a3f20(0x231)]()==='')continue;const _0x2309e3=_0x37e050[_0x41e755][_0x2a3f20(0x1c3)](',');dimensionData['push']({'Lettera':_0x2309e3[_0x26b9cc]?_0x2309e3[_0x26b9cc]['trim']():_0x2a3f20(0x2ea),'Testo\x20completo\x20rilevato':_0x2309e3[_0x5117aa]?_0x2309e3[_0x5117aa][_0x2a3f20(0x231)]():_0x2a3f20(0x2ea),'tolleranza':'','misurato':''});}populateTable(),showInfo(_0x2a3f20(0x2ce));}catch(_0x40fccf){csvUploadError[_0x2a3f20(0x297)]=_0x2a3f20(0x2db)+_0x40fccf[_0x2a3f20(0x29d)],dimensionData=[],populateTable(),showInfo(_0x2a3f20(0x204));}finally{loader[_0x2a3f20(0x2f8)][_0x2a3f20(0x1ee)]=_0x2a3f20(0x2c1);}},_0x50d39c['readAsText'](_0x7f67ec);}}),gcodeUpload[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),_0x314dad=>{const _0x2b8645=_0x9a4ea2,_0x3bfa0d=_0x314dad['target'][_0x2b8645(0x197)][0x0];gcodeUploadError['textContent']='';if(_0x3bfa0d){loader[_0x2b8645(0x2f8)][_0x2b8645(0x1ee)]=_0x2b8645(0x279);const _0x3b8148=new FileReader();_0x3b8148[_0x2b8645(0x129)]=_0x206311=>{const _0x2a0d43=_0x2b8645;try{const _0x20e07d=_0x206311[_0x2a0d43(0x136)][_0x2a0d43(0x166)];gCodePoints=parseGCode(_0x20e07d),showInfo(gCodePoints[_0x2a0d43(0x107)]+_0x2a0d43(0x1f9)),redrawCanvas();}catch(_0x53528b){gcodeUploadError[_0x2a0d43(0x297)]=_0x2a0d43(0x16a)+_0x53528b['message'],gCodePoints=[],showInfo('Errore\x20durante\x20il\x20caricamento\x20o\x20parsing\x20del\x20G-Code.'),console[_0x2a0d43(0x256)](_0x2a0d43(0x17d),_0x53528b);}finally{loader[_0x2a0d43(0x2f8)]['display']=_0x2a0d43(0x2c1),gcodeUpload[_0x2a0d43(0x114)]='';}},_0x3b8148['onerror']=()=>{const _0x30e218=_0x2b8645;loader[_0x30e218(0x2f8)][_0x30e218(0x1ee)]='none',gcodeUploadError[_0x30e218(0x297)]=_0x30e218(0x176),showInfo('Errore\x20lettura\x20file\x20G-Code.');},_0x3b8148[_0x2b8645(0x25a)](_0x3bfa0d);}});function parseGCode(_0x548764){const _0xe825a=_0x9a4ea2,_0x55ed89=_0x548764[_0xe825a(0x1c3)](/\r\n|\n/),_0x511698=[];let _0x2a569f=0x0,_0x3e1862=0x0;const _0x3ef386=/([GXYZF])([+-]?\d*\.?\d+)/gi;return _0x55ed89[_0xe825a(0x2bf)](_0x48df6f=>{const _0x5c4fb5=_0xe825a;_0x48df6f=_0x48df6f[_0x5c4fb5(0x14c)]()['split'](';')[0x0]['trim']();if(!_0x48df6f)return;const _0x10e59b={};let _0x5c1e9f;while((_0x5c1e9f=_0x3ef386['exec'](_0x48df6f))!==null){_0x10e59b[_0x5c1e9f[0x1]]=parseFloat(_0x5c1e9f[0x2]);}if(_0x10e59b['G']!==undefined){const _0x99b1ae=Math[_0x5c4fb5(0x194)](_0x10e59b['G']);let _0x946cdd=_0x10e59b['X']!==undefined?_0x10e59b['X']:_0x2a569f,_0x3c4e5b=_0x10e59b['Y']!==undefined?_0x10e59b['Y']:_0x3e1862;if(_0x99b1ae===0x0||_0x99b1ae===0x1)(_0x10e59b['X']!==undefined||_0x10e59b['Y']!==undefined)&&_0x511698['push']({'x':_0x946cdd,'y':_0x3c4e5b,'type':_0x5c4fb5(0x116),'rawLine':_0x48df6f}),_0x2a569f=_0x946cdd,_0x3e1862=_0x3c4e5b;else(_0x99b1ae===0x51||_0x99b1ae===0x52||_0x99b1ae===0x53)&&((_0x10e59b['X']!==undefined||_0x10e59b['Y']!==undefined)&&_0x511698['push']({'x':_0x946cdd,'y':_0x3c4e5b,'type':_0x5c4fb5(0x125),'rawLine':_0x48df6f}),_0x2a569f=_0x946cdd,_0x3e1862=_0x3c4e5b);}}),_0x511698;}drawingCanvas[_0x9a4ea2(0x1b0)]('mousedown',_0x1b5abb=>{const _0x562977=_0x9a4ea2;if(!currentImage||_0x1b5abb[_0x562977(0xe8)]!==0x0)return;const _0x2fa7f3=drawingCanvas[_0x562977(0x10a)](),_0x2fa2f4=_0x1b5abb[_0x562977(0x283)]-_0x2fa7f3[_0x562977(0x23a)],_0x1d47bc=_0x1b5abb[_0x562977(0x307)]-_0x2fa7f3[_0x562977(0x13b)];if(activeMode===null){const _0x2923c7=getBollinoAtCanvasPosition(_0x2fa2f4,_0x1d47bc);if(_0x2923c7){beingDraggedBollino=_0x2923c7[_0x562977(0x182)];const _0x33a485=canvasToImageCoords(_0x2fa2f4,_0x1d47bc);dragStartCoords={'x':_0x33a485['x']-beingDraggedBollino['x'],'y':_0x33a485['y']-beingDraggedBollino['y']},isPanning=![];}else isPanning=!![],lastPanPosition={'x':_0x2fa2f4,'y':_0x1d47bc};}updateCanvasCursor();}),drawingCanvas[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x30f),_0x500b02=>{const _0x5ca505=_0x9a4ea2;if(!currentImage)return;const _0x5543dd=drawingCanvas[_0x5ca505(0x10a)]();currentMouseCanvasPos={'x':_0x500b02[_0x5ca505(0x283)]-_0x5543dd[_0x5ca505(0x23a)],'y':_0x500b02['clientY']-_0x5543dd[_0x5ca505(0x13b)]};if(isPanning){const _0x475052=currentMouseCanvasPos['x']-lastPanPosition['x'],_0x422986=currentMouseCanvasPos['y']-lastPanPosition['y'];panOffsetX+=_0x475052,panOffsetY+=_0x422986,lastPanPosition={'x':currentMouseCanvasPos['x'],'y':currentMouseCanvasPos['y']};if(activeMode===_0x5ca505(0x26d)||activeMode===_0x5ca505(0x16c))updateUIDisplays();}else{if(beingDraggedBollino){const _0x4455eb=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']);beingDraggedBollino['x']=_0x4455eb['x']-dragStartCoords['x'],beingDraggedBollino['y']=_0x4455eb['y']-dragStartCoords['y'];}else{currentSnappedPoint=null;let _0x465e5=canvasToImageCoords(currentMouseCanvasPos['x'],currentMouseCanvasPos['y']);const _0x3e5368=activeMode==='calibrateScale'&&calibrationPoints[_0x5ca505(0x107)]<0x2||activeMode===_0x5ca505(0x11f)&&measurementPoints[_0x5ca505(0x107)]<0x2&&worldScaleFactor||activeMode===_0x5ca505(0x259)||activeMode===_0x5ca505(0x305)||activeMode===_0x5ca505(0x26d)||activeMode===_0x5ca505(0x253)||activeMode===_0x5ca505(0x16c)&&activeToolPathOriginDetails||activeMode===_0x5ca505(0x186);if(_0x3e5368){let _0xdf1c81=null,_0x271d77=Infinity;const _0x5deaf6=Math[_0x5ca505(0x1f7)](SNAP_THRESHOLD_SCREEN_PX/zoomLevel,0x2),_0x18b03a=[...placedSnapPoints['map'](_0xc6ffef=>({..._0xc6ffef,'type':_0x5ca505(0xfa)})),...placedBollini['map'](_0x8329d0=>({'x':_0x8329d0['x'],'y':_0x8329d0['y'],'type':_0x5ca505(0x182),'originalBollino':_0x8329d0})),...gCodePoints[_0x5ca505(0x10b)](_0x2eff4d=>({..._0x2eff4d,'type':_0x5ca505(0x17a),'originalGCodePoint':_0x2eff4d})),...toolPathPoints[_0x5ca505(0x10b)](_0x426ef3=>({'x':_0x426ef3[_0x5ca505(0x2ed)],'y':_0x426ef3[_0x5ca505(0x1b7)],'type':_0x5ca505(0x202),'originalToolPathPoint':_0x426ef3}))];customOriginPoint&&activeMode!==_0x5ca505(0x259)&&_0x18b03a['push']({'x':customOriginPoint['x'],'y':customOriginPoint['y'],'type':_0x5ca505(0x177)}),cncZeroPoints[_0x5ca505(0x2bf)](_0x15f443=>{const _0x4ff5c8=_0x5ca505;if(activeMode!==_0x4ff5c8(0x305)||currentSnappedPoint&&currentSnappedPoint['type']==='cncOrigin'&&currentSnappedPoint[_0x4ff5c8(0x30a)]===_0x15f443)return;_0x18b03a['push']({'x':_0x15f443['x'],'y':_0x15f443['y'],'type':_0x4ff5c8(0x308),'originalCNCOrigin':_0x15f443});}),_0x18b03a[_0x5ca505(0x2bf)](_0x2395fc=>{const _0x1b9943=_0x465e5['x']-_0x2395fc['x'],_0x2412cf=_0x465e5['y']-_0x2395fc['y'],_0x53c817=_0x1b9943*_0x1b9943+_0x2412cf*_0x2412cf;_0x53c817<_0x5deaf6&&_0x53c817<_0x271d77&&(_0x271d77=_0x53c817,_0xdf1c81=_0x2395fc);}),_0xdf1c81&&(currentSnappedPoint=_0xdf1c81);}if(activeMode===_0x5ca505(0x1d0)&&calibrationPoints['length']===0x1||activeMode===_0x5ca505(0x11f)&&measurementPoints['length']===0x1&&worldScaleFactor){let _0x2f0c8d=currentSnappedPoint?{'x':currentSnappedPoint['x'],'y':currentSnappedPoint['y']}:_0x465e5;temporaryLine[_0x5ca505(0x2e3)]=getOrthogonalPointImg(temporaryLine[_0x5ca505(0x20f)],_0x2f0c8d);}if(!activeMode)drawingCanvas[_0x5ca505(0x2a5)][_0x5ca505(0x128)](_0x5ca505(0x244),getBollinoAtCanvasPosition(currentMouseCanvasPos['x'],currentMouseCanvasPos['y'])!==null);else activeMode===_0x5ca505(0x1cb)&&drawingCanvas[_0x5ca505(0x2a5)][_0x5ca505(0x128)](_0x5ca505(0x2e9),getBollinoAtCanvasPosition(currentMouseCanvasPos['x'],currentMouseCanvasPos['y'])!==null);if(activeMode===_0x5ca505(0x26d)||activeMode==='defineToolPath')updateUIDisplays();}}if(currentMouseCanvasPos['x']>=0x0&&currentMouseCanvasPos['x']<=drawingCanvas['width']&&currentMouseCanvasPos['y']>=0x0&&currentMouseCanvasPos['y']<=drawingCanvas[_0x5ca505(0x149)]){const _0x1833e0=[_0x5ca505(0x253),_0x5ca505(0x1d0),_0x5ca505(0x11f),_0x5ca505(0x259),'setCNCZeroMode','getRelativeCoordinates',_0x5ca505(0x16c),'pickBoltCircleCenter'];showLoupe&&_0x1833e0[_0x5ca505(0x295)](activeMode)&&drawLoupe();}else loupeCanvas[_0x5ca505(0x2f8)][_0x5ca505(0x1ee)]=_0x5ca505(0x2c1);redrawCanvas();}),drawingCanvas[_0x9a4ea2(0x1b0)](_0x9a4ea2(0xe3),_0x332a43=>{if(_0x332a43['button']!==0x0)return;if(isPanning)isPanning=![];else beingDraggedBollino&&(beingDraggedBollino=null);updateCanvasCursor(),redrawCanvas();}),drawingCanvas['addEventListener'](_0x9a4ea2(0x1b4),()=>{const _0x28d81d=_0x9a4ea2;if(isPanning)isPanning=![];beingDraggedBollino&&(beingDraggedBollino=null);const _0x45db1c=[_0x28d81d(0x1d0),_0x28d81d(0x11f),_0x28d81d(0x259),_0x28d81d(0x305),_0x28d81d(0x26d),_0x28d81d(0x253),_0x28d81d(0x16c),_0x28d81d(0x186)];if(_0x45db1c[_0x28d81d(0x295)](activeMode)){const _0x49d693=[_0x28d81d(0x170),_0x28d81d(0x10e),'set-cnc-zero-mode-active','get-coords-mode-active',_0x28d81d(0x1b5),'define-tool-path-mode-active',_0x28d81d(0x24c)];drawingCanvas['classList']['remove'](..._0x49d693),redrawCanvas(),updateCanvasCursor();}loupeCanvas[_0x28d81d(0x2f8)][_0x28d81d(0x1ee)]=_0x28d81d(0x2c1),updateUIDisplays();}),drawingCanvas[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x15c),()=>{const _0x3dcfd0=_0x9a4ea2;updateCanvasCursor();const _0x344967=[_0x3dcfd0(0x1d0),'measureDistance',_0x3dcfd0(0x259),_0x3dcfd0(0x305),_0x3dcfd0(0x26d),'placeSnapPoint',_0x3dcfd0(0x16c),_0x3dcfd0(0x186)];showLoupe&&_0x344967['includes'](activeMode)&&(loupeCanvas[_0x3dcfd0(0x2f8)][_0x3dcfd0(0x1ee)]=_0x3dcfd0(0x279)),_0x344967[_0x3dcfd0(0x295)](activeMode)&&redrawCanvas();}),drawingCanvas[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x2f10f1=>{const _0x20aa40=_0x9a4ea2;if(!currentImage||isPanning||beingDraggedBollino)return;const _0x43212c=drawingCanvas[_0x20aa40(0x10a)](),_0x367fac=_0x2f10f1[_0x20aa40(0x283)]-_0x43212c[_0x20aa40(0x23a)],_0x5627cd=_0x2f10f1[_0x20aa40(0x307)]-_0x43212c[_0x20aa40(0x13b)];let _0x1c9ffe=canvasToImageCoords(_0x367fac,_0x5627cd);if(currentSnappedPoint){_0x1c9ffe={'x':currentSnappedPoint['x'],'y':currentSnappedPoint['y']};let _0x5027ae=_0x20aa40(0x2f0);if(currentSnappedPoint[_0x20aa40(0x1ac)]===_0x20aa40(0x177))_0x5027ae=_0x20aa40(0x124);else{if(currentSnappedPoint[_0x20aa40(0x1ac)]===_0x20aa40(0x308))_0x5027ae=_0x20aa40(0x2a9)+currentSnappedPoint[_0x20aa40(0x30a)][_0x20aa40(0x15e)]+'\x27';else{if(currentSnappedPoint['type']==='bollino')_0x5027ae='bollino\x20\x27'+currentSnappedPoint[_0x20aa40(0x2e7)][_0x20aa40(0x2e1)]+'\x27';else{if(currentSnappedPoint[_0x20aa40(0x1ac)]==='manualSnapPoint')_0x5027ae=_0x20aa40(0x29c);else{if(currentSnappedPoint[_0x20aa40(0x1ac)]==='gCodePoint')_0x5027ae='punto\x20G-Code\x20('+currentSnappedPoint['originalGCodePoint'][_0x20aa40(0x1ac)]+')';else{if(currentSnappedPoint[_0x20aa40(0x1ac)]==='toolPathPoint')_0x5027ae=_0x20aa40(0x20e)+(toolPathPoints['indexOf'](currentSnappedPoint[_0x20aa40(0x142)])+0x1);}}}}}showInfo('Punto\x20agganciato\x20a:\x20'+_0x5027ae+'.');}switch(activeMode){case _0x20aa40(0x1cb):const _0x2b70f7=getBollinoAtCanvasPosition(_0x367fac,_0x5627cd);if(_0x2b70f7){const _0x5e50e6=placedBollini[_0x20aa40(0x294)](_0x2b70f7['index'],0x1)[0x0];showInfo(_0x20aa40(0x212)+_0x5e50e6[_0x20aa40(0x2e1)]+_0x20aa40(0x1fe));}else showInfo('Nessun\x20bollino\x20trovato\x20per\x20la\x20cancellazione.');break;case _0x20aa40(0x290):tempBollinoCoords=_0x1c9ffe,bollinoLabelInput[_0x20aa40(0x114)]='',labelInputModal['classList'][_0x20aa40(0x23c)](_0x20aa40(0x159)),bollinoLabelInput['focus']();break;case _0x20aa40(0x2cd):const _0x2b0099=''+sequentialAnnotationPrefix+sequentialAnnotationCounter;placedBollini[_0x20aa40(0x1c9)]({'letter':_0x2b0099,'x':_0x1c9ffe['x'],'y':_0x1c9ffe['y'],'text':_0x20aa40(0x2d4)+_0x2b0099}),sequentialAnnotationCounter++,showInfo('Bollino\x20sequenziale\x20\x27'+_0x2b0099+_0x20aa40(0x11b)+sequentialAnnotationPrefix+sequentialAnnotationCounter);toggleSequentialAnnotationModeButton[_0x20aa40(0x2a5)]['contains'](_0x20aa40(0x300))&&(toggleSequentialAnnotationModeButton[_0x20aa40(0x242)]=_0x20aa40(0x27f),showInfo('Pallinatura\x20Sequenziale\x20ATTIVA.\x20Prossimo:\x20'+sequentialAnnotationPrefix+sequentialAnnotationCounter+_0x20aa40(0x285)));break;case _0x20aa40(0x1d0):calibrationPoints[_0x20aa40(0x1c9)](_0x1c9ffe);if(calibrationPoints[_0x20aa40(0x107)]===0x1)temporaryLine={'start':_0x1c9ffe,'end':_0x1c9ffe},showInfo(_0x20aa40(0x100));else{if(calibrationPoints[_0x20aa40(0x107)]===0x2){calibrationPoints[0x1]=getOrthogonalPointImg(calibrationPoints[0x0],_0x1c9ffe);if(temporaryLine)temporaryLine[_0x20aa40(0x2e3)]=calibrationPoints[0x1];realDimensionInput[_0x20aa40(0x114)]='',unitInput[_0x20aa40(0x114)]=worldScaleUnit,calibrateScaleModal[_0x20aa40(0x2a5)]['add'](_0x20aa40(0x159)),realDimensionInput[_0x20aa40(0x2ac)](),showInfo('Secondo\x20punto\x20selezionato.\x20Inserisci\x20valore\x20reale.');}}break;case'measureDistance':if(!worldScaleFactor){showInfo(_0x20aa40(0x102));return;}measurementPoints[_0x20aa40(0x1c9)](_0x1c9ffe);if(measurementPoints['length']===0x1)temporaryLine={'start':_0x1c9ffe,'end':_0x1c9ffe},lastMeasurementText=null,showInfo(_0x20aa40(0x1ef));else{if(measurementPoints[_0x20aa40(0x107)]===0x2){measurementPoints[0x1]=getOrthogonalPointImg(measurementPoints[0x0],_0x1c9ffe);if(temporaryLine)temporaryLine[_0x20aa40(0x2e3)]=measurementPoints[0x1];const _0x402547=Math[_0x20aa40(0x160)](measurementPoints[0x1]['x']-measurementPoints[0x0]['x']),_0x13de91=Math[_0x20aa40(0x160)](measurementPoints[0x1]['y']-measurementPoints[0x0]['y']),_0x4e7421=Math['sqrt'](_0x402547*_0x402547+_0x13de91*_0x13de91),_0x4766d9=_0x4e7421/worldScaleFactor;lastMeasurementText=roundToFirstDecimal(_0x4766d9)+'\x20'+worldScaleUnit,showInfo(_0x20aa40(0x112)+lastMeasurementText+_0x20aa40(0x181)),measurementPoints=[],temporaryLine=null;}}break;case _0x20aa40(0x259):customOriginPoint=_0x1c9ffe,showInfo(_0x20aa40(0x235)+customOriginPoint['x'][_0x20aa40(0x30c)](0x1)+_0x20aa40(0x2de)+customOriginPoint['y']['toFixed'](0x1)+_0x20aa40(0x24e)),populateToolPathOriginSelect(),setActiveMode(null);break;case'setCNCZeroMode':tempCNCOriginCoords=_0x1c9ffe,cncOriginNameInput[_0x20aa40(0x114)]='G5'+(0x4+cncZeroPoints[_0x20aa40(0x107)]),cncOriginNameModal[_0x20aa40(0x2a5)][_0x20aa40(0x23c)](_0x20aa40(0x159)),cncOriginNameInput[_0x20aa40(0x2ac)]();break;case'getRelativeCoordinates':if(!worldScaleFactor){showInfo('ERRORE:\x20Scala\x20non\x20calibrata\x20per\x20coordinate\x20reali.');break;}if(!customOriginPoint&&cncZeroPoints[_0x20aa40(0x107)]===0x0){showInfo(_0x20aa40(0x1f4));break;}let _0x293277=[_0x20aa40(0x174)];const _0x446606=_0x1c9ffe;if(customOriginPoint){const _0x27ebfb=(_0x446606['x']-customOriginPoint['x'])/worldScaleFactor,_0x167519=-((_0x446606['y']-customOriginPoint['y'])/worldScaleFactor);_0x293277[_0x20aa40(0x1c9)](_0x20aa40(0x218)+worldScaleUnit+_0x20aa40(0x1e0)+roundToFirstDecimal(_0x27ebfb)+_0x20aa40(0x208)+roundToFirstDecimal(_0x167519));}cncZeroPoints[_0x20aa40(0x2bf)](_0x49a387=>{const _0x44827e=_0x20aa40,_0x59faa5=(_0x446606['x']-_0x49a387['x'])/worldScaleFactor,_0x27b12d=-((_0x446606['y']-_0x49a387['y'])/worldScaleFactor);_0x293277[_0x44827e(0x1c9)]('Da\x20'+_0x49a387['name']+'\x20('+worldScaleUnit+_0x44827e(0x1e0)+roundToFirstDecimal(_0x59faa5)+_0x44827e(0x208)+roundToFirstDecimal(_0x27b12d));}),showInfo(_0x293277[_0x20aa40(0x24f)](';\x20'));break;case _0x20aa40(0x253):placedSnapPoints[_0x20aa40(0x1c9)]({'x':_0x1c9ffe['x'],'y':_0x1c9ffe['y']}),showInfo(_0x20aa40(0x188)+_0x1c9ffe['x'][_0x20aa40(0x30c)](0x1)+_0x20aa40(0x2f4)+_0x1c9ffe['y'][_0x20aa40(0x30c)](0x1)+'.');break;case'defineToolPath':if(!activeToolPathOriginDetails){showInfo(_0x20aa40(0x265));break;}const _0x36e082={'imgX':_0x1c9ffe['x'],'imgY':_0x1c9ffe['y'],'refOriginName':activeToolPathOriginDetails[_0x20aa40(0x15e)],'refOriginType':activeToolPathOriginDetails['type'],'refOriginImgX':activeToolPathOriginDetails[_0x20aa40(0x2ed)],'refOriginImgY':activeToolPathOriginDetails[_0x20aa40(0x1b7)]};worldScaleFactor?(_0x36e082[_0x20aa40(0x11c)]=(_0x1c9ffe['x']-activeToolPathOriginDetails[_0x20aa40(0x2ed)])/worldScaleFactor,_0x36e082[_0x20aa40(0x111)]=-((_0x1c9ffe['y']-activeToolPathOriginDetails[_0x20aa40(0x1b7)])/worldScaleFactor)):(_0x36e082[_0x20aa40(0x11c)]=_0x1c9ffe['x']-activeToolPathOriginDetails[_0x20aa40(0x2ed)],_0x36e082[_0x20aa40(0x111)]=-(_0x1c9ffe['y']-activeToolPathOriginDetails['imgY']));toolPathPoints[_0x20aa40(0x1c9)](_0x36e082),renderToolPathTable(),showInfo(_0x20aa40(0x207)+toolPathPoints[_0x20aa40(0x107)]+_0x20aa40(0x246)+activeToolPathOriginDetails[_0x20aa40(0x15e)]+'.');break;case _0x20aa40(0x186):boltCircleCenterX[_0x20aa40(0x114)]=_0x1c9ffe['x'][_0x20aa40(0x30c)](0x2),boltCircleCenterY['value']=_0x1c9ffe['y']['toFixed'](0x2),showInfo(_0x20aa40(0x226)),setActiveMode(null),boltCircleModal[_0x20aa40(0x2a5)][_0x20aa40(0x23c)](_0x20aa40(0x159)),handleBoltCircleCalculation();break;default:selectedDimension&&(placedBollini['push']({'letter':selectedDimension[_0x20aa40(0x315)],'x':_0x1c9ffe['x'],'y':_0x1c9ffe['y'],'text':selectedDimension[_0x20aa40(0x239)],'tolleranza':selectedDimension[_0x20aa40(0x260)]||'','misurato':selectedDimension['misurato']||''}),showInfo(_0x20aa40(0x212)+selectedDimension[_0x20aa40(0x315)]+_0x20aa40(0x12a)),selectedDimension=null,document[_0x20aa40(0x26e)](_0x20aa40(0x2cb))[_0x20aa40(0x2bf)](_0x5e7192=>_0x5e7192['classList'][_0x20aa40(0x2dd)](_0x20aa40(0x250))));break;}currentSnappedPoint=null,redrawCanvas(),updateUIDisplays();}),drawingCanvas['addEventListener'](_0x9a4ea2(0x293),_0x2a8f81=>{const _0x5d5d79=_0x9a4ea2;if(!currentImage)return;_0x2a8f81[_0x5d5d79(0xf3)]();const _0xba48c3=drawingCanvas[_0x5d5d79(0x10a)](),_0x274045=_0x2a8f81[_0x5d5d79(0x283)]-_0xba48c3[_0x5d5d79(0x23a)],_0x5d9b54=_0x2a8f81[_0x5d5d79(0x307)]-_0xba48c3[_0x5d5d79(0x13b)],_0x386c1e=(_0x274045-panOffsetX)/zoomLevel,_0x1200cc=(_0x5d9b54-panOffsetY)/zoomLevel,_0x267abd=1.1;_0x2a8f81['deltaY']<0x0?zoomLevel*=_0x267abd:zoomLevel/=_0x267abd,zoomLevel=Math['max'](minZoom,Math[_0x5d5d79(0x14e)](maxZoom,zoomLevel)),panOffsetX=_0x274045-_0x386c1e*zoomLevel,panOffsetY=_0x5d9b54-_0x1200cc*zoomLevel,updateUIDisplays(),redrawCanvas();}),document[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x16e),_0x2aa71a=>{const _0x2adbdf=_0x9a4ea2,_0x286661=[_0x2adbdf(0x253),_0x2adbdf(0x1d0),_0x2adbdf(0x11f),_0x2adbdf(0x259),_0x2adbdf(0x305),'getRelativeCoordinates',_0x2adbdf(0x16c),_0x2adbdf(0x186)];_0x2aa71a[_0x2adbdf(0x241)]===_0x2adbdf(0x23e)&&_0x286661[_0x2adbdf(0x295)](activeMode)&&(_0x2aa71a[_0x2adbdf(0xf3)](),!showLoupe&&(showLoupe=!![],loupeCanvas[_0x2adbdf(0x2f8)][_0x2adbdf(0x1ee)]='block',redrawCanvas()));}),document['addEventListener']('keyup',_0x3cb1e3=>{const _0x58c8b5=_0x9a4ea2;_0x3cb1e3[_0x58c8b5(0x241)]===_0x58c8b5(0x23e)&&(showLoupe&&(showLoupe=![],loupeCanvas[_0x58c8b5(0x2f8)][_0x58c8b5(0x1ee)]='none',redrawCanvas()));}),bollinoSizeIncreaseButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{bollinoScaleFactor=Math['min'](MAX_BOLLINO_SCALE,bollinoScaleFactor+BOLLINO_SCALE_STEP),updateUIDisplays(),redrawCanvas();}),bollinoSizeDecreaseButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x4f6442=_0x9a4ea2;bollinoScaleFactor=Math[_0x4f6442(0xdf)](MIN_BOLLINO_SCALE,bollinoScaleFactor-BOLLINO_SCALE_STEP),updateUIDisplays(),redrawCanvas();}),bollinoSizeResetButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{bollinoScaleFactor=0x1,updateUIDisplays(),redrawCanvas();}),confirmLabelButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x5147a8=_0x9a4ea2,_0x481baa=bollinoLabelInput[_0x5147a8(0x114)];_0x481baa&&_0x481baa['trim']()!==''?(placedBollini[_0x5147a8(0x1c9)]({'letter':_0x481baa[_0x5147a8(0x231)](),'x':tempBollinoCoords['x'],'y':tempBollinoCoords['y'],'text':_0x5147a8(0x217)+_0x481baa[_0x5147a8(0x231)]()}),redrawCanvas(),showInfo(_0x5147a8(0x24b)+_0x481baa[_0x5147a8(0x231)]()+'\x27\x20posizionato.')):showInfo('Etichetta\x20non\x20valida.\x20Bollino\x20non\x20aggiunto.'),labelInputModal[_0x5147a8(0x2a5)][_0x5147a8(0x2dd)](_0x5147a8(0x159));}),cancelLabelButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x313ce4=_0x9a4ea2;labelInputModal['classList'][_0x313ce4(0x2dd)](_0x313ce4(0x159)),showInfo(_0x313ce4(0x2d2));}),labelInputModal['addEventListener']('click',_0x4b7f37=>{const _0x22d164=_0x9a4ea2;if(_0x4b7f37['target']===labelInputModal)cancelLabelButton[_0x22d164(0x27e)]();}),confirmSequentialLabelButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x546b86=_0x9a4ea2,_0x1b3a11=sequentialPrefixInput[_0x546b86(0x114)][_0x546b86(0x231)](),_0xad40e7=parseInt(sequentialStartNumberInput[_0x546b86(0x114)],0xa);if(isNaN(_0xad40e7)||_0xad40e7<0x0){showInfo(_0x546b86(0x101)),sequentialStartNumberInput[_0x546b86(0x2ac)]();return;}sequentialAnnotationPrefix=_0x1b3a11,sequentialAnnotationCounter=_0xad40e7,sequentialLabelInputModal['classList'][_0x546b86(0x2dd)]('active'),setActiveMode(_0x546b86(0x2cd));}),cancelSequentialLabelButton['addEventListener'](_0x9a4ea2(0x27e),()=>{const _0x3b234f=_0x9a4ea2;sequentialLabelInputModal[_0x3b234f(0x2a5)]['remove'](_0x3b234f(0x159)),setActiveMode(null),showInfo('Impostazione\x20pallinatura\x20sequenziale\x20annullata.');}),sequentialLabelInputModal[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x1fe641=>{const _0x376d5e=_0x9a4ea2;if(_0x1fe641['target']===sequentialLabelInputModal)cancelSequentialLabelButton[_0x376d5e(0x27e)]();}),confirmCalibrationButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x570cbc=_0x9a4ea2,_0x43a3ef=parseFloat(realDimensionInput[_0x570cbc(0x114)]),_0x192a7e=unitInput[_0x570cbc(0x114)][_0x570cbc(0x231)]();if(isNaN(_0x43a3ef)||_0x43a3ef<=0x0){showInfo(_0x570cbc(0x287)),realDimensionInput[_0x570cbc(0x2ac)]();return;}if(!_0x192a7e){showInfo(_0x570cbc(0xe2)),unitInput[_0x570cbc(0x2ac)]();return;}if(calibrationPoints[_0x570cbc(0x107)]===0x2){const _0x10d513=Math[_0x570cbc(0x160)](calibrationPoints[0x1]['x']-calibrationPoints[0x0]['x']),_0x406ca8=Math['abs'](calibrationPoints[0x1]['y']-calibrationPoints[0x0]['y']),_0x3031a6=Math[_0x570cbc(0x130)](_0x10d513*_0x10d513+_0x406ca8*_0x406ca8);_0x3031a6>0x0?(worldScaleFactor=_0x3031a6/_0x43a3ef,worldScaleUnit=_0x192a7e,showInfo(_0x570cbc(0x17f)+worldScaleUnit+_0x570cbc(0xde)+roundToFirstDecimal(worldScaleFactor)+_0x570cbc(0x234))):(showInfo('Distanza\x20calibrazione\x20nulla.\x20Riprova.'),worldScaleFactor=null);}calibrateScaleModal[_0x570cbc(0x2a5)]['remove'](_0x570cbc(0x159)),calibrationPoints=[],temporaryLine=null,setActiveMode(null),redrawCanvas(),updateUIDisplays();}),cancelCalibrationButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x3f47c7=_0x9a4ea2;calibrateScaleModal[_0x3f47c7(0x2a5)][_0x3f47c7(0x2dd)](_0x3f47c7(0x159)),calibrationPoints=[],temporaryLine=null,showInfo('Calibrazione\x20annullata.'),setActiveMode(null),redrawCanvas(),updateUIDisplays();}),calibrateScaleModal[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x2bc150=>{const _0x297f30=_0x9a4ea2;if(_0x2bc150[_0x297f30(0x136)]===calibrateScaleModal)cancelCalibrationButton[_0x297f30(0x27e)]();}),confirmCNCOriginNameButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x389e6b=_0x9a4ea2,_0x19e4b4=cncOriginNameInput['value'][_0x389e6b(0x231)]();if(!_0x19e4b4){showInfo(_0x389e6b(0x312)),cncOriginNameModal[_0x389e6b(0x2a5)]['remove'](_0x389e6b(0x159)),setActiveMode(null);return;}cncZeroPoints[_0x389e6b(0x1c9)]({'name':_0x19e4b4,'x':tempCNCOriginCoords['x'],'y':tempCNCOriginCoords['y'],'color':getCNCOriginColor(cncZeroPoints[_0x389e6b(0x107)])}),showInfo(_0x389e6b(0x291)+_0x19e4b4+_0x389e6b(0x2ef)+tempCNCOriginCoords['x']['toFixed'](0x1)+_0x389e6b(0x2f4)+tempCNCOriginCoords['y'][_0x389e6b(0x30c)](0x1)+'.'),populateToolPathOriginSelect(),cncOriginNameModal[_0x389e6b(0x2a5)]['remove'](_0x389e6b(0x159)),setActiveMode(null),redrawCanvas(),updateUIDisplays();}),cancelCNCOriginNameButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x3dd2ef=_0x9a4ea2;cncOriginNameModal[_0x3dd2ef(0x2a5)][_0x3dd2ef(0x2dd)]('active'),showInfo('Impostazione\x20Origine\x20CNC\x20annullata.'),setActiveMode(null);}),cncOriginNameModal[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x57d047=>{const _0x4363c6=_0x9a4ea2;if(_0x57d047[_0x4363c6(0x136)]===cncOriginNameModal)cancelCNCOriginNameButton['click']();}),toggleFreeAnnotationModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode('freeAnnotation')),toggleSequentialAnnotationModeButton['addEventListener']('click',()=>{const _0xc94eb8=_0x9a4ea2;if(activeMode===_0xc94eb8(0x2cd))setActiveMode(null);else sequentialPrefixInput[_0xc94eb8(0x114)]=sequentialAnnotationPrefix,sequentialStartNumberInput[_0xc94eb8(0x114)]=sequentialAnnotationCounter,sequentialLabelInputModal['classList']['add'](_0xc94eb8(0x159)),sequentialPrefixInput['focus']();}),toggleDeleteModeButton['addEventListener']('click',()=>setActiveMode('delete')),toggleCalibrateScaleModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x1d0))),toggleMeasureDistanceModeButton[_0x9a4ea2(0x1b0)]('click',()=>{const _0x5f1f5e=_0x9a4ea2;if(activeMode===_0x5f1f5e(0x11f))setActiveMode(null);else setActiveMode(_0x5f1f5e(0x11f));}),toggleSetOriginModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x259))),toggleGetCoordsModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x26d))),togglePlaceSnapPointModeButton['addEventListener'](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x253))),toggleSetCNCOriginModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x305))),toggleDefineToolPathModeButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>setActiveMode(_0x9a4ea2(0x16c))),clearSnapPointsButton[_0x9a4ea2(0x1b0)]('click',()=>{const _0x27f142=_0x9a4ea2;if(placedSnapPoints[_0x27f142(0x107)]===0x0){showInfo(_0x27f142(0x229));return;}confirmClearModalText['textContent']=_0x27f142(0x127),confirmClearModal[_0x27f142(0x237)][_0x27f142(0x17c)]='snapPoints',confirmClearModal[_0x27f142(0x2a5)][_0x27f142(0x23c)](_0x27f142(0x159));}),clearCNCOriginsButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x955d0e=_0x9a4ea2;if(cncZeroPoints[_0x955d0e(0x107)]===0x0){showInfo('Nessuna\x20origine\x20CNC\x20da\x20cancellare.');return;}confirmClearModalText[_0x955d0e(0x297)]=_0x955d0e(0x224)+cncZeroPoints['length']+_0x955d0e(0x262),confirmClearModal[_0x955d0e(0x237)][_0x955d0e(0x17c)]=_0x955d0e(0x2d7),confirmClearModal[_0x955d0e(0x2a5)]['add']('active');}),clearGCodePointsButton['addEventListener'](_0x9a4ea2(0x27e),()=>{const _0x3bbd61=_0x9a4ea2;if(gCodePoints['length']===0x0){showInfo('Nessun\x20punto\x20G-Code\x20da\x20cancellare.');return;}confirmClearModalText[_0x3bbd61(0x297)]='Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutti\x20i\x20'+gCodePoints['length']+_0x3bbd61(0x257),confirmClearModal[_0x3bbd61(0x237)]['clearType']=_0x3bbd61(0x147),confirmClearModal['classList']['add'](_0x3bbd61(0x159));}),clearToolPathButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x148d9e=_0x9a4ea2;if(toolPathPoints['length']===0x0){showInfo(_0x148d9e(0x19f));return;}confirmClearModalText[_0x148d9e(0x297)]='Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutti\x20i\x20'+toolPathPoints[_0x148d9e(0x107)]+_0x148d9e(0x193),confirmClearModal[_0x148d9e(0x237)][_0x148d9e(0x17c)]='toolPath',confirmClearModal[_0x148d9e(0x2a5)][_0x148d9e(0x23c)](_0x148d9e(0x159));}),clearBoltCirclePointsButton['addEventListener'](_0x9a4ea2(0x27e),()=>{const _0x23edc9=_0x9a4ea2;if(boltCircleSets[_0x23edc9(0x107)]===0x0){showInfo('Nessun\x20foro\x20da\x20circonferenza\x20da\x20cancellare.');return;}confirmClearModalText[_0x23edc9(0x297)]=_0x23edc9(0xe7)+boltCircleSets['length']+_0x23edc9(0x191),confirmClearModal[_0x23edc9(0x237)]['clearType']=_0x23edc9(0x2ee),confirmClearModal[_0x23edc9(0x2a5)]['add'](_0x23edc9(0x159));}),zoomInButton['addEventListener']('click',()=>{const _0x45ba98=_0x9a4ea2;if(!currentImage)return;const _0x597924=drawingCanvas[_0x45ba98(0x1dd)]/0x2,_0x3cc8c4=drawingCanvas[_0x45ba98(0x149)]/0x2,_0x5160c1=(_0x597924-panOffsetX)/zoomLevel,_0x18933=(_0x3cc8c4-panOffsetY)/zoomLevel;zoomLevel=Math[_0x45ba98(0x14e)](maxZoom,zoomLevel*1.25),panOffsetX=_0x597924-_0x5160c1*zoomLevel,panOffsetY=_0x3cc8c4-_0x18933*zoomLevel,updateUIDisplays(),redrawCanvas();}),zoomOutButton[_0x9a4ea2(0x1b0)]('click',()=>{const _0x106974=_0x9a4ea2;if(!currentImage)return;const _0x23db12=drawingCanvas[_0x106974(0x1dd)]/0x2,_0x457a20=drawingCanvas[_0x106974(0x149)]/0x2,_0xa9f3cc=(_0x23db12-panOffsetX)/zoomLevel,_0x37d39f=(_0x457a20-panOffsetY)/zoomLevel;zoomLevel=Math['max'](minZoom,zoomLevel/1.25),panOffsetX=_0x23db12-mouseImgX_before*zoomLevel,panOffsetY=_0x457a20-mouseImgY_before*zoomLevel,updateUIDisplays(),redrawCanvas();}),resetZoomButton['addEventListener'](_0x9a4ea2(0x27e),()=>{if(!currentImage)return;resetZoomAndPan();}),clearBolliniButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x375a95=_0x9a4ea2;if(placedBollini[_0x375a95(0x107)]===0x0&&!currentImage){showInfo(_0x375a95(0x18b));return;}confirmClearModalText[_0x375a95(0x297)]='Sei\x20sicuro\x20di\x20voler\x20cancellare\x20tutti\x20i\x20bollini\x20posizionati\x20sul\x20disegno?',confirmClearModal[_0x375a95(0x237)]['clearType']=_0x375a95(0xe4),confirmClearModal[_0x375a95(0x2a5)][_0x375a95(0x23c)](_0x375a95(0x159));}),confirmClearYes[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x1330f7=_0x9a4ea2,_0x2b1f9f=confirmClearModal[_0x1330f7(0x237)]['clearType'];switch(_0x2b1f9f){case'bollini':placedBollini=[],showInfo(_0x1330f7(0x2c0));break;case _0x1330f7(0x1bb):customTableEntries=[],renderCustomTable(),showInfo(_0x1330f7(0x211));break;case _0x1330f7(0x270):placedSnapPoints=[],showInfo(_0x1330f7(0x131));break;case _0x1330f7(0x2d7):cncZeroPoints=[],showInfo(_0x1330f7(0x1d6)),populateToolPathOriginSelect();break;case'gCodePoints':gCodePoints=[],showInfo('Tutti\x20i\x20punti\x20G-Code\x20sono\x20stati\x20cancellati.');break;case'toolPath':toolPathPoints=[],renderToolPathTable(),showInfo(_0x1330f7(0x209));break;case _0x1330f7(0x2ee):boltCircleSets=[],showInfo(_0x1330f7(0x162));break;}confirmClearModal[_0x1330f7(0x2a5)][_0x1330f7(0x2dd)]('active'),redrawCanvas(),updateUIDisplays();}),confirmClearNo[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>confirmClearModal['classList']['remove'](_0x9a4ea2(0x159))),confirmClearModal[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x2a43d4=>{const _0x48123f=_0x9a4ea2;if(_0x2a43d4[_0x48123f(0x136)]===confirmClearModal)confirmClearNo[_0x48123f(0x27e)]();}),exportButton['addEventListener']('click',()=>{const _0x30889a=_0x9a4ea2;if(!currentImage||!currentImage[_0x30889a(0x106)]||currentImage[_0x30889a(0x298)]===0x0){showInfo(_0x30889a(0x2f1));return;}const _0x541300=placedBollini[_0x30889a(0x107)]>0x0||customOriginPoint||placedSnapPoints[_0x30889a(0x107)]>0x0||cncZeroPoints[_0x30889a(0x107)]>0x0||gCodePoints[_0x30889a(0x107)]>0x0||toolPathPoints[_0x30889a(0x107)]>0x0||boltCircleSets[_0x30889a(0x107)]>0x0;if(!_0x541300){showInfo(_0x30889a(0x115));return;}showInfo('Preparazione\x20immagine\x20per\x20l\x27export...'),loader[_0x30889a(0x2f8)][_0x30889a(0x1ee)]='block',setTimeout(()=>{const _0xa1ac46=_0x30889a;try{const _0x5d17d4=document['createElement'](_0xa1ac46(0x277));_0x5d17d4[_0xa1ac46(0x1dd)]=currentImage[_0xa1ac46(0x298)],_0x5d17d4['height']=currentImage[_0xa1ac46(0x2be)];const _0x577099=_0x5d17d4['getContext']('2d');(currentImageFileType===_0xa1ac46(0x289)||currentImageFileType===_0xa1ac46(0x117))&&(_0x577099['fillStyle']='white',_0x577099['fillRect'](0x0,0x0,currentImage[_0xa1ac46(0x298)],currentImage[_0xa1ac46(0x2be)]));_0x577099[_0xa1ac46(0x2d3)](currentImage,0x0,0x0,currentImage[_0xa1ac46(0x298)],currentImage[_0xa1ac46(0x2be)]);if(customOriginPoint){const _0x8a7c4c=ORIGIN_MARKER_RADIUS_IMG_PX;_0x577099[_0xa1ac46(0x104)](),_0x577099[_0xa1ac46(0x223)](customOriginPoint['x'],customOriginPoint['y'],_0x8a7c4c,0x0,0x2*Math['PI']),_0x577099[_0xa1ac46(0x2eb)]=ORIGIN_MARKER_COLOR_FILL,_0x577099[_0xa1ac46(0x12d)](),_0x577099[_0xa1ac46(0x228)]=ORIGIN_MARKER_COLOR_STROKE,_0x577099['lineWidth']=1.5,_0x577099[_0xa1ac46(0xef)](),_0x577099[_0xa1ac46(0x104)](),_0x577099['moveTo'](customOriginPoint['x']-_0x8a7c4c*0.6,customOriginPoint['y']),_0x577099[_0xa1ac46(0x156)](customOriginPoint['x']+_0x8a7c4c*0.6,customOriginPoint['y']),_0x577099['moveTo'](customOriginPoint['x'],customOriginPoint['y']-_0x8a7c4c*0.6),_0x577099[_0xa1ac46(0x156)](customOriginPoint['x'],customOriginPoint['y']+_0x8a7c4c*0.6),_0x577099['strokeStyle']=_0xa1ac46(0x2ba),_0x577099['lineWidth']=0x1,_0x577099[_0xa1ac46(0xef)]();}cncZeroPoints[_0xa1ac46(0x2bf)]((_0x1ac8c4,_0x3370d9)=>{const _0x554cf2=_0xa1ac46,_0x18fe5a=CNC_ORIGIN_MARKER_BASE_RADIUS_IMG_PX,_0x4ca32f=_0x1ac8c4['color']||getCNCOriginColor(_0x3370d9);_0x577099[_0x554cf2(0x228)]=_0x4ca32f,_0x577099[_0x554cf2(0x2eb)]=_0x4ca32f,_0x577099[_0x554cf2(0xf8)]=0x2,_0x577099[_0x554cf2(0x104)](),_0x577099[_0x554cf2(0xfe)](_0x1ac8c4['x']-_0x18fe5a,_0x1ac8c4['y']),_0x577099[_0x554cf2(0x156)](_0x1ac8c4['x']+_0x18fe5a,_0x1ac8c4['y']),_0x577099[_0x554cf2(0xfe)](_0x1ac8c4['x'],_0x1ac8c4['y']-_0x18fe5a),_0x577099[_0x554cf2(0x156)](_0x1ac8c4['x'],_0x1ac8c4['y']+_0x18fe5a),_0x577099[_0x554cf2(0xef)](),_0x577099[_0x554cf2(0x104)](),_0x577099[_0x554cf2(0x223)](_0x1ac8c4['x'],_0x1ac8c4['y'],_0x18fe5a*0.3,0x0,0x2*Math['PI']),_0x577099[_0x554cf2(0x12d)](),_0x577099[_0x554cf2(0x15b)]=_0x554cf2(0x2d0)+CNC_ORIGIN_TEXT_SIZE_IMG_PX+_0x554cf2(0x1cf),_0x577099['textAlign']=_0x554cf2(0x23a),_0x577099['textBaseline']='bottom',_0x577099['fillText'](_0x1ac8c4[_0x554cf2(0x15e)],_0x1ac8c4['x']+_0x18fe5a*0.5,_0x1ac8c4['y']-_0x18fe5a*0.5);}),gCodePoints[_0xa1ac46(0x2bf)](_0x5acc98=>{const _0x24e9cf=_0xa1ac46,_0x2d90ed=GCODE_POINT_RADIUS_IMG_PX;_0x577099['beginPath']();if(_0x5acc98[_0x24e9cf(0x1ac)]===_0x24e9cf(0x116))_0x577099[_0x24e9cf(0x228)]=GCODE_POINT_G00_COLOR,_0x577099[_0x24e9cf(0x2eb)]=GCODE_POINT_G00_COLOR,_0x577099[_0x24e9cf(0x223)](_0x5acc98['x'],_0x5acc98['y'],_0x2d90ed,0x0,0x2*Math['PI']),_0x577099['fill']();else _0x5acc98[_0x24e9cf(0x1ac)]===_0x24e9cf(0x125)&&(_0x577099['strokeStyle']=GCODE_POINT_DRILL_COLOR,_0x577099['lineWidth']=1.5,_0x577099[_0x24e9cf(0xfe)](_0x5acc98['x']-_0x2d90ed*1.5,_0x5acc98['y']),_0x577099[_0x24e9cf(0x156)](_0x5acc98['x']+_0x2d90ed*1.5,_0x5acc98['y']),_0x577099[_0x24e9cf(0xfe)](_0x5acc98['x'],_0x5acc98['y']-_0x2d90ed*1.5),_0x577099[_0x24e9cf(0x156)](_0x5acc98['x'],_0x5acc98['y']+_0x2d90ed*1.5),_0x577099[_0x24e9cf(0xef)]());}),boltCircleSets[_0xa1ac46(0x2bf)](_0x3738a5=>{const _0x182a15=_0xa1ac46;let _0x43a0f5=_0x3738a5[_0x182a15(0x184)];worldScaleFactor&&_0x3738a5[_0x182a15(0x1f0)]!=='px'&&(_0x43a0f5=_0x3738a5[_0x182a15(0x184)]*worldScaleFactor),_0x577099[_0x182a15(0x104)](),_0x577099[_0x182a15(0x223)](_0x3738a5['centerX'],_0x3738a5[_0x182a15(0x22a)],_0x43a0f5,0x0,0x2*Math['PI']),_0x577099['strokeStyle']=BOLT_CIRCLE_REF_LINE_COLOR,_0x577099[_0x182a15(0xf8)]=0x1,_0x577099[_0x182a15(0x2cc)]([0x4,0x4]),_0x577099[_0x182a15(0xef)](),_0x577099['setLineDash']([]),_0x3738a5['points'][_0x182a15(0x2bf)](_0x589694=>{const _0x3e6f57=_0x182a15,_0x3b14aa=BOLT_CIRCLE_POINT_RADIUS_IMG_PX;_0x577099[_0x3e6f57(0x104)](),_0x577099[_0x3e6f57(0x223)](_0x589694['x'],_0x589694['y'],_0x3b14aa,0x0,0x2*Math['PI']),_0x577099[_0x3e6f57(0x2eb)]=BOLT_CIRCLE_POINT_COLOR,_0x577099['fill']();});});if(toolPathPoints[_0xa1ac46(0x107)]>0x0){if(showToolPathLines&&toolPathPoints[_0xa1ac46(0x107)]>0x1){_0x577099['beginPath'](),_0x577099[_0xa1ac46(0xfe)](toolPathPoints[0x0][_0xa1ac46(0x2ed)],toolPathPoints[0x0][_0xa1ac46(0x1b7)]);for(let _0x206223=0x1;_0x206223<toolPathPoints['length'];_0x206223++){_0x577099[_0xa1ac46(0x156)](toolPathPoints[_0x206223][_0xa1ac46(0x2ed)],toolPathPoints[_0x206223][_0xa1ac46(0x1b7)]);}_0x577099[_0xa1ac46(0x228)]=TOOL_PATH_LINE_COLOR,_0x577099[_0xa1ac46(0xf8)]=1.5,_0x577099[_0xa1ac46(0xef)]();}toolPathPoints[_0xa1ac46(0x2bf)](_0x1c441a=>{const _0xf3cbb3=_0xa1ac46;let _0x10c511;if(worldScaleFactor&&virtualToolDiameter>0x0)_0x10c511=virtualToolDiameter/0x2*worldScaleFactor;else virtualToolDiameter>0x0?_0x10c511=virtualToolDiameter/0x2:_0x10c511=POINT_INDICATOR_RADIUS_IMG_PX*0.8;_0x10c511>0x0&&virtualToolDiameter>0x0&&(_0x577099[_0xf3cbb3(0x104)](),_0x577099[_0xf3cbb3(0x223)](_0x1c441a[_0xf3cbb3(0x2ed)],_0x1c441a[_0xf3cbb3(0x1b7)],_0x10c511,0x0,0x2*Math['PI']),_0x577099[_0xf3cbb3(0x2eb)]=VIRTUAL_TOOL_COLOR,_0x577099[_0xf3cbb3(0x12d)]());if(showToolPathLines||toolPathPoints[_0xf3cbb3(0x107)]===0x1){const _0x39e9a7=POINT_INDICATOR_RADIUS_IMG_PX*0.5;_0x577099[_0xf3cbb3(0x104)](),_0x577099[_0xf3cbb3(0x223)](_0x1c441a[_0xf3cbb3(0x2ed)],_0x1c441a[_0xf3cbb3(0x1b7)],_0x39e9a7,0x0,0x2*Math['PI']),_0x577099[_0xf3cbb3(0x2eb)]=TOOL_PATH_POINT_COLOR,_0x577099[_0xf3cbb3(0x12d)]();}});}placedSnapPoints[_0xa1ac46(0x2bf)](_0x4b496e=>{const _0x2b3fbf=_0xa1ac46,_0x35858c=MANUAL_SNAP_POINT_RADIUS_IMG_PX;_0x577099[_0x2b3fbf(0x228)]=MANUAL_SNAP_POINT_COLOR,_0x577099['lineWidth']=1.5,_0x577099['beginPath'](),_0x577099[_0x2b3fbf(0xfe)](_0x4b496e['x']-_0x35858c,_0x4b496e['y']),_0x577099['lineTo'](_0x4b496e['x']+_0x35858c,_0x4b496e['y']),_0x577099[_0x2b3fbf(0xfe)](_0x4b496e['x'],_0x4b496e['y']-_0x35858c),_0x577099['lineTo'](_0x4b496e['x'],_0x4b496e['y']+_0x35858c),_0x577099[_0x2b3fbf(0xef)]();});const _0xa707f8=BOLLINO_DEFAULT_RADIUS_IMG_PX*bollinoScaleFactor,_0x2ab1ad=_0xa707f8*TEXT_SIZE_TO_ACTUAL_RADIUS_RATIO;placedBollini[_0xa1ac46(0x2bf)](_0x714152=>{const _0x28e745=_0xa1ac46;drawBollinoOnContext(_0x577099,_0x714152[_0x28e745(0x2e1)],_0x714152['x'],_0x714152['y'],!![],_0xa707f8,_0x2ab1ad);});const _0x241b02=_0x5d17d4[_0xa1ac46(0x29b)]('image/png'),_0x3fa668=document['createElement']('a');_0x3fa668[_0xa1ac46(0x201)]=_0x241b02,_0x3fa668[_0xa1ac46(0x247)]=_0xa1ac46(0x2d6),document['body']['appendChild'](_0x3fa668),_0x3fa668[_0xa1ac46(0x27e)](),document['body']['removeChild'](_0x3fa668),showInfo(_0xa1ac46(0x1c1));}catch(_0x2206db){console[_0xa1ac46(0x256)]('Errore\x20export:',_0x2206db),showInfo(_0xa1ac46(0x2c4));}finally{loader[_0xa1ac46(0x2f8)][_0xa1ac46(0x1ee)]=_0xa1ac46(0x2c1);}},0x32);});function escapeCSV(_0x3ff1be){const _0x2b2481=_0x9a4ea2;if(_0x3ff1be===undefined||_0x3ff1be===null)return'';let _0x5bdd64=String(_0x3ff1be);return(_0x5bdd64['includes'](',')||_0x5bdd64['includes']('\x22')||_0x5bdd64[_0x2b2481(0x295)]('\x0a')||_0x5bdd64['includes']('\x0d'))&&(_0x5bdd64='\x22'+_0x5bdd64[_0x2b2481(0x164)](/"/g,'\x22\x22')+'\x22'),_0x5bdd64;};function exportAllDataToCSV(){const _0x3eeef9=_0x9a4ea2;if(!currentImage||!currentImage[_0x3eeef9(0x106)]||currentImage[_0x3eeef9(0x298)]===0x0){showInfo(_0x3eeef9(0xf0));return;}const _0x1a692d=placedBollini[_0x3eeef9(0x107)]>0x0||toolPathPoints['length']>0x0||boltCircleSets[_0x3eeef9(0x107)]>0x0;if(!_0x1a692d){showInfo(_0x3eeef9(0x16d));return;}showInfo('Preparazione\x20dati\x20CSV\x20generali...'),loader[_0x3eeef9(0x2f8)][_0x3eeef9(0x1ee)]=_0x3eeef9(0x279),setTimeout(()=>{const _0x17dd3e=_0x3eeef9;try{let _0x3d88ce='';if(placedBollini['length']>0x0){const _0x15660f=[_0x17dd3e(0x122),'Etichetta\x20Bollino',_0x17dd3e(0x105),_0x17dd3e(0x199),_0x17dd3e(0x189),_0x17dd3e(0x1e3),_0x17dd3e(0x154)+worldScaleUnit+')',_0x17dd3e(0x19d)+worldScaleUnit+')'];cncZeroPoints[_0x17dd3e(0x2bf)](_0x1c3d6d=>{const _0xf1d069=_0x17dd3e;_0x15660f['push']('X\x20Rel.\x20'+_0x1c3d6d['name']+_0xf1d069(0x132)),_0x15660f[_0xf1d069(0x1c9)](_0xf1d069(0x268)+_0x1c3d6d['name']+_0xf1d069(0x132)),_0x15660f[_0xf1d069(0x1c9)]('X\x20Rel.\x20'+_0x1c3d6d['name']+'\x20('+worldScaleUnit+')'),_0x15660f[_0xf1d069(0x1c9)](_0xf1d069(0x268)+_0x1c3d6d[_0xf1d069(0x15e)]+'\x20('+worldScaleUnit+')');}),_0x15660f[_0x17dd3e(0x1c9)]('Descrizione\x20Associata','Tolleranza\x20(da\x20CSV)',_0x17dd3e(0x20a));const _0x3f332f=[_0x15660f[_0x17dd3e(0x24f)](',')];placedBollini['forEach'](_0x53d837=>{const _0x231a6c=_0x17dd3e;let _0x53e204=[_0x231a6c(0x2d9),escapeCSV(_0x53d837['letter']),_0x53d837['x']['toFixed'](0x2),_0x53d837['y'][_0x231a6c(0x30c)](0x2)];customOriginPoint?(_0x53e204[_0x231a6c(0x1c9)]((_0x53d837['x']-customOriginPoint['x'])[_0x231a6c(0x30c)](0x2),(_0x53d837['y']-customOriginPoint['y'])['toFixed'](0x2)),worldScaleFactor?(_0x53e204[_0x231a6c(0x1c9)](roundToFirstDecimal((_0x53d837['x']-customOriginPoint['x'])/worldScaleFactor)),_0x53e204[_0x231a6c(0x1c9)](roundToFirstDecimal(-((_0x53d837['y']-customOriginPoint['y'])/worldScaleFactor)))):_0x53e204[_0x231a6c(0x1c9)]('','')):_0x53e204[_0x231a6c(0x1c9)]('','','',''),cncZeroPoints[_0x231a6c(0x2bf)](_0x32a065=>{const _0x2aac12=_0x231a6c;_0x53e204[_0x2aac12(0x1c9)]((_0x53d837['x']-_0x32a065['x'])[_0x2aac12(0x30c)](0x2),(_0x53d837['y']-_0x32a065['y'])[_0x2aac12(0x30c)](0x2)),worldScaleFactor?(_0x53e204[_0x2aac12(0x1c9)](roundToFirstDecimal((_0x53d837['x']-_0x32a065['x'])/worldScaleFactor)),_0x53e204[_0x2aac12(0x1c9)](roundToFirstDecimal(-((_0x53d837['y']-_0x32a065['y'])/worldScaleFactor)))):_0x53e204[_0x2aac12(0x1c9)]('','');}),_0x53e204[_0x231a6c(0x1c9)](escapeCSV(_0x53d837['text']),escapeCSV(_0x53d837[_0x231a6c(0x260)]),escapeCSV(_0x53d837[_0x231a6c(0x309)])),_0x3f332f[_0x231a6c(0x1c9)](_0x53e204[_0x231a6c(0x10b)](escapeCSV)[_0x231a6c(0x24f)](','));}),_0x3d88ce+=_0x17dd3e(0xfc)+_0x3f332f[_0x17dd3e(0x24f)]('\x0a')+'\x0a\x0a';}if(boltCircleSets[_0x17dd3e(0x107)]>0x0){const _0x1f1893=[_0x17dd3e(0x122),'Set\x20#','Punto\x20#',_0x17dd3e(0x105),_0x17dd3e(0x199),_0x17dd3e(0x213),_0x17dd3e(0x222),'Raggio\x20('+worldScaleUnit+')',_0x17dd3e(0x2c7),'#\x20Fori\x20Totali'],_0x5d7d4d=[_0x1f1893[_0x17dd3e(0x24f)](',')];boltCircleSets[_0x17dd3e(0x2bf)]((_0x3ddd65,_0x3b56cf)=>{const _0x49bb7a=_0x17dd3e;_0x3ddd65[_0x49bb7a(0xff)][_0x49bb7a(0x2bf)]((_0x214475,_0x383e21)=>{const _0x5e29e3=_0x49bb7a;let _0x17e391=[_0x5e29e3(0x314),_0x3b56cf+0x1,_0x383e21+0x1,_0x214475['x'][_0x5e29e3(0x30c)](0x2),_0x214475['y'][_0x5e29e3(0x30c)](0x2),_0x3ddd65[_0x5e29e3(0x2f3)][_0x5e29e3(0x30c)](0x2),_0x3ddd65[_0x5e29e3(0x22a)][_0x5e29e3(0x30c)](0x2),_0x3ddd65[_0x5e29e3(0x184)][_0x5e29e3(0x30c)](0x3),_0x3ddd65[_0x5e29e3(0x29a)],_0x3ddd65['numHoles']];_0x5d7d4d['push'](_0x17e391['map'](escapeCSV)[_0x5e29e3(0x24f)](','));});}),_0x3d88ce+=_0x17dd3e(0x30d)+_0x5d7d4d[_0x17dd3e(0x24f)]('\x0a')+'\x0a\x0a';}if(toolPathPoints[_0x17dd3e(0x107)]>0x0){const _0x36fbce=[_0x17dd3e(0x122),'Punto\x20#',_0x17dd3e(0x105),'Y\x20Immagine\x20(px)',_0x17dd3e(0x2b0),_0x17dd3e(0x12b)+(worldScaleFactor?worldScaleUnit:'px')+')',_0x17dd3e(0x2bd)+(worldScaleFactor?worldScaleUnit:'px')+')'],_0x484ea3=[_0x36fbce[_0x17dd3e(0x24f)](',')];toolPathPoints[_0x17dd3e(0x2bf)]((_0xdc3887,_0x284987)=>{const _0x387aa5=_0x17dd3e,_0x14f7a6=['PercorsoFresa',_0x284987+0x1,_0xdc3887[_0x387aa5(0x2ed)][_0x387aa5(0x30c)](0x2),_0xdc3887[_0x387aa5(0x1b7)][_0x387aa5(0x30c)](0x2),escapeCSV(_0xdc3887['refOriginName']),_0xdc3887['relX']['toFixed'](worldScaleFactor?0x3:0x1),_0xdc3887['relY'][_0x387aa5(0x30c)](worldScaleFactor?0x3:0x1)];_0x484ea3[_0x387aa5(0x1c9)](_0x14f7a6[_0x387aa5(0x10b)](escapeCSV)[_0x387aa5(0x24f)](','));}),_0x3d88ce+='Dati\x20Percorso\x20Fresa:\x0a'+_0x484ea3[_0x17dd3e(0x24f)]('\x0a')+'\x0a';}const _0x20ae28=new Blob(['\ufeff'+_0x3d88ce],{'type':_0x17dd3e(0x2d8)}),_0x2d093a=document[_0x17dd3e(0x15a)]('a'),_0x43de28=URL['createObjectURL'](_0x20ae28);_0x2d093a['setAttribute']('href',_0x43de28),_0x2d093a[_0x17dd3e(0x2fa)]('download','dati_generali_disegno.csv'),_0x2d093a[_0x17dd3e(0x2f8)][_0x17dd3e(0x219)]=_0x17dd3e(0x2fe),document[_0x17dd3e(0x2bc)][_0x17dd3e(0xe1)](_0x2d093a),_0x2d093a[_0x17dd3e(0x27e)](),document[_0x17dd3e(0x2bc)][_0x17dd3e(0x19e)](_0x2d093a),showInfo(_0x17dd3e(0x1b3));}catch(_0xf336c3){console[_0x17dd3e(0x256)](_0x17dd3e(0x2e0),_0xf336c3),showInfo(_0x17dd3e(0x12e));}finally{loader[_0x17dd3e(0x2f8)][_0x17dd3e(0x1ee)]=_0x17dd3e(0x2c1);}},0x32);}exportDataButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),exportAllDataToCSV);function exportDimensionsTableToCSV(){const _0x33f9a1=_0x9a4ea2;if(dimensionData['length']===0x0){showInfo(_0x33f9a1(0x15d));return;}showInfo('Preparazione\x20dati\x20CSV\x20delle\x20quote...'),loader[_0x33f9a1(0x2f8)][_0x33f9a1(0x1ee)]='block',setTimeout(()=>{const _0x2d996f=_0x33f9a1;try{const _0x48c5e9=[_0x2d996f(0x315),_0x2d996f(0x239),_0x2d996f(0x153),'Misurato'],_0x42f9a5=[_0x48c5e9[_0x2d996f(0x24f)](',')];dimensionData[_0x2d996f(0x2bf)](_0x3771ed=>{const _0x54abf7=_0x2d996f,_0x292908=[escapeCSV(_0x3771ed[_0x54abf7(0x315)]),escapeCSV(_0x3771ed[_0x54abf7(0x239)]),escapeCSV(_0x3771ed[_0x54abf7(0x260)]),escapeCSV(_0x3771ed['misurato'])];_0x42f9a5['push'](_0x292908[_0x54abf7(0x24f)](','));});const _0xd4b8=_0x42f9a5[_0x2d996f(0x24f)]('\x0a'),_0x5aea41=new Blob(['\ufeff'+_0xd4b8],{'type':'text/csv;charset=utf-8;'}),_0x377bab=document['createElement']('a'),_0x356056=URL[_0x2d996f(0xda)](_0x5aea41);_0x377bab['setAttribute'](_0x2d996f(0x201),_0x356056),_0x377bab[_0x2d996f(0x2fa)](_0x2d996f(0x247),_0x2d996f(0x1f3)),_0x377bab[_0x2d996f(0x2f8)][_0x2d996f(0x219)]=_0x2d996f(0x2fe),document['body'][_0x2d996f(0xe1)](_0x377bab),_0x377bab['click'](),document[_0x2d996f(0x2bc)][_0x2d996f(0x19e)](_0x377bab),showInfo(_0x2d996f(0x27a));}catch(_0x402076){console[_0x2d996f(0x256)]('Errore\x20export\x20CSV\x20quote:',_0x402076),showInfo(_0x2d996f(0x2c8));}finally{loader[_0x2d996f(0x2f8)][_0x2d996f(0x1ee)]=_0x2d996f(0x2c1);}},0x32);}exportCsvQuotesButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),exportDimensionsTableToCSV);function renderCustomTable(){const _0x165b9a=_0x9a4ea2;customDataTableBody[_0x165b9a(0x242)]='';if(customTableEntries[_0x165b9a(0x107)]===0x0){customTablePlaceholder[_0x165b9a(0x2f8)][_0x165b9a(0x1ee)]=_0x165b9a(0x279),customDataTableContainer['style'][_0x165b9a(0x1ee)]=_0x165b9a(0x2c1),exportCustomTableButton[_0x165b9a(0x2f8)][_0x165b9a(0x1ee)]='none';return;}customTablePlaceholder[_0x165b9a(0x2f8)][_0x165b9a(0x1ee)]=_0x165b9a(0x2c1),customDataTableContainer['style']['display']=_0x165b9a(0x279),exportCustomTableButton[_0x165b9a(0x2f8)]['display']='block',customTableEntries[_0x165b9a(0x2bf)]((_0x1ee9cc,_0x250149)=>{const _0x51224d=_0x165b9a,_0x3d3fe3=customDataTableBody[_0x51224d(0x21d)]();_0x3d3fe3[_0x51224d(0x237)]['index']=_0x250149;const _0x2a3c58=_0x3d3fe3['insertCell']();_0x2a3c58[_0x51224d(0x297)]=_0x1ee9cc['id'],_0x2a3c58[_0x51224d(0x1ab)]=_0x51224d(0x255),_0x2a3c58['addEventListener']('blur',_0x36f9cc=>updateCustomTableEntry(_0x250149,'id',_0x36f9cc[_0x51224d(0x136)][_0x51224d(0x297)]));const _0x1e73c2=_0x3d3fe3[_0x51224d(0x2ae)]();_0x1e73c2[_0x51224d(0x297)]=_0x1ee9cc['description'],_0x1e73c2[_0x51224d(0x1ab)]=_0x51224d(0x255),_0x1e73c2[_0x51224d(0x1b0)](_0x51224d(0xf6),_0x17be33=>updateCustomTableEntry(_0x250149,_0x51224d(0x1bd),_0x17be33['target'][_0x51224d(0x297)]));const _0x3fffb9=_0x3d3fe3[_0x51224d(0x2ae)]();_0x3fffb9['textContent']=_0x1ee9cc[_0x51224d(0x1d3)],_0x3fffb9[_0x51224d(0x1ab)]=_0x51224d(0x255),_0x3fffb9[_0x51224d(0x1b0)]('blur',_0x17888f=>updateCustomTableEntry(_0x250149,'notes',_0x17888f[_0x51224d(0x136)][_0x51224d(0x297)]));const _0x12a24a=_0x3d3fe3[_0x51224d(0x2ae)](),_0x561020=document['createElement'](_0x51224d(0xe8));_0x561020[_0x51224d(0x242)]='<i\x20class=\x22fas\x20fa-times\x22></i>',_0x561020[_0x51224d(0x1c2)]=_0x51224d(0x109),_0x561020[_0x51224d(0x2a5)][_0x51224d(0x23c)](_0x51224d(0x22b)),_0x561020[_0x51224d(0x146)]=()=>deleteCustomTableRow(_0x250149),_0x12a24a[_0x51224d(0xe1)](_0x561020);});}function updateCustomTableEntry(_0x568a56,_0x2f7ad0,_0x103ad4){const _0x29b857=_0x9a4ea2;customTableEntries[_0x568a56]&&(customTableEntries[_0x568a56][_0x2f7ad0]=_0x103ad4[_0x29b857(0x231)]());}function addCustomTableRow(){const _0x5f4d97=_0x9a4ea2;customTableEntries[_0x5f4d97(0x1c9)]({'id':'ID-'+(customTableEntries[_0x5f4d97(0x107)]+0x1),'description':'','notes':''}),renderCustomTable(),showInfo('Nuova\x20riga\x20aggiunta\x20alla\x20tabella\x20personalizzata.\x20Modifica\x20le\x20celle.');}addCustomTableRowButton['addEventListener'](_0x9a4ea2(0x27e),addCustomTableRow);function deleteCustomTableRow(_0x51493e){const _0x4dddd2=_0x9a4ea2;customTableEntries[_0x4dddd2(0x294)](_0x51493e,0x1),renderCustomTable(),showInfo('Riga\x20eliminata\x20dalla\x20tabella\x20personalizzata.');}clearCustomTableButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x34cb8a=_0x9a4ea2;if(customTableEntries[_0x34cb8a(0x107)]===0x0){showInfo(_0x34cb8a(0x1a2));return;}confirmClearModalText[_0x34cb8a(0x297)]=_0x34cb8a(0x25c),confirmClearModal['dataset']['clearType']='customTable',confirmClearModal[_0x34cb8a(0x2a5)][_0x34cb8a(0x23c)](_0x34cb8a(0x159));});function exportCustomTableToCSV(){const _0xee2a18=_0x9a4ea2;if(customTableEntries[_0xee2a18(0x107)]===0x0){showInfo(_0xee2a18(0x28f));return;}showInfo(_0xee2a18(0x205)),loader[_0xee2a18(0x2f8)][_0xee2a18(0x1ee)]=_0xee2a18(0x279),setTimeout(()=>{const _0x3f7f67=_0xee2a18;try{const _0x5c20a0=[_0x3f7f67(0x24a),_0x3f7f67(0x1ca),_0x3f7f67(0x1bc)],_0x330ed6=[_0x5c20a0['join'](',')];customTableEntries[_0x3f7f67(0x2bf)](_0x49df9b=>{const _0x26156b=_0x3f7f67,_0x3ef7df=[escapeCSV(_0x49df9b['id']),escapeCSV(_0x49df9b[_0x26156b(0x1bd)]),escapeCSV(_0x49df9b['notes'])];_0x330ed6[_0x26156b(0x1c9)](_0x3ef7df[_0x26156b(0x24f)](','));});const _0x576d8d=_0x330ed6[_0x3f7f67(0x24f)]('\x0a'),_0x41219b=new Blob(['\ufeff'+_0x576d8d],{'type':_0x3f7f67(0x2d8)}),_0x4d9c22=document['createElement']('a'),_0x451c02=URL[_0x3f7f67(0xda)](_0x41219b);_0x4d9c22['setAttribute'](_0x3f7f67(0x201),_0x451c02),_0x4d9c22[_0x3f7f67(0x2fa)](_0x3f7f67(0x247),_0x3f7f67(0x16b)),_0x4d9c22[_0x3f7f67(0x2f8)][_0x3f7f67(0x219)]=_0x3f7f67(0x2fe),document[_0x3f7f67(0x2bc)][_0x3f7f67(0xe1)](_0x4d9c22),_0x4d9c22[_0x3f7f67(0x27e)](),document[_0x3f7f67(0x2bc)][_0x3f7f67(0x19e)](_0x4d9c22),showInfo(_0x3f7f67(0x203));}catch(_0x5c530f){console[_0x3f7f67(0x256)]('Errore\x20export\x20CSV\x20tabella\x20personalizzata:',_0x5c530f),showInfo(_0x3f7f67(0x165));}finally{loader[_0x3f7f67(0x2f8)]['display']=_0x3f7f67(0x2c1);}},0x32);}exportCustomTableButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),exportCustomTableToCSV);function populateToolPathOriginSelect(){const _0x41a215=_0x9a4ea2,_0x3292ab=toolPathReferenceOriginSelect[_0x41a215(0x114)];toolPathReferenceOriginSelect[_0x41a215(0x242)]=_0x41a215(0x1c5);let _0x3f9dec=0x0,_0x577825=0x1;if(customOriginPoint){const _0x35c02e=document['createElement']('option');_0x35c02e[_0x41a215(0x114)]=_0x41a215(0x2c3),_0x35c02e[_0x41a215(0x297)]=_0x41a215(0x13a),toolPathReferenceOriginSelect[_0x41a215(0xe1)](_0x35c02e);if(_0x3292ab===_0x35c02e[_0x41a215(0x114)])_0x3f9dec=_0x577825;_0x577825++;}cncZeroPoints[_0x41a215(0x2bf)]((_0x316ece,_0x5502e0)=>{const _0xb4d15=_0x41a215,_0x3b6c4c=document[_0xb4d15(0x15a)](_0xb4d15(0x2c5));_0x3b6c4c['value']=_0xb4d15(0x2a7)+_0x5502e0,_0x3b6c4c[_0xb4d15(0x297)]='Origine\x20CNC:\x20'+_0x316ece[_0xb4d15(0x15e)],toolPathReferenceOriginSelect[_0xb4d15(0xe1)](_0x3b6c4c);if(_0x3292ab===_0x3b6c4c[_0xb4d15(0x114)])_0x3f9dec=_0x577825;_0x577825++;}),toolPathReferenceOriginSelect[_0x41a215(0x1c0)]=_0x3f9dec,updateActiveToolPathOrigin();}function updateActiveToolPathOrigin(){const _0xa7d5d3=_0x9a4ea2,_0x142bde=toolPathReferenceOriginSelect[_0xa7d5d3(0x114)];if(!_0x142bde){activeToolPathOriginDetails=null;if(activeMode===_0xa7d5d3(0x16c))showInfo(_0xa7d5d3(0x232));return;}if(_0x142bde===_0xa7d5d3(0x2c3)&&customOriginPoint)activeToolPathOriginDetails={'name':_0xa7d5d3(0x2a0),'type':'main','imgX':customOriginPoint['x'],'imgY':customOriginPoint['y']};else{if(_0x142bde[_0xa7d5d3(0x275)]('cnc_origin_')){const _0x142844=parseInt(_0x142bde[_0xa7d5d3(0x1c3)]('_')[0x2],0xa);if(cncZeroPoints[_0x142844]){const _0x31d7e5=cncZeroPoints[_0x142844];activeToolPathOriginDetails={'name':_0x31d7e5['name'],'type':'cnc','imgX':_0x31d7e5['x'],'imgY':_0x31d7e5['y']};}else activeToolPathOriginDetails=null;}else activeToolPathOriginDetails=null;}activeMode==='defineToolPath'&&(activeToolPathOriginDetails?showInfo(_0xa7d5d3(0x29e)+activeToolPathOriginDetails[_0xa7d5d3(0x15e)]+_0xa7d5d3(0x21c)):showInfo(_0xa7d5d3(0x303))),redrawCanvas();}function renderToolPathTable(){const _0x44d2a9=_0x9a4ea2;toolPathTableBody['innerHTML']='';if(toolPathPoints['length']===0x0){toolPathTablePlaceholder[_0x44d2a9(0x2f8)][_0x44d2a9(0x1ee)]=_0x44d2a9(0x279),toolPathTableContainer[_0x44d2a9(0x2f8)][_0x44d2a9(0x1ee)]='none';return;}toolPathTablePlaceholder[_0x44d2a9(0x2f8)]['display']=_0x44d2a9(0x2c1),toolPathTableContainer['style'][_0x44d2a9(0x1ee)]=_0x44d2a9(0x279),toolPathPoints[_0x44d2a9(0x2bf)]((_0x4bcd95,_0x2c47b0)=>{const _0x3499c4=_0x44d2a9,_0x2cc5ce=toolPathTableBody[_0x3499c4(0x21d)]();_0x2cc5ce[_0x3499c4(0x2ae)]()[_0x3499c4(0x297)]=_0x2c47b0+0x1,_0x2cc5ce['insertCell']()['textContent']=_0x4bcd95[_0x3499c4(0x280)];const _0x2ab539=worldScaleFactor?'\x20('+worldScaleUnit+')':_0x3499c4(0x132);_0x2cc5ce[_0x3499c4(0x2ae)]()['textContent']=_0x4bcd95[_0x3499c4(0x11c)][_0x3499c4(0x30c)](worldScaleFactor?0x3:0x1)+_0x2ab539,_0x2cc5ce['insertCell']()[_0x3499c4(0x297)]=_0x4bcd95[_0x3499c4(0x111)][_0x3499c4(0x30c)](worldScaleFactor?0x3:0x1)+_0x2ab539;const _0x24c939=_0x2cc5ce['insertCell'](),_0x8269da=document[_0x3499c4(0x15a)](_0x3499c4(0xe8));_0x8269da[_0x3499c4(0x242)]='<i\x20class=\x22fas\x20fa-times\x22></i>',_0x8269da[_0x3499c4(0x1c2)]=_0x3499c4(0xf7),_0x8269da[_0x3499c4(0x2a5)][_0x3499c4(0x23c)]('delete-row-btn',_0x3499c4(0x27c),_0x3499c4(0x267)),_0x8269da[_0x3499c4(0x146)]=()=>{const _0x208748=_0x3499c4;toolPathPoints[_0x208748(0x294)](_0x2c47b0,0x1),renderToolPathTable(),redrawCanvas(),showInfo(_0x208748(0x207)+(_0x2c47b0+0x1)+'\x20rimosso\x20dal\x20percorso\x20fresa.');},_0x24c939[_0x3499c4(0xe1)](_0x8269da);});}function _0x58a9(_0x2083a2,_0x3e6bd4){const _0x1fa28b=_0x1fa2();return _0x58a9=function(_0x58a990,_0x379a41){_0x58a990=_0x58a990-0xda;let _0x36f34d=_0x1fa28b[_0x58a990];return _0x36f34d;},_0x58a9(_0x2083a2,_0x3e6bd4);}toolPathReferenceOriginSelect[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),updateActiveToolPathOrigin),virtualToolDiameterInput[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x1dc),()=>{const _0x39df48=_0x9a4ea2,_0x4ff707=parseFloat(virtualToolDiameterInput[_0x39df48(0x114)]);virtualToolDiameter=isNaN(_0x4ff707)||_0x4ff707<0x0?0x0:_0x4ff707;if(activeMode===_0x39df48(0x16c))redrawCanvas();}),showToolPathLinesCheckbox[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),()=>{showToolPathLines=showToolPathLinesCheckbox['checked'],redrawCanvas();}),addManualToolPathPointButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0xb1ea76=_0x9a4ea2;if(activeMode!==_0xb1ea76(0x16c)){showInfo(_0xb1ea76(0x25b));return;}if(!activeToolPathOriginDetails){showInfo('ERRORE:\x20Seleziona\x20un\x27Origine\x20Riferimento\x20per\x20il\x20percorso\x20fresa.');return;}const _0x5ee78a=parseFloat(manualToolPathXInput['value']),_0x1d78d2=parseFloat(manualToolPathYInput['value']);if(isNaN(_0x5ee78a)||isNaN(_0x1d78d2)){showInfo('ERRORE:\x20Inserisci\x20valori\x20X\x20e\x20Y\x20numerici\x20validi.');return;}let _0x89318f,_0x88b88d;worldScaleFactor?(_0x89318f=activeToolPathOriginDetails['imgX']+_0x5ee78a*worldScaleFactor,_0x88b88d=activeToolPathOriginDetails['imgY']-_0x1d78d2*worldScaleFactor):(_0x89318f=activeToolPathOriginDetails['imgX']+_0x5ee78a,_0x88b88d=activeToolPathOriginDetails[_0xb1ea76(0x1b7)]-_0x1d78d2);const _0x27ef2e={'imgX':_0x89318f,'imgY':_0x88b88d,'relX':_0x5ee78a,'relY':_0x1d78d2,'refOriginName':activeToolPathOriginDetails[_0xb1ea76(0x15e)],'refOriginType':activeToolPathOriginDetails[_0xb1ea76(0x1ac)],'refOriginImgX':activeToolPathOriginDetails['imgX'],'refOriginImgY':activeToolPathOriginDetails['imgY']};toolPathPoints['push'](_0x27ef2e),renderToolPathTable(),redrawCanvas(),showInfo(_0xb1ea76(0x207)+toolPathPoints['length']+_0xb1ea76(0x26b)+activeToolPathOriginDetails[_0xb1ea76(0x15e)]+'.'),manualToolPathXInput[_0xb1ea76(0x114)]='',manualToolPathYInput[_0xb1ea76(0x114)]='';});function displayChatMessage(_0x56416a,_0x3522bb){const _0x4071da=_0x9a4ea2,_0x3b7271=document[_0x4071da(0x15a)](_0x4071da(0x1a7));_0x3b7271['classList']['add'](_0x4071da(0x20b),_0x3522bb);if(typeof _0x56416a===_0x4071da(0x2b5)){const _0x1f722f=document[_0x4071da(0x15a)]('p');_0x1f722f[_0x4071da(0x297)]=_0x56416a,_0x3b7271['appendChild'](_0x1f722f);}else{if(typeof _0x56416a===_0x4071da(0x1a0)&&_0x56416a!==null){if(_0x56416a[_0x4071da(0x10d)]){const _0x22f998=document[_0x4071da(0x15a)]('p');_0x22f998[_0x4071da(0x297)]=_0x56416a[_0x4071da(0x10d)],_0x3b7271['appendChild'](_0x22f998);}if(_0x56416a['imageSrc']){const _0xd27e0=document[_0x4071da(0x15a)](_0x4071da(0x2c9));_0xd27e0['src']=_0x56416a[_0x4071da(0x168)],_0xd27e0['alt']=_0x56416a[_0x4071da(0x120)]||_0x4071da(0xf2),_0x3b7271[_0x4071da(0xe1)](_0xd27e0);}}}aiChatDisplay[_0x4071da(0xe1)](_0x3b7271),aiChatDisplay[_0x4071da(0x118)]=aiChatDisplay[_0x4071da(0x210)];}function resetAiChatImageSelection(){const _0x293693=_0x9a4ea2;currentAiChatImage[_0x293693(0x14d)]=null,currentAiChatImage[_0x293693(0x28d)]=null,currentAiChatImage[_0x293693(0x2bb)]=null,aiChatImagePreview[_0x293693(0x1df)]='#',aiChatImagePreviewContainer['style'][_0x293693(0x1ee)]='none',aiChatFileInput[_0x293693(0x114)]='';}async function handleSendAiPrompt(){const _0x3ded2d=_0x9a4ea2,_0x338777=aiChatPromptInput['value'][_0x3ded2d(0x231)]();if(!_0x338777&&!currentAiChatImage[_0x3ded2d(0x14d)]){displayChatMessage(_0x3ded2d(0x144),'error');return;}const _0x59c6a3=[];_0x338777&&_0x59c6a3[_0x3ded2d(0x1c9)]({'text':_0x338777});currentAiChatImage[_0x3ded2d(0x14d)]&&currentAiChatImage['mimeType']&&_0x59c6a3[_0x3ded2d(0x1c9)]({'inlineData':{'mimeType':currentAiChatImage[_0x3ded2d(0x28d)],'data':currentAiChatImage['base64']}});const _0x6e5753={};if(_0x338777)_0x6e5753[_0x3ded2d(0x10d)]=_0x338777;currentAiChatImage[_0x3ded2d(0x14d)]&&(_0x6e5753[_0x3ded2d(0x168)]=_0x3ded2d(0x1ff)+currentAiChatImage[_0x3ded2d(0x28d)]+_0x3ded2d(0x2a8)+currentAiChatImage['base64'],_0x6e5753['imageFileName']=currentAiChatImage[_0x3ded2d(0x2bb)]);displayChatMessage(_0x6e5753,_0x3ded2d(0x251)),aiChatHistory[_0x3ded2d(0x1c9)]({'role':_0x3ded2d(0x251),'parts':_0x59c6a3}),aiChatPromptInput['value']='',resetAiChatImageSelection(),aiChatLoader['style']['display']=_0x3ded2d(0x279),sendAiPromptButton['disabled']=!![],attachAiFileButton[_0x3ded2d(0x1d4)]=!![];const _0x58e224={'contents':aiChatHistory},_0x2cd1b1='',_0x35f25f=_0x3ded2d(0x282)+_0x2cd1b1;try{const _0x2b00af=await fetch(_0x35f25f,{'method':'POST','headers':{'Content-Type':_0x3ded2d(0x252)},'body':JSON['stringify'](_0x58e224)});if(!_0x2b00af['ok']){const _0x439445=await _0x2b00af[_0x3ded2d(0xfd)]();let _0x868667=_0x3ded2d(0x18a)+_0x2b00af[_0x3ded2d(0x155)]+_0x3ded2d(0x190)+(_0x439445[_0x3ded2d(0x256)]?.['message']||_0x2b00af[_0x3ded2d(0x141)]);if(_0x439445[_0x3ded2d(0x256)]?.['details'])_0x868667+=_0x3ded2d(0x2d1)+JSON[_0x3ded2d(0x183)](_0x439445[_0x3ded2d(0x256)][_0x3ded2d(0x286)]);throw new Error(_0x868667);}const _0x1f036a=await _0x2b00af['json']();if(_0x1f036a[_0x3ded2d(0x1e1)]&&_0x1f036a[_0x3ded2d(0x1e1)][_0x3ded2d(0x107)]>0x0&&_0x1f036a['candidates'][0x0][_0x3ded2d(0x1e9)]&&_0x1f036a[_0x3ded2d(0x1e1)][0x0][_0x3ded2d(0x1e9)][_0x3ded2d(0x30b)]&&_0x1f036a[_0x3ded2d(0x1e1)][0x0][_0x3ded2d(0x1e9)][_0x3ded2d(0x30b)][_0x3ded2d(0x107)]>0x0){const _0x2675d9=_0x1f036a[_0x3ded2d(0x1e1)][0x0][_0x3ded2d(0x1e9)][_0x3ded2d(0x30b)][0x0][_0x3ded2d(0x10d)];displayChatMessage(_0x2675d9,'ai'),aiChatHistory[_0x3ded2d(0x1c9)]({'role':'model','parts':[{'text':_0x2675d9}]});}else{let _0x18cce8=_0x3ded2d(0x230);if(_0x1f036a['promptFeedback']&&_0x1f036a[_0x3ded2d(0x2b2)][_0x3ded2d(0x1a4)]){_0x18cce8+=_0x3ded2d(0x161)+_0x1f036a[_0x3ded2d(0x2b2)][_0x3ded2d(0x1a4)]+'.';if(_0x1f036a['promptFeedback'][_0x3ded2d(0xe9)])_0x18cce8+=_0x3ded2d(0x288)+JSON[_0x3ded2d(0x183)](_0x1f036a['promptFeedback'][_0x3ded2d(0xe9)]);}displayChatMessage(_0x18cce8,_0x3ded2d(0x256)),aiChatHistory[_0x3ded2d(0x107)]>0x0&&aiChatHistory[aiChatHistory[_0x3ded2d(0x107)]-0x1][_0x3ded2d(0x1cc)]===_0x3ded2d(0x251)&&aiChatHistory[_0x3ded2d(0x119)]();}}catch(_0x558758){displayChatMessage(_0x3ded2d(0x254)+_0x558758[_0x3ded2d(0x29d)],_0x3ded2d(0x256)),aiChatHistory[_0x3ded2d(0x107)]>0x0&&aiChatHistory[aiChatHistory[_0x3ded2d(0x107)]-0x1][_0x3ded2d(0x1cc)]==='user'&&aiChatHistory['pop']();}finally{aiChatLoader['style']['display']=_0x3ded2d(0x2c1),sendAiPromptButton[_0x3ded2d(0x1d4)]=![],attachAiFileButton[_0x3ded2d(0x1d4)]=![],aiChatPromptInput[_0x3ded2d(0x2ac)]();}}openAiChatButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x5425a6=_0x9a4ea2;aiChatModal[_0x5425a6(0x2a5)][_0x5425a6(0x23c)]('active'),aiChatDisplay[_0x5425a6(0x245)]['length']===0x0&&(displayChatMessage('Ciao!\x20Come\x20posso\x20aiutarti\x20oggi?\x20Puoi\x20inviarmi\x20testo\x20e\x20immagini.','ai'),aiChatHistory=[{'role':_0x5425a6(0x1a3),'parts':[{'text':_0x5425a6(0x249)}]}]),aiChatPromptInput[_0x5425a6(0x2ac)]();}),closeAiChatButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x467e7d=_0x9a4ea2;aiChatModal[_0x467e7d(0x2a5)][_0x467e7d(0x2dd)](_0x467e7d(0x159)),resetAiChatImageSelection();}),aiChatModal[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),_0x3d9f1f=>{const _0x4b6216=_0x9a4ea2;_0x3d9f1f[_0x4b6216(0x136)]===aiChatModal&&(aiChatModal[_0x4b6216(0x2a5)][_0x4b6216(0x2dd)]('active'),resetAiChatImageSelection());}),attachAiFileButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x53c83d=_0x9a4ea2;aiChatFileInput[_0x53c83d(0x27e)]();}),aiChatFileInput[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2f5),_0x249941=>{const _0x38b326=_0x9a4ea2,_0x3356ee=_0x249941[_0x38b326(0x136)][_0x38b326(0x197)][0x0];if(_0x3356ee&&_0x3356ee[_0x38b326(0x1ac)][_0x38b326(0x275)](_0x38b326(0x1e7))){const _0x10daa2=new FileReader();_0x10daa2[_0x38b326(0x129)]=_0x2acb85=>{const _0x40bbae=_0x38b326;currentAiChatImage[_0x40bbae(0x14d)]=_0x2acb85[_0x40bbae(0x136)][_0x40bbae(0x166)][_0x40bbae(0x1c3)](',')[0x1],currentAiChatImage[_0x40bbae(0x28d)]=_0x3356ee[_0x40bbae(0x1ac)],currentAiChatImage[_0x40bbae(0x2bb)]=_0x3356ee[_0x40bbae(0x15e)],aiChatImagePreview[_0x40bbae(0x1df)]=_0x2acb85[_0x40bbae(0x136)][_0x40bbae(0x166)],aiChatImagePreviewContainer[_0x40bbae(0x2f8)][_0x40bbae(0x1ee)]=_0x40bbae(0x279);},_0x10daa2[_0x38b326(0x1af)](_0x3356ee);}else _0x3356ee&&(displayChatMessage('Formato\x20file\x20non\x20supportato\x20per\x20la\x20chat.',_0x38b326(0x256)),resetAiChatImageSelection());}),removeAiChatImageButton['addEventListener'](_0x9a4ea2(0x27e),()=>{resetAiChatImageSelection();}),sendAiPromptButton[_0x9a4ea2(0x1b0)]('click',handleSendAiPrompt),aiChatPromptInput[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x306),_0x12e858=>{const _0x23b2ac=_0x9a4ea2;_0x12e858[_0x23b2ac(0x241)]===_0x23b2ac(0x258)&&!_0x12e858[_0x23b2ac(0x123)]&&(_0x12e858['preventDefault'](),handleSendAiPrompt());});function handleBoltCircleCalculation(){const _0x46852d=_0x9a4ea2,_0x3b3a61=parseInt(boltCircleNumHoles[_0x46852d(0x114)])||0x0,_0x1627eb=parseFloat(boltCircleStartAngle[_0x46852d(0x114)])||0x0,_0x7f824e=parseFloat(boltCircleCenterX['value'])||0x0,_0x52e332=parseFloat(boltCircleCenterY[_0x46852d(0x114)])||0x0;let _0x446d31=parseFloat(boltCircleRadius[_0x46852d(0x114)])||0x0;const _0x3ed81a=boltCirclePreviewCanvas[_0x46852d(0x1dd)],_0x48942d=boltCirclePreviewCanvas[_0x46852d(0x149)];boltCirclePreviewCtx['fillStyle']='#2d3748',boltCirclePreviewCtx[_0x46852d(0x14b)](0x0,0x0,_0x3ed81a,_0x48942d),boltCircleResultsTableBody['innerHTML']='',lastCalculatedBcPoints=[],generateBoltCircleButton['disabled']=!![],copyBoltCircleTableButton['disabled']=!![];if(_0x3b3a61<0x1||_0x446d31<=0x0||isNaN(_0x7f824e)||isNaN(_0x52e332)){boltCircleResultsTableBody[_0x46852d(0x242)]=_0x46852d(0x25e);return;}let _0x3417be=_0x446d31;const _0x4a326c=worldScaleFactor?worldScaleUnit:'px';worldScaleFactor&&_0x4a326c!=='px'&&(_0x3417be=_0x446d31*worldScaleFactor);const _0xd2df1d=_0x3ed81a*0.4,_0x5902c0=Math['max'](0x2,Math[_0x46852d(0x14e)](0x6,_0x3ed81a/(_0x3b3a61*0x2)));boltCirclePreviewCtx[_0x46852d(0x104)](),boltCirclePreviewCtx['arc'](_0x3ed81a/0x2,_0x48942d/0x2,_0xd2df1d,0x0,0x2*Math['PI']),boltCirclePreviewCtx['strokeStyle']=_0x46852d(0x206),boltCirclePreviewCtx[_0x46852d(0xef)]();for(let _0xf66a76=0x0;_0xf66a76<_0x3b3a61;_0xf66a76++){const _0x59a541=_0x1627eb+_0xf66a76*(0x168/_0x3b3a61),_0x15ea50=_0x59a541*(Math['PI']/0xb4),_0x2dd9ba=_0x7f824e+_0x3417be*Math['cos'](_0x15ea50),_0x538380=_0x52e332+_0x3417be*Math['sin'](_0x15ea50);lastCalculatedBcPoints[_0x46852d(0x1c9)]({'x':_0x2dd9ba,'y':_0x538380});const _0x4a6762=_0x3ed81a/0x2+_0xd2df1d*Math[_0x46852d(0x18e)](_0x15ea50),_0x5dc6a3=_0x48942d/0x2+_0xd2df1d*Math[_0x46852d(0x220)](_0x15ea50);boltCirclePreviewCtx['beginPath'](),boltCirclePreviewCtx['arc'](_0x4a6762,_0x5dc6a3,_0x5902c0,0x0,0x2*Math['PI']),boltCirclePreviewCtx[_0x46852d(0x2eb)]=BOLT_CIRCLE_POINT_COLOR,boltCirclePreviewCtx['fill']();const _0x4d1728=boltCircleResultsTableBody[_0x46852d(0x21d)]();_0x4d1728['innerHTML']=_0x46852d(0x1b8)+(_0xf66a76+0x1)+_0x46852d(0xf4)+_0x2dd9ba[_0x46852d(0x30c)](0x3)+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22p-2\x20text-right\x20text-xs\x20font-mono\x20text-gray-200\x22>'+_0x538380[_0x46852d(0x30c)](0x3)+_0x46852d(0x152);}generateBoltCircleButton['disabled']=![],copyBoltCircleTableButton['disabled']=![];}openBoltCircleCalculatorButton['addEventListener']('click',()=>{const _0x5074f9=_0x9a4ea2;if(!currentImage){showInfo(_0x5074f9(0xea));return;}radiusUnitLabel[_0x5074f9(0x297)]=worldScaleFactor?worldScaleUnit:'px',lastCalculatedBcPoints=[],boltCircleResultsTableBody[_0x5074f9(0x242)]=_0x5074f9(0x25d),generateBoltCircleButton[_0x5074f9(0x1d4)]=!![],copyBoltCircleTableButton[_0x5074f9(0x1d4)]=!![],handleBoltCircleCalculation(),boltCircleModal['classList'][_0x5074f9(0x23c)](_0x5074f9(0x159));}),calculateBoltCircleButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),handleBoltCircleCalculation),pickBoltCircleCenterButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x2fc09c=_0x9a4ea2;boltCircleModal[_0x2fc09c(0x2a5)][_0x2fc09c(0x2dd)](_0x2fc09c(0x159)),setActiveMode('pickBoltCircleCenter');}),generateBoltCircleButton['addEventListener'](_0x9a4ea2(0x27e),()=>{const _0x1ac376=_0x9a4ea2;if(lastCalculatedBcPoints[_0x1ac376(0x107)]===0x0){showInfo(_0x1ac376(0x169));return;}const _0x2e9a18={'centerX':parseFloat(boltCircleCenterX[_0x1ac376(0x114)])||0x0,'centerY':parseFloat(boltCircleCenterY[_0x1ac376(0x114)])||0x0,'radius':parseFloat(boltCircleRadius[_0x1ac376(0x114)])||0x0,'numHoles':parseInt(boltCircleNumHoles[_0x1ac376(0x114)])||0x0,'startAngle':parseFloat(boltCircleStartAngle[_0x1ac376(0x114)])||0x0,'unit':worldScaleFactor?worldScaleUnit:'px','points':lastCalculatedBcPoints};boltCircleSets[_0x1ac376(0x1c9)](_0x2e9a18),showInfo(lastCalculatedBcPoints[_0x1ac376(0x107)]+_0x1ac376(0x14f)),boltCircleModal[_0x1ac376(0x2a5)][_0x1ac376(0x2dd)](_0x1ac376(0x159)),redrawCanvas();}),copyBoltCircleTableButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x4ac45d=_0x9a4ea2,_0x3a3adb=boltCircleResultsTableBody[_0x4ac45d(0x26e)]('tr');if(_0x3a3adb[_0x4ac45d(0x107)]===0x0||_0x3a3adb[0x0][_0x4ac45d(0x245)][_0x4ac45d(0x107)]<0x3)return;let _0x435961=_0x4ac45d(0x2c6);_0x3a3adb[_0x4ac45d(0x2bf)](_0x3c1258=>{const _0x2658cc=_0x4ac45d,_0x3f7d7b=_0x3c1258[_0x2658cc(0x26e)]('td');_0x435961+=_0x3f7d7b[0x0][_0x2658cc(0x236)]+'\x09'+_0x3f7d7b[0x1][_0x2658cc(0x236)]+'\x09'+_0x3f7d7b[0x2]['innerText']+'\x0a';});const _0x4d8536=document[_0x4ac45d(0x15a)](_0x4ac45d(0x238));_0x4d8536[_0x4ac45d(0x114)]=_0x435961,document[_0x4ac45d(0x2bc)]['appendChild'](_0x4d8536),_0x4d8536[_0x4ac45d(0x1ae)]();try{document[_0x4ac45d(0x1a8)]('copy'),copyBcMessage[_0x4ac45d(0x2a5)][_0x4ac45d(0x2dd)]('opacity-0'),setTimeout(()=>{const _0x329d0e=_0x4ac45d;copyBcMessage[_0x329d0e(0x2a5)]['add'](_0x329d0e(0x2a4));},0x7d0);}catch(_0x1c704d){console['error']('Errore\x20copia\x20tabella',_0x1c704d);}document[_0x4ac45d(0x2bc)][_0x4ac45d(0x19e)](_0x4d8536);}),cancelBoltCircleButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0xd63201=_0x9a4ea2;boltCircleModal[_0xd63201(0x2a5)][_0xd63201(0x2dd)]('active'),setActiveMode(null);}),openExternalChatGPTButton[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x27e),()=>{const _0x5e4541=_0x9a4ea2;window['open'](CHATGPT_SHARED_LINK,_0x5e4541(0x225)),showInfo(_0x5e4541(0x23b));}),document[_0x9a4ea2(0x1b0)](_0x9a4ea2(0x2a1),function(){const _0x5ec117=_0x9a4ea2;setupCanvasLayout(),updateUIDisplays(),populateTable(),renderCustomTable(),renderToolPathTable(),populateToolPathOriginSelect(),showToolPathLines=showToolPathLinesCheckbox['checked'],virtualToolDiameter=parseFloat(virtualToolDiameterInput[_0x5ec117(0x114)])||0x1,showInfo(_0x5ec117(0x200));}),window['addEventListener']('resize',()=>{setupCanvasLayout(),redrawCanvas();}),exportCsvQuotesButton[_0x9a4ea2(0x2f8)][_0x9a4ea2(0x1ee)]='none',exportCustomTableButton[_0x9a4ea2(0x2f8)][_0x9a4ea2(0x1ee)]=_0x9a4ea2(0x2c1);
html
    </script>
</body>
</html>
